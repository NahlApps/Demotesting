<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>حجوزات المواعيد</title>

  <!-- ===== Favicon (robust, cross-browser) ===== -->
  <link rel="icon" href="/favicon.ico?v=1" sizes="any">
  <link rel="shortcut icon" href="/favicon.ico?v=1">
  <link rel="icon" type="image/png" sizes="32x32"
        href="https://pdnmghkpepvsfaiqlafk.supabase.co/storage/v1/object/public/nahl%20assets/Nahl%20Time%20Pro%20From/ChatGPT%20Image%20Sep%2013,%202025,%2001_21_33%20PM.png">
  <link rel="icon" type="image/png" sizes="16x16"
        href="https://pdnmghkpepvsfaiqlafk.supabase.co/storage/v1/object/public/nahl%20assets/Nahl%20Time%20Pro%20From/ChatGPT%20Image%20Sep%2013,%202025,%2001_21_33%20PM.png">
  <link rel="apple-touch-icon" sizes="180x180"
        href="https://pdnmghkpepvsfaiqlafk.supabase.co/storage/v1/object/public/nahl%20assets/Nahl%20Time%20Pro%20From/ChatGPT%20Image%20Sep%2013,%202025,%2001_21_33%20PM.png">
  <meta name="theme-color" content="#027A93"/>

  <!-- ===== SEO: Canonical & Robots ===== -->
  <link rel="canonical" href="https://nahl.app/booking"/>
  <meta name="robots" content="index,follow,max-snippet:-1,max-image-preview:large,max-video-preview:-1"/>
  <meta name="description" content="حجز غسيل سيارات متنقل داخل السعودية — اختر المنطقة والخدمة والوقت، وحدد موقعك على الخريطة. خدمة فاخرة وسريعة مع خيارات دفع مرنة."/>

  <!-- ===== Open Graph / Twitter ===== -->
  <meta property="og:title" content="حجوزات المواعيد — نحل | Nahl"/>
  <meta property="og:description" content="حجز غسيل سيارات متنقل داخل السعودية — اختر المنطقة والخدمة والوقت، وحدد موقعك على الخريطة. خدمة فاخرة وسريعة مع خيارات دفع مرنة."/>
  <meta property="og:type" content="website"/>
  <meta property="og:url" content="https://nahl.app/booking"/>
  <meta property="og:site_name" content="Nahl"/>
  <meta property="og:locale" content="ar_SA"/>
  <meta property="og:image" content="https://pdnmghkpepvsfaiqlafk.supabase.co/storage/v1/object/public/nahl%20assets/Nahl%20Time%20Pro%20From/NahlDemoBG3.jpg"/>
  <meta property="og:image:alt" content="حجز موعد غسيل سيارات متنقل من نحل"/>
  <meta name="twitter:card" content="summary_large_image"/>
  <meta name="twitter:title" content="حجوزات المواعيد — نحل | Nahl"/>
  <meta name="twitter:description" content="حجز غسيل سيارات متنقل داخل السعودية — اختر المنطقة والخدمة والوقت، وحدد موقعك على الخريطة. خدمة فاخرة وسريعة مع خيارات دفع مرنة."/>
  <meta name="twitter:image" content="https://pdnmghkpepvsfaiqlafk.supabase.co/storage/v1/object/public/nahl%20assets/Nahl%20Time%20Pro%20From/NahlDemoBG3.jpg"/>

  <!-- UI libs -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet"/>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;800&display=swap" rel="stylesheet"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet"/>
  <link href="https://cdn.jsdelivr.net/npm/intl-tel-input@24.4.0/build/css/intlTelInput.css" rel="stylesheet"/>

  <style>
    /* (styles unchanged – truncated in this snippet for brevity)
       ——— KEEP YOUR FULL STYLES FROM YOUR CURRENT PAGE ——— */
    /* ... paste your full styles from the latest version here ... */

    /* Small muted consult line under service description */
    .desc-consult {
      display:block;
      margin-top:8px;
      font-size:.82rem;
      color:#6b7280;
    }
  </style>
</head>
<body>
  <!-- ... HTML content unchanged up to scripts (use your latest working file) ... -->

  <!-- libs -->
  <script src="https://code.jquery.com/jquery-3.6.3.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/luxon@3.4.4/build/global/luxon.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/intl-tel-input@24.4.0/build/js/intlTelInputWithUtils.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    /* ---------- API ---------- */
    // (keep your existing constants)
    const GAS_BASE_URL = 'YOUR_GAS_WEBAPP_URL'; // <— replace after deploy

    /* ===== Service Description fetch/render (with consultable log) ===== */
    function escapeHTML(s){
      return String(s || '').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
    }
    function showServiceDescSkeleton(){
      const card = document.getElementById('serviceDesc');
      const body = document.getElementById('serviceDescBody');
      if(!card || !body) return;
      card.style.display = 'block';
      body.innerHTML = '<div class="skeleton" style="width:90%"></div><div class="skeleton" style="width:70%"></div><div class="skeleton" style="width:82%"></div>';
    }
    function clearServiceDescriptionUI(){
      const card = document.getElementById('serviceDesc');
      const body = document.getElementById('serviceDescBody');
      if(!card || !body) return;
      body.innerHTML = '';
      card.style.display = 'none';
    }

    // UPDATED: includeLog=1 and show consult info
    async function fetchServiceDescription(serviceId){
      if(!GAS_BASE_URL || GAS_BASE_URL === 'https://script.google.com/macros/s/AKfycbzW1gKmZKr3AwJgJnx3tu8S9mC961eumsdjt-H7-V1FV8D14haW3qBLzNWAVkLReRJA0g/exec'){ 
        clearServiceDescriptionUI(); 
        return; 
      }
      showServiceDescSkeleton();
      try{
        const serviceName = ($('#service').find(':selected').text() || '').trim();
        const url = `${GAS_BASE_URL}?route=serviceDescription&serviceId=${encodeURIComponent(serviceId)}&serviceName=${encodeURIComponent(serviceName)}&includeLog=1`;
        const res = await fetch(url, { method:'GET', mode:'cors', cache:'no-store', headers:{ 'Accept':'application/json' }});
        const data = await res.json().catch(()=>null);
        const card = document.getElementById('serviceDesc');
        const body = document.getElementById('serviceDescBody');
        if(!card || !body) return;

        // Console consult (developer-friendly)
        if (data && data.log) {
          console.info('[ServiceDescription:Consult]', data.log);
        }

        if(res.ok && data && data.success && data.data){
          const desc = data.data.description || '—';
          const consult = data.log ? 
            `<small class="desc-consult">مصدر: الورقة "${escapeHTML(data.log.source.sheet)}" • صف #${data.log.source.rowNumber || '?'} • طول الوصف ${data.log.source.descriptionLength} • ${data.log.source.fromCache ? 'من الذاكرة المؤقتة' : 'من الورقة مباشرة'}</small>` 
            : '';
          body.innerHTML = `<p style="margin:0; white-space:pre-wrap">${escapeHTML(desc)}</p>${consult}`;
          card.style.display='block';
        } else {
          body.innerHTML = '<span class="text-muted">لا يوجد وصف متاح لهذه الخدمة</span>';
          card.style.display='block';
        }
      }catch(_e){
        const card = document.getElementById('serviceDesc');
        const body = document.getElementById('serviceDescBody');
        if(card && body){
          body.innerHTML = '<span class="text-muted">تعذر تحميل وصف الخدمة حالياً</span>';
          card.style.display='block';
        }
      }
    }
  </script>

  <!-- Google Maps (keep your current script include) -->
  <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_MAPS_KEY&callback=initMap&v=weekly&loading=async&libraries=places,geometry&language=ar&region=SA" async defer></script>
</body>
</html>
