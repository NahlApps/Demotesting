<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Tiger 77</title>

  <!-- UI libs -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet"/>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <!-- Fonts: Cairo (AR) + Noto Sans JP (JP) -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;800&family=Noto+Sans+JP:wght@400;600;700;900&display=swap" rel="stylesheet"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet"/>
  <link href="https://cdn.jsdelivr.net/npm/intl-tel-input@24.4.0/build/css/intlTelInput.css" rel="stylesheet"/>

  <meta property="twitter:image" content="https://pdnmghkpepvsfaiqlafk.supabase.co/storage/v1/object/public/nahl%20assets/Tiger77%20-%20Logo.png">
  <meta property="twitter:image:src" content="https://pdnmghkpepvsfaiqlafk.supabase.co/storage/v1/object/public/nahl%20assets/Tiger77%20-%20Logo.png">
  <link rel="shortcut icon" href="https://pdnmghkpepvsfaiqlafk.supabase.co/storage/v1/object/public/nahl%20assets/Tiger77%20-%20Logo.png" type="image/x-icon">
  <link rel="icon" type="image/png" sizes="32x32" href="">
  <link rel="icon" type="image/png" sizes="16x16" href="">

<style>
  /* ===== Tokyo (Neon / Zen) Theme ======================================= */
  :root{
    /* Ink base + neon accents */
    --ink-950:#0a0b0f;          /* page background ink */
    --ink-900:#12131a;          /* card text */
    --zen-100:rgba(255,255,255,.82);
    --zen-080:rgba(255,255,255,.66);
    --zen-060:rgba(255,255,255,.48);

    --neon-cyan:#00E5FF;        /* neon cyan */
    --neon-magenta:#FF2D92;     /* neon magenta */
    --neon-purple:#7A5CFF;      /* neon purple */
    --neon-lime:#C6FF00;        /* accent spark (rare) */

    --glass-bg:rgba(18,19,26,.66);
    --glass-stroke:rgba(255,255,255,.12);
    --glass-blur:10px;

    --border-300:#283041;

    /* Re-map legacy tokens used by existing UI */
    --p-900: var(--neon-purple);
    --p-800: #5746ff;
    --p-700: #3a2dff;
    --p-600: #2b22d6;
    --p-500: #b4adff;

    --p-900-58: color-mix(in oklab, var(--neon-purple) 58%, transparent);
    --p-900-34: color-mix(in oklab, var(--neon-purple) 34%, transparent);
    --p-800-65: color-mix(in oklab, var(--p-800) 65%, transparent);
    --p-800-45: color-mix(in oklab, var(--p-800) 45%, transparent);
    --p-600-22: color-mix(in oklab, var(--p-600) 22%, transparent);
    --p-600-14: color-mix(in oklab, var(--p-600) 14%, transparent);

    --gold-600: var(--neon-magenta);

    --lavender-050: color-mix(in oklab, var(--neon-purple) 12%, #0b0d13);

    --radius-md:14px; --radius-pill:999px;
    --shadow-xs:0 4px 14px rgba(0,0,0,.28);
    --shadow-sm:0 10px 28px rgba(0,0,0,.32);
    --shadow-md:0 16px 36px rgba(0,0,0,.38);

    --ease:cubic-bezier(.22,.61,.36,1);
    --dur-xs:160ms; --dur-sm:220ms; --dur-md:460ms;

    --header-h:76px; --footer-h:118px;

    --grain:url("data:image/svg+xml;utf8, \
      <svg xmlns='http://www.w3.org/2000/svg' width='160' height='160' viewBox='0 0 40 40'> \
        <filter id='n'><feTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='4' stitchTiles='stitch'/></filter> \
        <rect width='100%' height='100%' filter='url(%23n)' opacity='.06'/> \
      </svg>");
    --page-bg:url("https://images.unsplash.com/photo-1569830907165-5c5d8c1e1f1a?q=80&w=2400&auto=format&fit=crop"); /* Tokyo night */
  }

  html,body{height:100%}
  body{
    margin:0;
    font-family: 'Cairo', 'Noto Sans JP', system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
    color:#fff;
    background:
      radial-gradient(1200px 600px at 80% -10%, rgba(122,92,255,.22), transparent 60%),
      radial-gradient(1000px 500px at 10% 10%, rgba(255,45,146,.20), transparent 65%),
      radial-gradient(900px 400px at 50% 110%, rgba(0,229,255,.18), transparent 70%),
      var(--page-bg) center/cover no-repeat fixed;
    min-height:100vh; min-height:100dvh;
    display:flex; flex-direction:column;
    padding-top:var(--header-h); padding-bottom:var(--footer-h);
    position:relative;
    isolation:isolate;
  }
  body::before{
    content:""; position:fixed; inset:0; z-index:-1;
    background:var(--grain) center/320px repeat;
    opacity:.7; pointer-events:none; mix-blend-mode:overlay;
  }

  /* ================= Header ================= */
  header{
    position:fixed; inset:0 0 auto 0; z-index:999;
    background: linear-gradient(0deg, rgba(10,11,15,.75), rgba(10,11,15,.9));
    backdrop-filter: blur(14px);
    border-bottom:1px solid var(--glass-stroke);
  }
  .header-inner{ max-width:1120px; width:100%; margin:0 auto; padding:10px 12px; display:flex; align-items:center; gap:12px; justify-content:space-between; }

  .brand{
    display:flex; align-items:center; gap:10px;
    padding:6px 10px; border-radius:12px;
    background: linear-gradient(180deg, rgba(255,255,255,.09), rgba(255,255,255,.03));
    box-shadow: inset 0 1px 0 rgba(255,255,255,.1);
  }
  .brand img{height:72px; width:auto; object-fit:contain;
    filter: drop-shadow(0 1px 0 rgba(255,255,255,.35)) drop-shadow(0 10px 18px rgba(122,92,255,.35));
  }

  .header-right{flex:1; display:flex; flex-direction:column; gap:6px}

  /* Progress bar neon */
  .mini-progress{display:flex; align-items:center; gap:10px; width:100%}
  .mini-progress .bar{flex:1; height:8px; background:rgba(255,255,255,.18); border-radius:999px; overflow:hidden}
  .mini-progress .bar>span{
    display:block; height:100%; width:0%;
    background:
      linear-gradient(90deg, var(--neon-cyan), var(--neon-magenta));
    box-shadow:0 0 16px color-mix(in oklab, var(--neon-cyan) 58%, transparent), 0 0 14px color-mix(in oklab, var(--neon-magenta) 38%, transparent);
    transition:width var(--dur-md) var(--ease)
  }
  .mini-progress .step{font-weight:800; font-size:1rem; color:#fff; text-shadow:0 1px 0 rgba(0,0,0,.25)}

  /* Chips */
  .summary-chips{display:flex; flex-wrap:wrap; gap:6px; align-items:center}
  .chip{
    display:inline-flex; align-items:center; gap:8px; max-width:100%;
    padding:6px 12px; border:1px solid var(--glass-stroke);
    border-radius:999px; color:#fff; font-size:.85rem;
    background:linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.02));
    box-shadow:inset 0 0 0 1px rgba(255,255,255,.04), 0 8px 22px rgba(0,0,0,.28);
    white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
  }
  .chip.current{
    background:linear-gradient(180deg, rgba(122,92,255,.22), rgba(255,45,146,.14));
    border-color: color-mix(in oklab, var(--neon-magenta) 40%, var(--neon-purple));
    box-shadow:0 0 0 2px color-mix(in oklab, var(--neon-cyan) 30%, transparent) inset;
  }

  /* ================= Pages / Cards ================= */
  main{flex:1 0 auto; display:flex; justify-content:center; padding:8px 12px 0}
  #app{width:100%; max-width:1120px}
  .stage{position:relative; min-height:560px; padding:8px 0 20px}
  .page{
    position:absolute; inset:0; display:flex; flex-direction:column; align-items:center; gap:20px;
    padding:24px 12px 28px; overflow:auto; opacity:0; transform:translateY(12px) scale(.992);
    pointer-events:none;
  }
  .page.active{ pointer-events:auto; animation:pageIn var(--dur-md) var(--ease) both }
  .page.exit  { animation:pageOut var(--dur-sm) var(--ease) both }
  @keyframes pageIn{ from{opacity:0; transform:translateY(12px) scale(.992)} to{opacity:1; transform:translateY(0) scale(1)} }
  @keyframes pageOut{ from{opacity:1; transform:translateY(0) scale(1)} to{opacity:0; transform:translateY(14px) scale(.985)} }
  .page h1{font-size:1.375rem; font-weight:900; margin:0; text-align:center; letter-spacing:.3px; text-shadow:0 6px 24px rgba(0,0,0,.35)}

  .card{
    background:var(--glass-bg); color:var(--zen-100);
    border-radius:14px; box-shadow:var(--shadow-md);
    padding:24px; width:100%; max-width:920px; backdrop-filter:blur(var(--glass-blur));
    border:1px solid var(--glass-stroke);
  }

  /* Welcome deck */
  .ppt-deck{position:relative; width:100%; max-width:920px; height:200px}
  .ppt-slide{position:absolute; inset:0; display:flex; align-items:center; justify-content:center; opacity:0; transform:translateY(14px) scale(.98); transition:opacity .6s var(--ease), transform .6s var(--ease)}
  .ppt-slide .slide-card{
    background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.02));
    color:var(--zen-100); border-radius:14px; box-shadow:var(--shadow-md);
    padding:18px 20px; text-align:center; width:min(820px,92%); border:1px solid var(--glass-stroke)
  }
  .ppt-slide.is-active{opacity:1; transform:none; z-index:2}
  .ppt-slide.is-exiting{opacity:0; transform:translateY(-8px) scale(.985); z-index:1}
  .ppt-dots{display:flex; gap:8px; justify-content:center; margin-top:12px}
  .ppt-dot{width:8px; height:8px; border-radius:50%; background:rgba(255,255,255,.35)}
  .ppt-dot.active{background:var(--neon-cyan); box-shadow:0 0 0 4px color-mix(in oklab, var(--neon-cyan) 25%, transparent)}

  /* Inputs */
  .form-control, select, .select2-selection{
    background:rgba(255,255,255,.06); color:var(--zen-100);
    border:1px solid var(--glass-stroke)!important; border-radius:14px!important;
    min-height:52px; text-align:center; font-size:16px;
    transition:border-color var(--dur-xs) var(--ease), box-shadow var(--dur-xs) var(--ease), background var(--dur-xs) var(--ease);
  }
  .form-control:focus{
    box-shadow:0 0 0 6px color-mix(in oklab, var(--neon-cyan) 18%, transparent), 0 0 0 2px color-mix(in oklab, var(--neon-magenta) 22%, transparent) inset;
    border-color:color-mix(in oklab, var(--neon-magenta) 38%, var(--neon-cyan))!important;
    background:rgba(255,255,255,.10);
  }
  .form-label{display:inline-block; margin-bottom:6px; font-size:.9rem; font-weight:800; color:var(--zen-080)}
  .field-error{color:#FF6B6B; font-size:.85rem; margin-top:6px; display:none}
  .has-error .form-control, .has-error .select2-selection{ border-color:#FF6B6B !important; }
  .has-error .field-error{display:block}

  .select2-container .select2-selection--single .select2-selection__rendered{color:var(--zen-100)!important; line-height:52px!important;}
  .select2-container .select2-selection--single{height:52px!important; display:flex; align-items:center}
  .select2-dropdown{background:#0f1117; color:var(--zen-100); border:1px solid var(--glass-stroke)}
  .select2-results__option, .select2-search__field{color:var(--zen-100)}
  .select2-results__option--highlighted{ background:color-mix(in oklab, var(--neon-purple) 40%, #0f1117)!important; color:#fff!important; }

  /* Time picker */
  .time-toolbar{display:grid; grid-template-columns:1fr; gap:12px; margin-bottom:8px}
  @media (min-width:768px){ .time-toolbar{grid-template-columns: 1fr; } }
  .time-grid{display:grid; grid-template-columns:repeat(2,1fr); gap:16px}
  @media (min-width:540px){ .time-grid{grid-template-columns:repeat(3,1fr)} }
  .time-option{
    background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
    color:var(--zen-100); font-weight:900;
    border:1px solid var(--glass-stroke); border-radius:14px;
    padding:14px 10px; min-height:64px; box-shadow:var(--shadow-xs);
    transition:transform var(--dur-xs) var(--ease), box-shadow var(--dur-xs) var(--ease), background var(--dur-xs) var(--ease), outline-color var(--dur-xs) var(--ease);
    display:flex; flex-direction:column; align-items:center; justify-content:center;
    letter-spacing:.5px;
  }
  .time-option:hover{transform:translateY(-2px); background:linear-gradient(180deg, rgba(122,92,255,.15), rgba(255,45,146,.08)); box-shadow:var(--shadow-sm)}
  .time-option[aria-pressed="true"]{
    outline:3px solid var(--neon-cyan);
    outline-offset:2px;
    background:linear-gradient(0deg, color-mix(in oklab, var(--neon-magenta) 18%, #10121a), color-mix(in oklab, var(--neon-purple) 22%, #10121a));
    box-shadow:0 0 0 3px rgba(11,124,255,.18);
  }

  /* Loading overlay */
  .load-overlay{
    position:absolute; inset:0; background:rgba(5,6,9,.78); color:var(--zen-080);
    display:none; align-items:center; justify-content:center; gap:12px; border-radius:14px; backdrop-filter:blur(6px);
    border:1px solid var(--glass-stroke);
  }
  .load-overlay.show{display:flex; animation:fadeIn var(--dur-sm) var(--ease) both}
  @keyframes fadeIn{ from{opacity:0} to{opacity:1} }

  /* Payment */
  .visually-hidden{position:absolute!important;height:1px;width:1px;overflow:hidden;clip:rect(1px,1px,1px,1px);white-space:nowrap;border:0;padding:0;margin:-1px}
  :root{ --pri-50:#0f1117; --pri-600:var(--neon-cyan); }
  .pay-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:12px;align-items:stretch;width:min(100%,960px);margin-inline:auto}
  .pay-card{cursor:pointer;border:1px solid var(--glass-stroke);background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));border-radius:14px;padding:14px;min-height:96px;display:flex;align-items:center;justify-content:center;transition:border-color .2s,box-shadow .2s,transform .05s,background-color .2s;outline:none;width:100%}
  .pay-card:hover{border-color:color-mix(in oklab, var(--neon-cyan) 40%, var(--glass-stroke));box-shadow:0 10px 28px rgba(0,0,0,.35);background:linear-gradient(180deg, rgba(122,92,255,.14), rgba(255,45,146,.08))}
  .pay-card:has(input:checked){border-color:var(--neon-cyan);box-shadow:0 0 0 3px color-mix(in oklab, var(--neon-cyan) 28%, transparent);background:linear-gradient(0deg, color-mix(in oklab, var(--neon-cyan) 14%, rgba(255,255,255,.08)), rgba(255,255,255,.02))}
  .pay-card__content{display:grid;grid-template-rows:auto auto;justify-items:center;align-items:center;gap:10px;text-align:center}
  .pay-card__img{width:min(180px,60%);max-height:40px;object-fit:contain;filter:drop-shadow(0 6px 14px rgba(0,229,255,.25))}
  .pay-card__icon{font-size:28px;line-height:1}
  .pay-card__label{font-size:14px;color:var(--zen-100);font-weight:800; letter-spacing:.4px}
  .field-error{color:#ff8080;font-size:14px;margin-top:10px;text-align:center;display:none}
  .pay-grid[data-invalid="true"] ~ .field-error { display:block; }

  /* Map */
  .map-search{position:relative; margin-bottom:12px}
  .map-search .form-control{min-height:48px; text-align:right}
  .map-search .fa-magnifying-glass{position:absolute; left:12px; top:50%; transform:translateY(-50%); color:#9aa3b2}
  #googleMap{width:100%;height:420px;border-radius:14px;overflow:hidden;border:1px solid var(--glass-stroke)}

  /* Footer */
  footer.sticky-nav{
    position:sticky; bottom:0; z-index:40;
    background: linear-gradient(180deg, rgba(10,11,15,.7), rgba(10,11,15,.94));
    backdrop-filter:blur(10px); border-top:1px solid var(--glass-stroke);
  }
  .footer-inner{ max-width:1120px; width:100%; margin:0 auto; padding:12px; display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap}
  .footer-brand{ font-size:.95rem; color:#cbd5e1; opacity:.94; display:flex; align-items:center; gap:10px; flex-wrap:wrap}
  .footer-brand a{color:#fff; text-decoration:underline}
  .footer-social{display:flex; align-items:center; gap:12px}
  .footer-social a{color:#fff; opacity:.95; font-size:1.2rem}
  .footer-actions{display:flex; gap:12px; width:100%}
  .btn-footer{
    flex:1; border:1px solid var(--glass-stroke); border-radius:14px; padding:16px 16px; min-height:56px; font-size:1rem; font-weight:900;
    background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02)); color:#e5edff;
    transition:transform var(--dur-xs), box-shadow var(--dur-xs), background var(--dur-xs), color var(--dur-xs), border-color var(--dur-xs);
    letter-spacing:.3px;
  }
  .btn-footer:hover{transform:translateY(-2px); box-shadow:var(--shadow-sm)}
  .btn-footer.primary{
    background:linear-gradient(90deg, var(--neon-cyan), var(--neon-magenta));
    color:#0a0b0f; border-color:transparent; text-shadow:none;
  }
  .btn-footer.primary:hover{filter:saturate(1.2) brightness(1.05)}
  .btn-footer.primary:focus{ box-shadow:0 0 0 6px color-mix(in oklab, var(--neon-cyan) 16%, transparent); }
  .btn-footer.hidden{visibility:hidden}
  .btn-footer:disabled{opacity:.5; pointer-events:none}
  #footer-wait{display:none; align-items:center; gap:10px; color:#fff; font-weight:800}
  #footer-wait.show{display:flex}

  @media (max-width: 480px){
    .brand img{ height:64px }
    .summary-chips{ overflow-x:auto; gap:6px; padding-bottom:2px; scrollbar-width:thin; }
    .summary-chips::-webkit-scrollbar{ height:4px }
    .chip{ padding:4px 8px; font-size:.78rem }
    .chip .title{ display:none }
    .chip .value{ max-width:140px; overflow:hidden; text-overflow:ellipsis }
    .btn-footer{min-height:58px; font-size:1.05rem}
    .footer-actions{width:100%}
    .footer-brand{width:100%; justify-content:space-between}
  }

  .iti{ width:100%; }
  html[dir="rtl"] .iti--allow-dropdown .iti__flag-container{ left:8px; right:auto; }
  html[dir="rtl"] .iti--allow-dropdown input#mobile.form-control{
    padding-left: calc(76px + 8px);
    padding-right: 12px;
    text-align: left; direction: ltr;
  }

  /* Service cards */
  .svc-grid{ display:grid; gap:14px; margin-top:8px; grid-template-columns:repeat(1,minmax(0,1fr)); }
  @media (min-width:560px){ .svc-grid{ grid-template-columns:repeat(2,minmax(0,1fr)); } }
  @media (min-width:992px){ .svc-grid{ grid-template-columns:repeat(3,minmax(0,1fr)); } }
  .svc-card{
    background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
    border:1px solid var(--glass-stroke); border-radius:14px; color:var(--zen-100);
    padding:12px; display:flex; gap:12px; align-items:flex-start; cursor:pointer; outline:none; box-shadow:var(--shadow-xs);
    transition:transform var(--dur-xs), box-shadow var(--dur-xs), background var(--dur-xs); min-height:110px; position:relative;
  }
  .svc-card:hover{ transform:translateY(-2px); box-shadow:var(--shadow-sm); background:linear-gradient(180deg, rgba(122,92,255,.14), rgba(255,45,146,.08)) }
  .svc-card.selected, .svc-card[aria-checked="true"]{
    outline:3px solid var(--neon-magenta); outline-offset:2px;
    box-shadow:0 0 0 2px color-mix(in oklab, var(--neon-cyan) 26%, transparent) inset;
  }
  .svc-thumb{ width:88px;height:88px;flex:0 0 88px;border-radius:12px;overflow:hidden;background:#0f1117;border:1px solid var(--glass-stroke); display:flex;align-items:center;justify-content:center; }
  .svc-thumb img{ width:100%;height:100%;object-fit:cover;display:block }
  .svc-body{ flex:1 1 auto; min-width:0 }
  .svc-title-row{ display:flex; align-items:center; gap:8px }
  .svc-title{ font-weight:900; font-size:1rem; color:#fff; margin:0 0 4px; letter-spacing:.2px }
  .svc-cat{ background:linear-gradient(90deg, var(--neon-magenta), var(--neon-purple)); color:#0a0b0f; border:0; padding:2px 8px; border-radius:999px; font-size:.75rem; display:inline-flex; gap:6px; align-items:center; white-space:nowrap; margin-inline-start:auto; font-weight:900 }
  .svc-desc{ font-size:.9rem; color:var(--zen-080); margin:0 0 8px; line-height:1.5; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden }
  .tag-row{ display:flex; flex-wrap:wrap; gap:6px }
  .price-tag{ background:linear-gradient(90deg, var(--neon-cyan), var(--neon-magenta)); color:#0a0b0f; border:0; padding:4px 8px; border-radius:999px; font-size:.8rem; white-space:nowrap; font-weight:900 }
  .price-tag.alt{ background:linear-gradient(90deg, var(--neon-purple), var(--neon-cyan)) }
  .svc-cta{ position:absolute; inset-inline-end:10px; inset-block-end:10px; font-size:.85rem; color:#cbd5e1; opacity:.88 }
  .svc-skel{ background:linear-gradient(90deg,#0e0f14,#12131a,#0e0f14); background-size:200% 100%; animation:shimmer 1.2s infinite; border:1px solid var(--glass-stroke); border-radius:14px; min-height:110px; }
  @keyframes shimmer{ 0%{background-position:200% 0} 100%{background-position:-200% 0} }

  /* Add-ons chips */
  #addonsChips .btn{
    background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
    color:#fff; border:1px solid var(--glass-stroke); border-radius:999px; min-height:38px; padding-inline:14px;
  }
  #addonsChips .btn:hover{ background:linear-gradient(180deg, rgba(122,92,255,.14), rgba(255,45,146,.08)); border-color:var(--neon-cyan); }
  #addonsChips .btn[aria-pressed="true"]{
    background:linear-gradient(90deg, var(--neon-cyan), var(--neon-magenta))!important; color:#0a0b0f!important; border-color:transparent!important; box-shadow:0 0 0 3px color-mix(in oklab, var(--neon-cyan) 20%, transparent);
  }
  #addonsChips .btn[aria-pressed="true"]::before{ content:"âœ“"; font-weight:900; margin-inline-start:6px; }

  /* Language toggle */
  .lang-toggle{
    display:flex; gap:8px; align-items:center; margin-inline-start:8px;
    background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.02));
    border:1px solid var(--glass-stroke); border-radius:999px; padding:6px 10px;
  }
  .lang-toggle button{
    border:0; padding:6px 10px; border-radius:999px; font-weight:900; letter-spacing:.3px; color:#e5edff;
    background:transparent; cursor:pointer;
  }
  .lang-toggle button.active{
    background:linear-gradient(90deg, var(--neon-cyan), var(--neon-magenta)); color:#0a0b0f;
  }

  /* Reduced motion */
  @media (prefers-reduced-motion: reduce){
    *{animation:none!important; transition:none!important}
  }
</style>
</head>
<body>
  <div id="toastWrap" style="position:fixed;top:10px;left:50%;transform:translateX(-50%);z-index:1050;display:flex;flex-direction:column;gap:8px"></div>

  <header id="siteHeader">
    <div class="header-inner">
      <div class="brand">
        <img id="brandLogo"
             alt="Tiger 77"
             src="https://pdnmghkpepvsfaiqlafk.supabase.co/storage/v1/object/public/nahl%20assets/Tiger77%20-%20Logo.png"
             onerror="handleLogoError(this)" />
        <!-- Language toggle -->
        <div class="lang-toggle" aria-label="Language">
          <button id="btnLangAR" class="active" type="button">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</button>
          <button id="btnLangJP" type="button">æ—¥æœ¬èª</button>
        </div>
      </div>
      <div class="header-right">
        <div class="mini-progress" aria-hidden="true">
          <div class="bar"><span id="miniBarFill" style="width:0%"></span></div>
          <div class="step" id="miniStepTitle" data-i18n="step.welcome">Ø§Ù„ØªØ±Ø­ÙŠØ¨</div>
        </div>
        <div id="summaryChips" class="summary-chips" aria-live="polite"></div>
      </div>
    </div>
  </header>

  <main>
    <div id="app">
      <div class="stage">
        <!-- 1) Welcome -->
        <section id="page1" class="page active" aria-label="Ø§Ù„ØªØ±Ø­ÙŠØ¨">
          <h1 data-i18n="brand.title">ğŸ¯ Tiger 77</h1>
          <div class="ppt-deck" id="pptDeck">
            <div class="ppt-slide is-active">
              <div class="slide-card"><h3 class="mb-2" data-i18n="welcome.s1t">Ù†Ø¬ÙŠÙƒ Ù„ÙŠÙ† Ø¨Ø§Ø¨ Ø¨ÙŠØªÙƒ</h3><p class="m-0" data-i18n="welcome.s1d">Ø­Ø¬Ø² Ø³Ø±ÙŠØ¹ â€¢ Ø®Ø¯Ù…Ø© Ù…ØªÙ†Ù‚Ù„Ø© â€¢ Ø§Ø­ØªØ±Ø§ÙÙŠØ© ÙÙŠ ÙƒÙ„ ØªÙØµÙŠÙ„</p></div>
            </div>
            <div class="ppt-slide">
              <div class="slide-card"><h3 class="mb-2" data-i18n="welcome.s2t">Ù…ÙˆØ§Ø¯ ÙØ§Ø®Ø±Ø©</h3><p class="m-0" data-i18n="welcome.s2d">Ù…Ù†ØªØ¬Ø§Øª Ø¢Ù…Ù†Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø·Ù„Ø§Ø¡ ÙˆØ§Ù„Ø¯Ø§Ø®Ù„ÙŠØ© Ù…Ø¹ Ø¹Ù†Ø§ÙŠØ© Ø¯Ù‚ÙŠÙ‚Ø©</p></div>
            </div>
            <div class="ppt-slide">
              <div class="slide-card"><h3 class="mb-2" data-i18n="welcome.s3t">Ù…ÙˆØ¹Ø¯Ùƒ Ø¹Ù„Ù‰ Ø±Ø§Ø­ØªÙƒ</h3><p class="m-0" data-i18n="welcome.s3d">Ø­Ø¯Ø¯ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© ÙˆØ§Ù„Ø®Ø¯Ù…Ø© ÙˆØ§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ â€” ÙˆØ§Ù„Ø¨Ø§Ù‚ÙŠ Ø¹Ù„ÙŠÙ†Ø§</p></div>
            </div>
          </div>
          <div id="pptDots" class="ppt-dots" aria-hidden="true"></div>
          <div class="card text-center" style="max-width:860px">
            <p class="mb-0" style="color:#d5d9fb" data-i18n="welcome.cta">Ø§Ù†Ø·Ù„Ù‚ â€” Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„ØªØ§Ù„ÙŠØ© Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù†Ø·Ù‚Ø© ÙˆØ§Ù„Ø®Ø¯Ù…Ø©</p>
          </div>
        </section>

        <!-- 2) Service & Location -->
        <section id="page2" class="page" aria-label="Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù†Ø·Ù‚Ø© ÙˆØ§Ù„Ø®Ø¯Ù…Ø©">
          <h1 data-i18n="step.service">ÙˆÙŠÙ† ØªØ­Ø¨ Ù†Ø¬ÙŠÙƒØŸ</h1>
          <div class="card position-relative" id="servicesCard">
            <label class="form-label" data-i18n="labels.area">Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</label>
            <select id="area" style="width:100%"></select>
            <div class="field-error" id="err-area" data-i18n="errors.area">ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</div>

            <div class="row g-3 mt-3">
              <div class="col-12 col-md-6">
                <label class="form-label" data-i18n="labels.category">Ø§Ù„ØªØµÙ†ÙŠÙ</label>
                <select id="serviceCat" style="width:100%"></select>
                <div class="field-error" id="err-serviceCat" data-i18n="errors.category">ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØªØµÙ†ÙŠÙ</div>
              </div>

              <!-- Hidden actual select synced with cards -->
              <div class="col-12 col-md-6" hidden>
                <label class="form-label" data-i18n="labels.service">Ø§Ù„Ø®Ø¯Ù…Ø©</label>
                <select id="service" style="width:100%" class="visually-hidden" aria-hidden="true" tabindex="-1"></select>
                <div class="field-error" id="err-service" data-i18n="errors.service">ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø®Ø¯Ù…Ø©</div>
              </div>

              <!-- Number of Cars -->
              <div class="col-12 col-md-6">
                <label class="form-label" for="numCars" data-i18n="labels.cars">Ø¹Ø¯Ø¯ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª (Ø­ØªÙ‰ 5)</label>
                <select id="numCars" style="width:100%">
                  <option value="1" selected>1</option>
                  <option value="2">2</option>
                  <option value="3">3</option>
                  <option value="4">4</option>
                  <option value="5">5</option>
                </select>
                <div class="field-error" id="err-numCars" data-i18n="errors.cars">ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø¹Ø¯Ø¯ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</div>
              </div>

              <div class="col-12">
                <div id="serviceCardsWrap">
                  <div id="serviceCards" class="svc-grid" role="radiogroup" aria-label="Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©"></div>
                  <div id="svcEmpty" class="text-center text-muted" style="display:none;padding:16px" data-i18n="state.noServices">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø®Ø¯Ù…Ø§Øª ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ØªØµÙ†ÙŠÙ</div>
                  <div id="svcError" class="text-center" style="display:none;padding:16px">
                    <div class="mb-2 text-danger" data-i18n="state.loadErr">ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø¯Ù…Ø§Øª</div>
                    <button id="svcRetry" class="btn btn-outline-primary btn-sm" data-i18n="actions.retry">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©</button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Spinner during load -->
            <div id="servicesLoading" class="load-overlay" aria-hidden="true">
              <div class="spinner-border text-info" role="status" aria-hidden="true"></div>
              <strong data-i18n="state.loadingServices">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø®Ø¯Ù…Ø§Øªâ€¦</strong>
            </div>
          </div>
        </section>

        <!-- 3) Time -->
        <section id="page3" class="page" aria-label="Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…ÙˆØ¹Ø¯">
          <h1 data-i18n="step.time">Ù…ØªÙ‰ ØªØ­Ø¨ Ù†Ø¬ÙŠÙƒØŸ</h1>
          <div class="card position-relative" id="timeCard">
            <div class="row g-3">
              <div class="col-12 col-md-5">
                <label class="form-label" for="date" data-i18n="labels.date">Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
                <input id="date" type="date" class="form-control"/>
                <div class="field-error" id="err-date" data-i18n="errors.date">ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ØªØ§Ø±ÙŠØ® ØµØ­ÙŠØ­</div>
              </div>
              <div class="col-12 col-md-7 d-flex align-items-end justify-content-end">
                <div class="text-muted" id="timeCountHint" style="font-weight:800">0/1 ÙˆÙ‚Øª Ù…Ø­Ø¯Ø¯</div>
              </div>
            </div>

            <div class="time-toolbar mt-3">
              <div>
                <label class="form-label" for="timeFilter" hidden data-i18n="labels.timeFilter">ÙÙ„ØªØ±Ø© Ø§Ù„ÙˆÙ‚Øª</label>
                <select id="timeFilter" class="form-select" hidden>
                  <option value="all" selected data-i18n="time.all">ÙƒÙ„ Ø§Ù„Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©</option>
                  <option value="morning" data-i18n="time.morning">Ø§Ù„ØµØ¨Ø§Ø­ (06:00â€“11:00)</option>
                  <option value="afternoon" data-i18n="time.afternoon">Ø§Ù„Ø¸Ù‡ÙŠØ±Ø© (11:00â€“16:00)</option>
                  <option value="evening" data-i18n="time.evening">Ø§Ù„Ù…Ø³Ø§Ø¡ (16:00â€“21:00)</option>
                  <option value="night" data-i18n="time.night">Ù„ÙŠÙ„Ù‹Ø§ (21:00â€“23:59)</option>
                </select>
              </div>
            </div>

            <div class="position-relative mt-3">
              <div id="time-container" class="time-grid" role="group" aria-label="Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø£ÙˆÙ‚Ø§Øª (Ù…ØªØ¹Ø¯Ø¯)"></div>
              <div id="timeLoading" class="load-overlay">
                <div class="spinner-border text-info" role="status" aria-hidden="true"></div>
                <strong data-i18n="state.fetchTimes">Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯â€¦</strong>
              </div>
            </div>
          </div>
        </section>

        <!-- 4) Contact -->
        <section id="page4" class="page" aria-label="Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„">
          <h1 data-i18n="step.contact">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„</h1>
          <div class="card">
            <div class="row g-3">
              <div class="col-12 col-md-6">
                <label for="name" class="form-label" data-i18n="labels.name">Ø§Ù„Ø§Ø³Ù…</label>
                <input id="name" type="text" class="form-control" placeholder="Ø§Ù„Ø§Ø³Ù… ÙƒÙ…Ø§ Ø³ÙŠØ¸Ù‡Ø± ÙÙŠ Ø§Ù„ÙØ§ØªÙˆØ±Ø©" autocomplete="name"/>
                <div class="field-error" id="err-name" data-i18n="errors.name">ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù…</div>
              </div>
              <div class="col-12 col-md-6">
                <label for="mobile" class="form-label" data-i18n="labels.mobile">Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„</label>
                <input id="mobile" type="tel" class="form-control" placeholder="5XXXXXXXX" autocomplete="tel"/>
                <div class="field-error" id="err-mobile" data-i18n="errors.mobile">Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø¬ÙˆØ§Ù„ ØµØ­ÙŠØ­</div>
              </div>
            </div>
          </div>

          <div class="card" hidden>
            <div class="row g-3">
              <div class="col-12 col-md-4">
                <label class="form-label" for="carBrand" data-i18n="labels.carBrand">Ù…Ø§Ø±ÙƒØ© Ø§Ù„Ø³ÙŠØ§Ø±Ø© ğŸš˜</label>
                <select id="carBrand" style="width:100%"></select>
              </div>
              <div class="col-12 col-md-4">
                <label class="form-label" for="carName" data-i18n="labels.carName">Ø§Ø³Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø©</label>
                <input id="carName" type="text" class="form-control" placeholder="Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„/Ø§Ù„ÙØ¦Ø© â€” Ù…Ø«Ø§Ù„: S-ClassØŒ LX 570" autocomplete="off"/>
              </div>
              <div class="col-12 col-md-4">
                <label class="form-label" for="plateNumber" data-i18n="labels.plate">Ø±Ù‚Ù… Ø§Ù„Ù„ÙˆØ­Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                <input id="plateNumber" type="text" inputmode="numeric" class="form-control" placeholder="Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù„ÙˆØ­Ø© â€” Ø§Ø®ØªÙŠØ§Ø±ÙŠ" autocomplete="off"/>
                <small id="plateHelp" class="text-muted d-block mt-1" style="opacity:.9" data-i18n="hints.plate">Ø§Ø®ØªÙŠØ§Ø±ÙŠ â€” ÙŠØ³Ø§Ø¹Ø¯ ÙØ±ÙŠÙ‚Ù†Ø§ Ø¹Ù„Ù‰ Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ù…Ø±ÙƒØ¨ØªÙƒ Ø¨Ø³Ø±Ø¹Ø©</small>
                <div class="field-error" id="err-plate" style="display:none"></div>
              </div>
              <input id="locationDescription" type="text" hidden/>
              <input id="serviceCount" type="hidden" value="1"/>
            </div>
          </div>
        </section>

        <!-- 5) Payment -->
        <section id="page5" class="page" aria-label="Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹">
          <h1 data-i18n="step.pay">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</h1>
          <div class="pay-grid" role="radiogroup" aria-label="Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹" id="payGroup" aria-describedby="err-pay" >
            <label class="pay-card" role="radio" aria-checked="false" tabindex="0" hidden>
              <input type="radio" name="payingMethod" value="stc pay" class="visually-hidden" />
              <span class="pay-card__content">
                <img class="pay-card__img" src="https://pdnmghkpepvsfaiqlafk.supabase.co/storage/v1/object/public/nahl%20assets/STC%20PAY%20LOGO.png" alt="STC Pay" />
                <span class="pay-card__label">STC Pay</span>
              </span>
            </label>
            <label class="pay-card" role="radio" aria-checked="false" tabindex="-1" hidden>
              <input type="radio" name="payingMethod" value="cash" class="visually-hidden" />
              <span class="pay-card__content">
                <span class="pay-card__icon" aria-hidden="true">ğŸ’µ</span>
                <span class="pay-card__label" data-i18n="pay.cash"><strong>ÙƒØ§Ø´</strong></span>
              </span>
            </label>
            <label class="pay-card" role="radio" aria-checked="false" tabindex="-1" style="grid-column:1/-1" hidden>
              <input type="radio" name="payingMethod" value="Bank Transfer" class="visually-hidden" />
              <span class="pay-card__content">
                <span class="pay-card__icon" aria-hidden="true">ğŸ¦</span>
                <span class="pay-card__label" data-i18n="pay.bank"><strong>ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ</strong></span>
              </span>
            </label>
            <label class="pay-card" role="radio" aria-checked="false" tabindex="-1" style="grid-column:1/-1">
              <input type="radio" name="payingMethod" value="mada" class="visually-hidden" />
              <span class="pay-card__content">
                <img class="pay-card__img" src="https://pdnmghkpepvsfaiqlafk.supabase.co/storage/v1/object/public/nahl%20assets/MADA%20LOGO.png" alt="Mada" />
                <span class="pay-card__label" data-i18n="pay.mada">Ù…Ø¯Ù‰</span>
              </span>
            </label>
          </div>
          <div class="field-error" id="err-pay" role="alert" aria-live="polite" data-i18n="errors.pay">ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</div>
        </section>

        <!-- 6) Map -->
        <section id="page6" class="page" aria-label="Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…ÙˆÙ‚Ø¹">
          <h1 data-i18n="step.map">Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¹Ù„Ù‰ Ø®Ø±ÙŠØ·Ø© Ù‚ÙˆÙ‚Ù„</h1>
          <div class="card">
            <div class="map-search">
              <input id="mapSearch" class="form-control" type="text" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø¨Ø±Ø¬ØŒ Ø­ÙŠØŒ Ø£Ùˆ Ø¹Ù†ÙˆØ§Ù† Ø¯Ø§Ø®Ù„ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©"/>
              <i class="fa-solid fa-magnifying-glass"></i>
            </div>
            <div id="googleMap"></div>
          </div>
          <div class="card text-center">
            <button id="show-my-location" class="btn btn-outline-primary" type="button" data-i18n="actions.myLoc">Ø¥Ø¸Ù‡Ø§Ø± Ù…ÙˆÙ‚Ø¹ÙŠ</button>
          </div>
          <small id="mapHint" class="text-muted d-block mt-2" style="text-align:center" data-i18n="hints.map">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø£Ùˆ Ø§Ø³Ø­Ø¨ Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ù„ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹Ùƒ</small>
          <div class="field-error" id="err-map" style="text-align:center" data-i18n="errors.map">Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©</div>
        </section>

        <!-- 7) Review Order -->
        <section id="page7" class="page" aria-label="Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø·Ù„Ø¨">
          <h1 data-i18n="step.review">Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø·Ù„Ø¨</h1>
          <div class="card" style="max-width:820px">
            <p class="text-muted mb-3" data-i18n="review.desc">Ø±Ø§Ø¬Ø¹ ØªÙØ§ØµÙŠÙ„ Ø­Ø¬Ø²Ùƒ Ø«Ù… Ø§Ø¶ØºØ· "ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨"</p>

            <div class="d-flex justify-content-between py-2 border-bottom"><span data-i18n="review.area">Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</span><span class="fw-bold" id="rv-area">â€”</span></div>
            <div class="d-flex justify-content-between py-2 border-bottom"><span data-i18n="review.service">Ø§Ù„Ø®Ø¯Ù…Ø©</span><span class="fw-bold" id="rv-service">â€”</span></div>
            <div class="d-flex justify-content-between py-2 border-bottom"><span data-i18n="review.cars">Ø¹Ø¯Ø¯ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</span><span class="fw-bold" id="rv-cars">â€”</span></div>
            <div class="d-flex justify-content-between py-2 border-bottom"><span data-i18n="review.date">Ø§Ù„ØªØ§Ø±ÙŠØ®</span><span class="fw-bold" id="rv-date">â€”</span></div>
            <div class="d-flex justify-content-between py-2 border-bottom"><span data-i18n="review.times">Ø§Ù„Ø£ÙˆÙ‚Ø§Øª</span><span class="fw-bold" id="rv-times">â€”</span></div>
            <div class="d-flex justify-content-between py-2 border-bottom"><span data-i18n="review.name">Ø§Ù„Ø§Ø³Ù…</span><span class="fw-bold" id="rv-name">â€”</span></div>
            <div class="d-flex justify-content-between py-2 border-bottom"><span data-i18n="review.mobile">Ø§Ù„Ø¬ÙˆØ§Ù„</span><span class="fw-bold" id="rv-mobile">â€”</span></div>
            <div class="d-flex justify-content-between py-2 border-bottom" hidden><span data-i18n="review.car">Ø§Ù„Ù…Ø±ÙƒØ¨Ø©</span><span class="fw-bold" id="rv-car">â€”</span></div>
            <div class="d-flex justify-content-between py-2 border-bottom"><span data-i18n="review.addons">Ø§Ù„Ø¥Ø¶Ø§ÙØ§Øª</span><span class="fw-bold" id="rv-addons">â€”</span></div>
            <div class="d-flex justify-content-between py-2 border-bottom"><span data-i18n="review.pay">Ø§Ù„Ø¯ÙØ¹</span><span class="fw-bold" id="rv-pay">â€”</span></div>

            <!-- Order Total -->
            <div class="d-flex justify-content-between py-2 border-top">
              <span data-i18n="review.total">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</span>
              <span class="fw-bold" id="rv-total">â€”</span>
            </div>

            <div class="d-flex gap-2 flex-wrap mt-3">
              <button class="btn btn-outline-secondary" type="button" data-edit-step="2" data-i18n="actions.editService">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø®Ø¯Ù…Ø©</button>
              <button class="btn btn-outline-secondary" type="button" data-edit-step="3" data-i18n="actions.editTime">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙˆÙ‚Øª</button>
              <button class="btn btn-outline-secondary" type="button" data-edit-step="4" data-i18n="actions.editContact">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
              <button class="btn btn-outline-secondary" type="button" data-edit-step="5" data-i18n="actions.editPay">ØªØºÙŠÙŠØ± Ø§Ù„Ø¯ÙØ¹</button>
              <button id="confirmOrder" class="btn btn-primary ms-auto" type="button" data-i18n="actions.confirm">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨</button>
            </div>
          </div>
        </section>

        <!-- 8) Done -->
        <section id="page8" class="page" aria-label="ØªÙ… Ø§Ù„Ø­Ø¬Ø²">
          <h1 data-i18n="done.title">Ø´ÙƒØ±Ø§Ù‹ Ù„ÙƒÙ… ğŸŒŸ</h1>
          <div class="card text-center" style="max-width:720px">
            <p class="mb-3" style="color:#d5d9fb" data-i18n="done.desc">ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨ÙƒÙ…ØŒ ÙˆØ³Ù†Ø¤ÙƒØ¯ Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø¹Ù„Ù‰ ÙˆØ§ØªØ³Ø§Ø¨ Ù‚Ø±ÙŠØ¨Ù‹Ø§.</p>
            <div id="thanks-summary" class="text-start mx-auto" style="max-width:520px">
              <div class="d-flex justify-content-between py-2 border-bottom"><span data-i18n="review.area">Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</span><strong id="ts-area">â€”</strong></div>
              <div class="d-flex justify-content-between py-2 border-bottom"><span data-i18n="review.service">Ø§Ù„Ø®Ø¯Ù…Ø©</span><strong id="ts-service">â€”</strong></div>
              <div class="d-flex justify-content-between py-2 border-bottom"><span data-i18n="review.cars">Ø¹Ø¯Ø¯ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</span><strong id="ts-cars">â€”</strong></div>
              <div class="d-flex justify-content-between py-2"><span data-i18n="done.times">Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯</span><strong id="ts-dt">â€”</strong></div>
              <div class="d-flex justify-content-between py-2"><span data-i18n="done.pay">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</span><strong id="ts-pay">â€”</strong></div>
            </div>
            <div class="d-flex gap-2 justify-content-center mt-3 flex-wrap">
              <a id="ts-whatsapp" class="btn btn-success" target="_blank" rel="noopener"><i class="fa-brands fa-whatsapp"></i> <span data-i18n="actions.share">Ù…Ø´Ø§Ø±ÙƒØ© Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨</span></a>
              <button id="rebook" class="btn btn-primary" type="button" style="min-height:52px;font-weight:800;border-radius:12px;padding:12px 18px" data-i18n="actions.rebook">ğŸ” Ø­Ø¬Ø² Ø¬Ø¯ÙŠØ¯</button>
            </div>
          </div>
        </section>
      </div>
    </div>
  </main>

  <footer id="siteFooter" class="sticky-nav" aria-label="Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„Ø®Ø·ÙˆØ§Øª">
    <div class="footer-inner">
      <div class="footer-brand">
        <span>Ù†Ø­Ù„ â€¢ <a href="https://nahl.app" target="_blank" rel="noopener">Nahl.app</a></span>
        <div class="footer-social">
          <a href="https://wa.me/966509027172" target="_blank" aria-label="WhatsApp"><i class="fa-brands fa-whatsapp"></i></a>
          <a href="https://www.instagram.com/nahl.app?igsh=ZmljaXNncGtudjJ2" target="_blank" aria-label="Instagram"><i class="fa-brands fa-instagram"></i></a>
          <a href="https://www.tiktok.com/@nahl.app?_t=ZS-8zgmzEQTSQW&_r=1" target="_blank" aria-label="TikTok"><i class="fa-brands fa-tiktok"></i></a>
        </div>
      </div>
      <div class="footer-actions">
        <button id="footer-prev" type="button" class="btn-footer hidden" data-i18n="actions.prev">Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
        <button id="footer-next" type="button" class="btn-footer primary disabled" disabled data-i18n="actions.skip">ØªØ®Ø·ÙŠ Ø§Ù„Ø¹Ø±Ø¶</button>
        <div id="footer-wait" class="">
          <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
          <span data-i18n="state.sending">ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨â€¦</span>
        </div>
      </div>
    </div>
  </footer>

  <!-- ===== Additional Services Modal ===== -->
  <div class="modal fade" id="addonsModal" tabindex="-1" aria-labelledby="addonsModalLabel" aria-hidden="true" data-bs-backdrop="static">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content" style="border-radius:16px; background:var(--glass-bg); color:#fff; border:1px solid var(--glass-stroke); backdrop-filter:blur(8px)">
        <div class="modal-header" style="border-bottom:1px solid var(--glass-stroke)">
          <h5 class="modal-title fw-bold" id="addonsModalLabel" data-i18n="addons.title">Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©</h5>
          <button type="button" class="btn-close" style="filter:invert(1) contrast(100%)" data-bs-dismiss="modal" aria-label="Ø¥ØºÙ„Ø§Ù‚"></button>
        </div>
        <div class="modal-body">
          <p class="text-muted mb-2" data-i18n="addons.hint">Ø§Ø®ØªÙŠØ§Ø±ÙŠ â€” Ø§Ø®ØªÙØ± Ù…Ø§ ÙŠÙ†Ø§Ø³Ø¨Ùƒ:</p>
          <div id="addonsChips" class="addon-wrap"></div>
        </div>
        <div class="modal-footer d-flex justify-content-between" style="border-top:1px solid var(--glass-stroke)">
          <button type="button" id="addonsNoThanks" class="btn btn-outline-secondary" data-i18n="addons.no">Ù„Ø§ Ø´ÙƒØ±Ù‹Ø§</button>
          <button type="button" id="addonsConfirm" class="btn btn-primary" data-i18n="addons.confirm">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¥Ø¶Ø§ÙØ§Øª</button>
        </div>
      </div>
    </div>
  </div>

  <!-- libs -->
  <script src="https://code.jquery.com/jquery-3.6.3.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/luxon@3.4.4/build/global/luxon.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/intl-tel-input@24.4.0/build/js/intlTelInputWithUtils.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <!-- ===== Existing Logic (Unchanged) + Theme/I18N helpers appended below ===== -->
<script>
  /* ---------- Logo fallback (unchanged) ---------- */
  function handleLogoError(img){
    const fallbacks = [
      "https://pdnmghkpepvsfaiqlafk.supabase.co/storage/v1/object/public/nahl%20assets/Sponge%20%20Soap/spong&Soap%20-%20logo.png",
      "https://pdnmghkpepvsfaiqlafk.supabase.co/storage/v1/object/public/nahl%20assets/Sponge%20%26%20Soap/spong%26Soap%20-%20logo.png",
      "https://pdnmghkpepvsfaiqlafk.supabase.co/storage/v1/object/public/nahl%20assets/Sponge%20%26%20Soap/logo.png",
      "https://dummyimage.com/180x54/027A93/ffffff.png&text=Sponge+%26+Soap"
    ];
    const i = Number(img.dataset.fidx||0);
    if (i < fallbacks.length){ img.dataset.fidx = String(i+1); img.src = fallbacks[i]; }
    else { img.style.display = 'none'; }
  }

  /* ---------- NAHL API endpoints (unchanged) ---------- */
  const APP_ID='6e6b8ca3-e69a-48de-8522-16a496cc5214';
  const defaultLink2=`https://nahl-platform.vercel.app/api/app/AM/general/${APP_ID}/form`;
  const RESERVE_URL_PRIMARY  =`${defaultLink2}/reserveAppointment`;
  const RESERVE_URL_FALLBACK =`${defaultLink2.replace(/\/form\/?$/,'')}/reserveAppointment`;

  let controllers=[];
  async function callContent2(path, cb, abortable=false, retries=3){
    let signal='';
    if(abortable){
      controllers.forEach(([c])=>c.abort()); controllers=[];
      const controller=new AbortController(); signal=controller.signal; controllers.push([controller,signal]);
    }
    try{
      await new Promise(r=>setTimeout(r, 120));
      const res=await fetch(defaultLink2+path,{method:'GET',redirect:'follow',...(abortable&&{signal}),cache:'no-store'});
      if(!res.ok){ if(retries>0) return callContent2(path,cb,abortable,retries-1); throw new Error('Network');}
      cb(await res.json());
    }catch(e){
      if(!String(e).includes('AbortError') && retries>0) setTimeout(()=>callContent2(path,cb,abortable,retries-1),500);
    }
  }

  function sanitizeNahlPayload(n){
    const toStr = v => (v == null ? '' : String(v).trim());
    return {
      date:               toStr(n.date),
      time:               toStr(n.time),
      location:           toStr(n.location),
      service:            toStr(n.service),
      serviceCount:       toStr(n.serviceCount || '1'),
      serviceCat:         toStr(n.serviceCat),
      customerM:          toStr(n.customerM),
      customerN:          toStr(n.customerN),
      paymentMethod:      toStr((n.paymentMethod||'').toLowerCase()),
      urlLocation:        toStr(n.urlLocation),
      locationDescription:toStr(n.locationDescription),
      locale:             window.__lang || 'ar'
    };
  }

  function showToast(type='info', msg=''){
    const wrap=document.getElementById('toastWrap');
    const div=document.createElement('div');
    div.style.minWidth='260px'; div.style.color='#fff'; div.style.padding='10px 14px';
    div.style.borderRadius='10px'; div.style.boxShadow='var(--shadow-md)';
    div.style.background = type==='error' ? '#dc2626' : type==='success' ? '#16a34a' : '#0284c7';
    div.textContent=msg; wrap.appendChild(div);
    setTimeout(()=>{ div.style.opacity='0'; div.style.transform='translateY(-6px)'; setTimeout(()=>div.remove(), 180); }, 2400);
  }

  /* ---------- Everything from your previous logic remains; below is the original large block ---------- */
</script>

<!-- === BEGIN: ORIGINAL APP LOGIC (unchanged, pasted from your last version) === -->
<script>
  const DateTime=luxon.DateTime;
  const orderedPages=["page1","page2","page3","page4","page5","page6","page7","page8"];
  const STEPS_LABELS=["Ø§Ù„ØªØ±Ø­ÙŠØ¨","Ø§Ù„Ø®Ø¯Ù…Ø©","Ø§Ù„ÙˆÙ‚Øª","Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª","Ø§Ù„Ø¯ÙØ¹","Ø§Ù„Ù…ÙˆÙ‚Ø¹","Ù…Ø±Ø§Ø¬Ø¹Ø©","ØªÙ…"];
  const PAGE_BACKGROUNDS={
    page1:"https://pdnmghkpepvsfaiqlafk.supabase.co/storage/v1/object/public/nahl%20assets/NahlTimeProFrom/NahlDemoBG1.jpg",
    page2:"https://pdnmghkpepvsfaiqlafk.supabase.co/storage/v1/object/public/nahl%20assets/NahlTimeProFrom/NahlDemoBG2.jpg",
    page3:"https://pdnmghkpepvsfaiqlafk.supabase.co/storage/v1/object/public/nahl%20assets/NahlTimeProFrom/NahlDemoBG3.jpg",
    page4:"https://pdnmghkpepvsfaiqlafk.supabase.co/storage/v1/object/public/nahl%20assets/NahlTimeProFrom/NahlDemoBG4.jpg",
    page5:"https://pdnmghkpepvsfaiqlafk.supabase.co/storage/v1/object/public/nahl%20assets/NahlTimeProFrom/NahlDemoBG5.jpg",
    page6:"https://pdnmghkpepvsfaiqlafk.supabase.co/storage/v1/object/public/nahl%20assets/NahlTimeProFrom/NahlDemoBG6.jpg",
    page7:"https://pdnmghkpepvsfaiqlafk.supabase.co/storage/v1/object/public/nahl%20assets/NahlTimeProFrom/NahlDemoBG5.jpg",
    page8:"https://pdnmghkpepvsfaiqlafk.supabase.co/storage/v1/object/public/nahl%20assets/NahlTimeProFrom/NahlDemoBG7.jpg"
  };
  const STEP_GROUP_INDEX={page1:0,page2:1,page3:2,page4:3,page5:4,page6:5,page7:6,page8:7};

  let selectedTime=null;
  let selectedTimes=[];
  let servicesSheetCache=[], categoriesFromSheet=[];
  let itiPhone=null, positionUrl="";
  let lastSelectedISO="";
  let isSubmitting=false;
  let currentTimeFilter='all';
  let selectedAddons = [];
  const nForm={date:'',time:'',location:'',service:'',serviceCount:'1',serviceCat:'',customerM:'',customerN:'',paymentMethod:'',urlLocation:'',locationDescription:'', locale:'ar'};

  function getCarsCount(){ const n=parseInt(nForm.serviceCount||'1',10); return Math.min(Math.max(n||1,1),5); }
  function updateTimeCountHint(){
    const need = getCarsCount();
    const got  = selectedTimes.length;
    const el=document.getElementById('timeCountHint');
    if(el) el.textContent = `${got}/${need} ÙˆÙ‚Øª Ù…Ø­Ø¯Ø¯`;
  }
  function setPageBackground(id){ document.documentElement.style.setProperty('--page-bg', `url("${PAGE_BACKGROUNDS[id]||PAGE_BACKGROUNDS.page1}")`); }

  function getActiveIndex(){ const id=document.querySelector('.page.active')?.id; return Math.max(0, orderedPages.indexOf(id)); }
  function syncProgress(i){
    const pct=((i+1)/orderedPages.length)*100;
    document.getElementById('miniBarFill').style.width=pct+'%';
    document.getElementById('miniStepTitle').textContent=STEPS_LABELS[Math.min(i,STEPS_LABELS.length-1)];
    const prev=document.getElementById('footer-prev');
    const next=document.getElementById('footer-next');
    const wait=document.getElementById('footer-wait');
    const onThanks=(orderedPages[i]==='page8');
    prev.classList.toggle('hidden', i===0 || onThanks);
    next.classList.toggle('hidden', onThanks);
    wait.classList.remove('show');
    next.textContent = (i===0) ? 'ØªØ®Ø·ÙŠ Ø§Ù„Ø¹Ø±Ø¶' : (orderedPages[i]==='page7' ? 'ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨' : 'Ø§Ù„ØªØ§Ù„ÙŠ');
  }

  function renderSummary(currentId){
    const wrap=document.getElementById('summaryChips'); if(!wrap) return;
    const activeId=currentId || (document.querySelector('.page.active')?.id) || 'page1';
    const currGroup=STEP_GROUP_INDEX[activeId] ?? 0;

    wrap.style.display = currGroup === 0 ? 'none' : 'flex';
    if(currGroup===0){ wrap.innerHTML=''; return; }

    const areaTxt=$('#area').find(':selected').text()||'';
    const srvTxt=$('#service').find(':selected').text()||'';
    const dt=nForm.date ? DateTime.fromISO(nForm.date).toFormat('d LLL yyyy') : '';
    const tmChip = selectedTimes.length ? (selectedTimes.length===1 ? selectedTimes[0] : `${selectedTimes.length} Ù…ÙˆØ§Ø¹ÙŠØ¯`) : (nForm.time||'');
    const pay=(nForm.paymentMethod||''); const locOk=!!positionUrl;

    const chips=[
      {i:'fa-location-dot',t:'Ø§Ù„Ù…Ù†Ø·Ù‚Ø©',v:areaTxt,g:1},
      {i:'fa-screwdriver-wrench',t:'Ø§Ù„Ø®Ø¯Ù…Ø©',v:srvTxt,g:1},
      {i:'fa-car',t:'Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª',v:String(getCarsCount()),g:1},
      {i:'fa-puzzle-piece',t:'Ø§Ù„Ø¥Ø¶Ø§ÙØ§Øª',v:(selectedAddons.length?selectedAddons.join('ØŒ '):''),g:1},
      {i:'fa-clock',t:'Ø§Ù„Ù…ÙˆØ¹Ø¯',v:(dt && tmChip)?`${dt} â€¢ ${tmChip}`:'',g:2},
      {i:'fa-credit-card',t:'Ø§Ù„Ø¯ÙØ¹',v:(pay?pay.toUpperCase():''),g:4},
      {i:'fa-map-pin',t:'Ø§Ù„Ù…ÙˆÙ‚Ø¹',v:(locOk?'ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ¯':''),g:5},
    ];

    wrap.innerHTML='';
    chips.filter(c=>c.v && c.g<=currGroup).forEach(c=>{
      const el=document.createElement('div');
      el.className='chip'+(c.g===currGroup?' current':'');
      el.innerHTML=`<i class="fa-solid ${c.i}"></i><span class="title">${c.t}:</span><span class="value">${c.v}</span>`;
      wrap.appendChild(el);
    });
  }

  function showPage(idx){
    const cur=document.querySelector('.page.active');
    const next=document.getElementById(orderedPages[idx]); if(!next||cur===next) return;
    if(cur && cur.id==='page1') stopWelcomeDeck();
    if(cur){ cur.classList.remove('active'); cur.classList.add('exit'); }
    next.style.display='flex';
    requestAnimationFrame(()=>{ next.classList.add('active'); setTimeout(()=>{ if(cur){cur.classList.remove('exit'); cur.style.display='none';} }, 240); });

    if(next.id==='page7') populateReview(); // entering Review
    syncProgress(idx);
    setPageBackground(next.id);
    renderSummary(next.id);
    updateNextAvailability();
    if(next.id==='page1') startWelcomeDeck();
  }

  function setLoadingTimes(on){ document.getElementById('timeLoading').classList.toggle('show', !!on); }
  function setLoadingServices(on){ document.getElementById('servicesLoading').classList.toggle('show', !!on); }

  /* Welcome slideshow */
  let deckTimers=[]; let deckIndex=0; let deckRunning=false;
  const SLIDE_MS=2600; const GAP_MS=220;
  function startWelcomeDeck(){
    const deck=document.getElementById('pptDeck'); if(!deck) return;
    const slides=[...deck.querySelectorAll('.ppt-slide')];
    const dotsWrap=document.getElementById('pptDots');
    dotsWrap.innerHTML=slides.map((_,i)=>`<span class="ppt-dot${i===0?' active':''}"></span>`).join('');
    const dots=[...dotsWrap.children];

    const setActive=(i,ex=-1)=>{
      slides.forEach((s,idx)=>{ s.classList.remove('is-active','is-exiting'); if(idx===i){s.classList.add('is-active'); s.style.zIndex=2;} else if(idx===ex){s.classList.add('is-exiting'); s.style.zIndex=1;} else{s.style.zIndex=0;} });
      dots.forEach((d,idx)=>d.classList.toggle('active', idx===i));
    };
    deckRunning=true; deckIndex=0; setActive(0,-1);
    const advance=()=>{ if(!deckRunning) return; const prev=deckIndex; deckIndex++; if(deckIndex>=slides.length){ stopWelcomeDeck(); showPage(1); return; } setActive(deckIndex,prev); schedule(); };
    const schedule=()=>{ deckTimers.push(setTimeout(advance, SLIDE_MS+GAP_MS)); };
    schedule();
  }
  function stopWelcomeDeck(){ deckRunning=false; deckTimers.forEach(clearTimeout); deckTimers=[]; }

  function isSpecialPlate(num){
    if(!/^\d+$/.test(num) || num.length < 3) return false;
    const same = /^(\d)\1+$/.test(num);
    const asc  = ('01234567890123456789').includes(num);
    const desc = ('98765432109876543210').includes(num);
    const pal  = num === num.split('').reverse().join('');
    const pairRepeat = (num.length%2===0) && /^(\d{2})\1+$/.test(num);
    return same || asc || desc || pal || pairRepeat;
  }
  function updatePlateHint(){
    const raw = ($('#plateNumber').val()||'');
    const v   = raw.replace(/\D/g,'');
    $('#plateNumber').val(v);
    const txt = v ? (isSpecialPlate(v) ? 'Ø±Ù‚Ù… Ù…Ù…ÙŠØ² ğŸ‘Œ â€” Ù…Ù…ØªØ§Ø² Ù„Ù„ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø³Ø±ÙŠØ¹.' : 'Ø§Ø®ØªÙŠØ§Ø±ÙŠ â€” ÙŠØ³Ø§Ø¹Ø¯ ÙØ±ÙŠÙ‚Ù†Ø§ Ø¹Ù„Ù‰ Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ù…Ø±ÙƒØ¨ØªÙƒ.')
                  : 'Ø§Ø®ØªÙŠØ§Ø±ÙŠ â€” ÙŠØ³Ø§Ø¹Ø¯ ÙØ±ÙŠÙ‚Ù†Ø§ Ø¹Ù„Ù‰ Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ù…Ø±ÙƒØ¨ØªÙƒ';
    $('#plateHelp').text(txt);
    const pe=document.getElementById('err-plate'); if(pe) pe.style.display='none';
  }

  function parseTimeToLuxon(raw){
    let t=DateTime.fromISO(String(raw||'').trim(),{setZone:true});
    if(!t.isValid) t=DateTime.fromFormat(String(raw||''),'HH:mm:ss',{setZone:true});
    if(!t.isValid) t=DateTime.fromFormat(String(raw||''),'H:mm a',{setZone:true});
    if(!t.isValid) t=DateTime.fromFormat(String(raw||''),'H:mm',{setZone:true});
    return t.isValid?t:null;
  }
  function timeInMins(h, m){ return (h*60)+m }
  function passesFilter(mins){
    if(currentTimeFilter==='all') return true;
    if(currentTimeFilter==='morning')   return mins>=timeInMins(6,0)  && mins<timeInMins(11,0);
    if(currentTimeFilter==='afternoon') return mins>=timeInMins(11,0) && mins<timeInMins(16,0);
    if(currentTimeFilter==='evening')   return mins>=timeInMins(16,0) && mins<timeInMins(21,0);
    if(currentTimeFilter==='night')     return mins>=timeInMins(21,0) && mins<timeInMins(24,0);
    return true;
  }

  let dayTimes=[]; let timesLoaded=false; let lastSelectedDateISO='';
  function fetchTimesForSelectedDate(){
    const dateEl=document.getElementById('date');
    const timeContainer=document.getElementById('time-container');
    const loc=$('#area').val()||''; const srv=$('#service').val()||'';
    const selectedISO=(dateEl.value||DateTime.now().toFormat('yyyy-LL-dd')).trim();
    lastSelectedISO=selectedISO; lastSelectedDateISO=selectedISO;

    selectedTime=null; selectedTimes=[]; updateTimeCountHint();

    if(!loc||!srv){
      timeContainer.innerHTML=`<div style="grid-column:1/-1;justify-self:center" class="text-muted">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø·Ù‚Ø© ÙˆØ§Ù„Ø®Ø¯Ù…Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯</div>`;
      updateNextAvailability(); return;
    }

    dateEl.disabled=true; setLoadingTimes(true);
    timeContainer.innerHTML=`<div class="spinner-border text-info" role="status" style="grid-column:1/-1;justify-self:center;"></div>`;

    const now=DateTime.now().setZone('Asia/Riyadh');
    const isToday=selectedISO===now.toISODate();

    const qs=`/appointments?startDate=${encodeURIComponent(selectedISO)}&location=${encodeURIComponent(loc)}&service=${encodeURIComponent(srv)}&onlyAvailable=1`;
    callContent2(qs,(res)=>{
      const rows=(res?.data?.appointments||[]);
      const filtered=rows.filter(r=>{
        const d=DateTime.fromISO(r.TS_appointment_date,{setZone:true}); if(!d.isValid||d.toISODate()!==selectedISO) return false;
        const t=parseTimeToLuxon(r.TS_appointment_time); if(!t) return false;
        const f=(typeof r.isAvailable==='boolean')?r.isAvailable:undefined;
        const s=String(r.TS_status||r.status||r.TS_appointment_status||'').toLowerCase();
        const b=Number(r.TS_booked ?? r.booked); const c=Number(r.TS_capacity ?? r.capacity);
        let rem=Number(r.TS_remaining ?? r.remaining);
        if(!Number.isFinite(rem)&&Number.isFinite(c)&&Number.isFinite(b)) rem=c-b;
        const open=f===true||['available','open','free','empty','vacant','canceled'].includes(s)||(Number.isFinite(rem)?rem>0:(f!==false&&!s));
        if(!open) return false;
        if(isToday){ const slot=now.set({hour:t.hour,minute:t.minute,second:0}); if(slot<now.plus({minutes:5})) return false; }
        return true;
      });

      const list=filtered.map(r=>{
        const t=parseTimeToLuxon(r.TS_appointment_time);
        const mins = t.hour*60 + t.minute;
        return {label:t.toLocaleString(DateTime.TIME_SIMPLE), h:t.hour, m:t.minute, mins};
      });

      const seen=new Set();
      dayTimes=list.filter(x=>{ if(seen.has(x.mins)) return false; seen.add(x.mins); return true; });
      timesLoaded=true;

      renderSelectedDateTimes(selectedISO);
      dateEl.disabled=false; setLoadingTimes(false);
    }, true);
  }

  function renderSelectedDateTimes(selectedISO){
    const timeContainer=document.getElementById('time-container');
    timeContainer.innerHTML='';
    if(!timesLoaded){
      timeContainer.innerHTML=`<div class="spinner-border text-info" role="status" style="grid-column:1/-1;justify-self:center;"></div>`;
      return;
    }
    const viewList = dayTimes.filter(x=>passesFilter(x.mins)).sort((a,b)=> a.mins - b.mins);
    if(!viewList.length){
      timeContainer.innerHTML=`<div style="grid-column:1/-1;justify-self:center" class="text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø¶Ù…Ù† Ø§Ù„ÙÙ„ØªØ± Ø§Ù„Ù…Ø­Ø¯Ø¯</div>`;
      return;
    }

    /* Auto-select first available slot(s) â€” retained */
    if (selectedTimes.length === 0) {
      const limit = getCarsCount();
      selectedTimes = viewList.slice(0, limit).map(t =>
        luxon.DateTime.fromObject({hour:t.h, minute:t.m}).toFormat('HH:mm')
      );
      nForm.date = selectedISO;
      selectedTime = selectedTimes[0] ? { ui: selectedTimes[0], iso: selectedTimes[0] } : null;
      updateTimeCountHint();
      renderSummary('page3');
      updateNextAvailability();
    }

    const limit = getCarsCount();
    viewList.forEach(t=>{
      const btn=document.createElement('button');
      btn.type='button'; btn.className='time-option'; btn.setAttribute('role','button'); btn.setAttribute('aria-pressed','false'); btn.setAttribute('dir','ltr');
      btn.textContent=t.label;
      const hhmm = DateTime.fromObject({hour:t.h,minute:t.m}).toFormat('HH:mm');
      const reflect = () => { const on = selectedTimes.includes(hhmm); btn.setAttribute('aria-pressed', on ? 'true' : 'false'); };
      reflect();
      btn.addEventListener('click',()=>{
        const idx = selectedTimes.indexOf(hhmm);
        if (idx >= 0) selectedTimes.splice(idx,1);
        else{
          if (selectedTimes.length >= limit) { showToast('error', `Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø®ØªÙŠØ§Ø± Ø£ÙƒØ«Ø± Ù…Ù† ${limit} ÙˆÙ‚Øª`); return; }
          selectedTimes.push(hhmm);
        }
        reflect();
        nForm.date = selectedISO;
        selectedTime = selectedTimes[0] ? { ui: hhmm, iso: hhmm } : null;
        updateTimeCountHint();
        renderSummary('page3');
        updateNextAvailability();
      });
      timeContainer.appendChild(btn);
    });
  }

  function installResizeObservers(){
    const header=document.getElementById('siteHeader');
    const footer=document.getElementById('siteFooter');
    const ro=new ResizeObserver(entries=>{
      entries.forEach(entry=>{
        if(entry.target.id==='siteHeader') document.documentElement.style.setProperty('--header-h', entry.contentRect.height+'px');
        if(entry.target.id==='siteFooter') document.documentElement.style.setProperty('--footer-h', entry.contentRect.height+'px');
      });
    });
    header && ro.observe(header); footer && ro.observe(footer);
  }

  const GAS_BASE = 'https://script.google.com/macros/s/AKfycbwMXUFLd6th5C6cK7E999aTdHXuWHcUOq7KzGzxJE4RUaEt2tWNg98p98hXqYCTE-F7YQ/exec';
  function jsonp(url, timeoutMs = 12000){
    return new Promise((resolve,reject)=>{
      const cb = 'jsonp_cb_' + Math.random().toString(36).slice(2);
      let s;
      const timer = setTimeout(() => { cleanup(); reject(new Error('JSONP timeout')); }, timeoutMs);
      function cleanup(){ clearTimeout(timer); try { delete window[cb]; } catch(_) {} if (s && s.parentNode) s.parentNode.removeChild(s); }
      window[cb] = (data) => { cleanup(); resolve(data); };
      const sep = url.includes('?') ? '&' : '?';
      const src = `${url}${sep}callback=${cb}&_=${Date.now()}`;
      s = document.createElement('script'); s.src = src; s.async = true; s.onerror = () => { cleanup(); reject(new Error('JSONP network error')); };
      document.head.appendChild(s);
    });
  }
  async function fetchAllServicesFromGAS(){
    const url = `${GAS_BASE}?action=serviceMetaAll`;
    const res = await jsonp(url);
    let arr=[];
    if (res?.ok && Array.isArray(res.data)) arr = res.data;
    else if (res?.ok && res.data && typeof res.data === 'object') arr = Object.values(res.data);
    else throw new Error('Bad GAS payload for serviceMetaAll');
    return arr.map(r => ({ ...r, TS_service_id: String(r.TS_service_id ?? '') }));
  }

  const arCurrency = new Intl.NumberFormat('ar-SA', { style:'currency', currency:'SAR' });
  function toArrayTags(x){
    if (Array.isArray(x)) return x.map(t=>String(t).trim()).filter(Boolean);
    if (x == null) return [];
    return String(x).split(/[\n,ØŒ,|/]+/).map(s=>s.trim()).filter(Boolean);
  }
  function getServiceMeta(s){
    const img  = s.TS_image_url || '';
    const desc = s.TS_service_description_ar || '';
    const cat  = s.TS_category_arabic_name || '';
    const priceNumRaw = (s.TS_price != null && s.TS_price !== '') ? String(s.TS_price) : '';
    const priceNum    = priceNumRaw ? Number(priceNumRaw.replace(/[^\d.]/g,'')) : NaN;
    const priceText   = s.TS_price_text || '';
    let tags = toArrayTags(s.TS_price_tags || '');
    if (!isNaN(priceNum)) tags.unshift(arCurrency.format(priceNum));
    else if (priceText)   tags.unshift(String(priceText));
    return { img, desc, tags, category: cat };
  }
  function getServicePrice(serviceId){
    const row = servicesSheetCache.find(r => String(r.TS_service_id) === String(serviceId));
    if(!row) return 0;
    const raw = (row.TS_price != null && row.TS_price !== '') ? String(row.TS_price) : '';
    const num = raw ? Number(raw.replace(/[^\d.]/g,'')) : NaN;
    return Number.isFinite(num) ? num : 0;
  }
  function getAddonsPrice(addons){
    let sum = 0;
    addons.forEach(label=>{
      const m = String(label).match(/(\d+(?:\.\d+)?)/g);
      if(m){ m.forEach(x=>{ const v=Number(x); if(Number.isFinite(v)) sum+=v; }); }
    });
    return sum;
  }
  function computeOrderTotal(){
    const serviceId = nForm.service || $('#service').val() || '';
    const main = getServicePrice(serviceId);
    const addonsSum = getAddonsPrice(selectedAddons);
    const cars = getCarsCount();
    const total = (main + addonsSum) * cars;
    return { main, addonsSum, cars, total, formatted: arCurrency.format(total) };
  }

  function createSkeletonCards(n=6){
    const wrap = document.getElementById('serviceCards');
    if (!wrap) return;
    wrap.innerHTML='';
    for (let i=0;i<n;i++){
      const sk=document.createElement('div');
      sk.className='svc-skel'; sk.setAttribute('aria-hidden','true');
      wrap.appendChild(sk);
    }
    const empty=document.getElementById('svcEmpty'); const err=document.getElementById('svcError');
    if (empty) empty.style.display='none'; if (err) err.style.display='none';
  }
  function clearSkeletons(){ const wrap=document.getElementById('serviceCards'); if (wrap) wrap.innerHTML=''; }
  function updateRovingTabindex(selectedId){
    document.querySelectorAll('#serviceCards .svc-card').forEach(c=>{
      const sel = c.dataset.serviceId === String(selectedId);
      c.setAttribute('tabindex', sel ? '0':'-1');
      c.setAttribute('aria-checked', sel ? 'true':'false');
      c.classList.toggle('selected', sel);
    });
  }
  function onCardKeydown(e){
    const cards=[...document.querySelectorAll('#serviceCards .svc-card')];
    const cur=e.currentTarget; const idx=cards.indexOf(cur);
    if(idx<0) return;
    const gridCols=(getComputedStyle(document.querySelector('.svc-grid')).gridTemplateColumns||'').split(' ').length||3;
    if(e.key==='ArrowRight'||e.key==='ArrowDown'){ e.preventDefault(); (cards[Math.min(cards.length-1, idx+(e.key==='ArrowRight'?1:gridCols))]||cur).focus(); }
    else if(e.key==='ArrowLeft'||e.key==='ArrowUp'){ e.preventDefault(); (cards[Math.max(0, idx-(e.key==='ArrowLeft'?1:gridCols))]||cur).focus(); }
    else if(e.key===' '||e.key==='Enter'){ e.preventDefault(); chooseServiceCard(cur,{focus:true,announce:true}); }
  }
  function buildCardDOM(service, meta){
    const card=document.createElement('div');
    card.className='svc-card'; card.setAttribute('role','radio'); card.setAttribute('aria-checked','false'); card.setAttribute('tabindex','-1');
    card.dataset.serviceId=String(service.TS_service_id);

    const thumb=document.createElement('div'); thumb.className='svc-thumb';
    if(meta.img){
      const img=document.createElement('img');
      img.src=meta.img; img.alt=service.TS_service_arabic_name||('Ø®Ø¯Ù…Ø© '+service.TS_service_id);
      img.loading='lazy'; img.decoding='async'; img.width=88; img.height=88;
      img.onerror=()=>{ thumb.textContent='ğŸ§¼'; }; thumb.appendChild(img);
    }else{ thumb.textContent='ğŸ§¼'; }

    const body=document.createElement('div'); body.className='svc-body';
    const titleRow=document.createElement('div'); titleRow.className='svc-title-row';
    const ttl=document.createElement('div'); ttl.className='svc-title'; ttl.textContent=service.TS_service_arabic_name||service.TS_service_id;
    titleRow.appendChild(ttl);
    const catText = meta.category;
    if(catText){ const cat=document.createElement('span'); cat.className='svc-cat'; cat.innerHTML='<i class="fa-solid fa-layer-group"></i> '+catText; titleRow.appendChild(cat); }
    const desc=document.createElement('p'); desc.className='svc-desc'; desc.textContent=meta.desc||'';
    const tagsRow=document.createElement('div'); tagsRow.className='tag-row';
    (meta.tags||[]).forEach((t,i)=>{ const chip=document.createElement('span'); chip.className='price-tag'+(i%2?' alt':''); chip.textContent=t; tagsRow.appendChild(chip); });

    const cta=document.createElement('div'); cta.className='svc-cta'; cta.innerHTML='<i class="fa-solid fa-circle-check"></i>';
    body.appendChild(titleRow); body.appendChild(desc); body.appendChild(tagsRow);
    card.appendChild(thumb); card.appendChild(body); card.appendChild(cta);

    card.addEventListener('click',()=>chooseServiceCard(card,{focus:true,announce:true}));
    card.addEventListener('keydown',onCardKeydown);
    return card;
  }
  function chooseServiceCard(card,{focus=false,announce=false}={}){
    const id=card?.dataset?.serviceId; if(!id) return;
    $('#service').val(id).trigger('change.select2');
    nForm.service=id; updateRovingTabindex(id);
    if(focus) card.focus(); renderSummary('page2'); updateNextAvailability();
    const name=card.querySelector('.svc-title')?.textContent||''; const catText=$('#serviceCat').find(':selected').text()||'';
    window.dispatchEvent(new CustomEvent('service:selected',{detail:{id,name,category:catText}}));
    if(announce) showToast('success','ØªÙ… Ø§Ø®ØªÙŠØ§Ø±: '+name);
  }
  function getServiceMetaFor(s){ return getServiceMeta(s); }

  async function renderServiceCardsByCategory_FromSheet(categoryName){
    const wrap=document.getElementById('serviceCards'); if(!wrap) return;
    const empty=document.getElementById('svcEmpty'); const err=document.getElementById('svcError'); const retry=document.getElementById('svcRetry');
    if(empty) empty.style.display='none'; if(err) err.style.display='none';
    clearSkeletons(); createSkeletonCards(6);

    const list = servicesSheetCache
      .filter(s => String(s.TS_category_arabic_name||'').trim() === String(categoryName||'').trim())
      .sort((a,b)=> Number(a.TS_service_id) - Number(b.TS_service_id));

    const $svc=$('#service'); $svc.empty().select2?.({width:'100%',placeholder:'',dir:'rtl'});

    if(!list.length){
      clearSkeletons(); if(empty) empty.style.display='block';
      nForm.service=''; selectedAddons=[]; renderSummary('page2'); updateNextAvailability(); return;
    }

    clearSkeletons();
    list.forEach(s=>{
      const id=String(s.TS_service_id);
      const name=s.TS_service_arabic_name || `Ø®Ø¯Ù…Ø© ${id}`;
      $svc.append(new Option(name, id, false, false));
      const meta=getServiceMetaFor(s);
      wrap.appendChild(buildCardDOM(s, meta));
    });

    const currentSel=$('#service').val();
    const toSelect = (currentSel && list.some(s=>String(s.TS_service_id)===String(currentSel)))
      ? String(currentSel)
      : String(list[0].TS_service_id);

    $('#service').val(toSelect).trigger('change.select2');
    updateRovingTabindex(toSelect);
    nForm.service=toSelect; selectedAddons=[];
    renderSummary('page2'); updateNextAvailability();

    if(retry) retry.onclick=()=>renderServiceCardsByCategory_FromSheet(categoryName);
  }

  function toArrayTagsSafe(s){ return toArrayTags(s); }
  function getAddonsForService(serviceId){
    const row = servicesSheetCache.find(r => String(r.TS_service_id) === String(serviceId));
    const raw = row?.TS_addons || row?.TS_additional_services || row?.TS_additional_services_ar || '';
    let list = toArrayTagsSafe(raw);
    if (!list.length){
      list = ['ØºØ³ÙŠÙ„ Ø¨ØµØ§Ø¨ÙˆÙ† Ø§Ù„Ù†Ø§Ù†Ùˆ - 10 Ø±ÙŠØ§Ù„ +'];
    }
    const seen = new Set(); const clean = [];
    list.forEach(s=>{ const t=s.trim(); if(t && !seen.has(t)){ seen.add(t); clean.push(t); } });
    return clean;
  }
  function openAddonsModalFor(serviceId){
    const modalEl = document.getElementById('addonsModal');
    const chipsWrap = document.getElementById('addonsChips');
    chipsWrap.innerHTML = '';
    const addons = getAddonsForService(serviceId);
    addons.forEach((label) => {
      const chip = document.createElement('button');
      chip.type = 'button'; chip.className = 'btn btn-sm btn-outline-secondary';
      chip.style.borderRadius = '999px';
      chip.style.minHeight = '38px';
      chip.textContent = label; chip.dataset.value = label; chip.setAttribute('aria-pressed','false');
      chip.addEventListener('click', ()=>{
        const p=chip.getAttribute('aria-pressed')==='true';
        chip.setAttribute('aria-pressed', String(!p));
        if (p) chip.classList.add('btn-outline-secondary');
        else chip.classList.remove('btn-outline-secondary');
      });
      chipsWrap.appendChild(chip);
    });
    const bsModal = bootstrap.Modal.getOrCreateInstance(modalEl);
    document.getElementById('addonsNoThanks').onclick = ()=>{ selectedAddons = []; bsModal.hide(); renderSummary('page2'); updateNextAvailability(); };
    document.getElementById('addonsConfirm').onclick = ()=>{
      selectedAddons = [...chipsWrap.querySelectorAll('.btn[aria-pressed="true"]')].map(el=>el.dataset.value);
      bsModal.hide(); renderSummary('page2'); updateNextAvailability();
    };
    bsModal.show();
  }
  window.addEventListener('service:selected', (ev) => { const { id } = ev.detail || {}; openAddonsModalFor(id); });

  const NAHL_CAT_MAP = new Map();
  function updateServiceCatIdFromName(){
    const areaId = $('#area').val();
    const catName = ($('#serviceCat').val() || '').trim();
    const map = NAHL_CAT_MAP.get(String(areaId));
    const id = map?.get(catName);
    nForm.serviceCat = id ? String(id) : '';
  }

  function composeLocationDescription(){
    const parts = [];
    const brand = $('#carBrand').val() || '';
    const car   = $('#carName').val() || '';
    const plate = $('#plateNumber').val() || '';
    const base = [brand, car, plate].filter(Boolean).join(', ');
    if (base) parts.push(base);
    if (selectedAddons.length) parts.push('Ø¥Ø¶Ø§ÙØ§Øª: ' + selectedAddons.join('ØŒ '));
    const final = parts.join(' | ');
    $('#locationDescription').val(final);
    nForm.locationDescription = final;
  }

  $(function () {
    installResizeObservers();

    Object.values(PAGE_BACKGROUNDS).forEach(src => { const i = new Image(); i.src = src; });

    // Select2
    $('#area').select2({ width: '100%', placeholder: 'Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø·Ù‚Ø©', dir: 'rtl' });
    $('#serviceCat').select2({ width: '100%', placeholder: 'ÙØ¦Ø© Ø§Ù„Ø®Ø¯Ù…Ø©', dir: 'rtl' });
    $('#service').select2({ width: '100%', placeholder: 'Ø¨Ø§Ù‚ØªÙƒ Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©', dir: 'rtl', minimumResultsForSearch: Infinity });
    $('#carBrand').select2({ width: '100%', placeholder: 'Ù…Ø§Ø±ÙƒØ© Ø§Ù„Ù…Ø±ÙƒØ¨Ø©', dir: 'rtl' });
    $('#numCars').select2({ width: '100%', placeholder: 'Ø¹Ø¯Ø¯ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª', dir: 'rtl', minimumResultsForSearch: Infinity });
    $('#area, #serviceCat, #service, #carBrand, #numCars').on('select2:open', () => { $('.select2-search__field').attr('dir', 'rtl'); });

    $('#numCars').on('change', function(){
      const v = parseInt(this.value||'1',10);
      const clamped = Math.min(Math.max(v||1,1),5);
      nForm.serviceCount = String(clamped);
      $('#serviceCount').val(String(clamped));
      if (selectedTimes.length > clamped) { selectedTimes = selectedTimes.slice(0, clamped); renderSelectedDateTimes(lastSelectedDateISO); }
      updateTimeCountHint(); renderSummary('page2'); updateNextAvailability();
    });

    itiPhone = window.intlTelInput(document.querySelector('#mobile'), {
      initialCountry: 'sa', onlyCountries: ['sa','ae','bh','kw','om','qa'],
      separateDialCode: true, placeholderNumberType: 'MOBILE',
      utilsScript: 'https://cdn.jsdelivr.net/npm/intl-tel-input@24.4.0/build/js/utils.js'
    });
    $('#mobile').on('blur', () => { if (itiPhone && itiPhone.isValidNumber()) { nForm.customerM = itiPhone.getNumber().replace(/^\+/, ''); $('#err-mobile').hide(); } else { $('#err-mobile').show(); } });

    $('#name').on('input', function () { nForm.customerN = this.value.trim(); renderSummary('page4'); updateNextAvailability(); });
    $('#mobile').on('input', function () { renderSummary('page4'); updateNextAvailability(); });
    $('#carName').on('input', function () { updateNextAvailability(); composeLocationDescription(); });
    $('#plateNumber').on('input', function () { updatePlateHint(); renderSummary('page4'); updateNextAvailability(); composeLocationDescription(); });

    const today = DateTime.now().toFormat('yyyy-LL-dd');
    $('#date').val(today).attr('min', today);
    $('#date').on('change', () => { fetchTimesForSelectedDate(); renderSummary('page3'); });
    $('#timeFilter').on('change', function () { currentTimeFilter = this.value; renderSelectedDateTimes(lastSelectedDateISO); });

    setLoadingServices(true);
    callContent2(`/locations`, res => {
      const list = res?.data || [];
      const ds = list.map(l => ({ id: l.id, text: l.TS_location_arabic_name }));
      $('#area').empty().select2({ data: ds, width: '100%', placeholder: 'Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø·Ù‚Ø©', dir: 'rtl' });
      if (ds.length) $('#area').val(ds[0].id).trigger('change');
      else { showToast('error', 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†Ø§Ø·Ù‚ Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹'); }
      renderSummary('page2');
    });

    (async () => {
      setLoadingServices(true);
      const MAX = 3; let attempt=0; let success=false; let lastErr=null;
      while(attempt<MAX && !success){
        try{
          const rows = await fetchAllServicesFromGAS();
          servicesSheetCache = rows;
          const uniq = [...new Set(rows.map(r => String(r.TS_category_arabic_name || '').trim()).filter(Boolean))];
          categoriesFromSheet = uniq;
          const catOptions = uniq.map(name => ({ id: name, text: name }));
          $('#serviceCat').empty().select2({ data: catOptions, width: '100%', placeholder: 'ÙØ¦Ø© Ø§Ù„Ø®Ø¯Ù…Ø©', dir: 'rtl' });
          if (catOptions.length) $('#serviceCat').val(catOptions[0].id).trigger('change');
          else {
            $('#serviceCat').val(null).trigger('change');
            $('#service').val(null).trigger('change.select2');
            document.getElementById('serviceCards').innerHTML = '';
            document.getElementById('svcEmpty').style.display = 'block';
          }
          success=true;
        }catch(e){ lastErr=e; attempt++; if(attempt<MAX) await new Promise(r=>setTimeout(r, 600*attempt)); }
      }
      setLoadingServices(false);
      if(!success){
        console.error('Failed to fetch services from GAS', lastErr);
        document.getElementById('svcError').style.display='block';
        document.getElementById('svcRetry')?.addEventListener('click', ()=>location.reload());
      }
      renderSummary('page2'); updateNextAvailability();
    })();

    $('#area').on('change', function () {
      const areaId = this.value;
      nForm.location = areaId;
      callContent2(`/services?location=${encodeURIComponent(areaId)}`, (res) => {
        const catsArr = res?.data?.servicesCat || res?.data?.categories || [];
        const map = new Map();
        catsArr.forEach(c => { const name = String(c.TS_category_arabic_name || '').trim(); const id = c.TS_category_id; if (name) map.set(name, id); });
        NAHL_CAT_MAP.set(String(areaId), map);
        updateServiceCatIdFromName();
      }, true);
      renderSummary('page2'); updateNextAvailability();
    });

    $('#serviceCat').on('change', function () {
      renderServiceCardsByCategory_FromSheet(this.value);
      updateServiceCatIdFromName();
      renderSummary('page2'); updateNextAvailability();
    });

    $('#service').on('change', function () {
      nForm.service = this.value || '';
      const wrap = document.getElementById('serviceCards');
      if (wrap && this.value) {
        updateRovingTabindex(this.value);
        const sel = [...wrap.children].find(el=>el.dataset?.serviceId===String(this.value));
        sel && sel.scrollIntoView({ block: 'nearest' });
      }
      renderSummary('page2'); updateNextAvailability();
      composeLocationDescription();
    });

    const brands=['Changan','Hyundai','Kia','Toyota','Nissan','Chevrolet','GMC','Mercedes-Benz','BMW','Audi','Lexus','Land Rover (Range Rover)','Porsche','Genesis','Cadillac','Infiniti','Ford','Honda','Mazda','Mitsubishi','Other'].map(b=>({id:b,text:b}));
    $('#carBrand').empty().select2({ data: brands, width: '100%', placeholder: 'Ø§Ø®ØªØ± Ù…Ø§Ø±ÙƒØ© Ø§Ù„Ù…Ø±ÙƒØ¨Ø©', dir: 'rtl' });

    document.getElementById('footer-next').addEventListener('click', gotoNext);
    document.getElementById('footer-prev').addEventListener('click', () => { const i = getActiveIndex(); showPage(Math.max(i - 1, 0)); });

    const payCards = [...document.getElementById('payGroup').querySelectorAll('.pay-card')];
    payCards.forEach((card) => {
      const input = card.querySelector('input');
      const choose = () => {
        payCards.forEach(c => { c.setAttribute('aria-checked', 'false'); c.setAttribute('tabindex', '-1'); c.querySelector('input').checked = false; });
        card.setAttribute('aria-checked', 'true'); card.setAttribute('tabindex', '0'); input.checked = true;
        nForm.paymentMethod = input.value; renderSummary('page5'); updateNextAvailability();
        showPage(5);
      };
      card.addEventListener('click', choose);
      card.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); choose(); } });
    });

    document.getElementById('confirmOrder').addEventListener('click', submitAllAppointments);
    $('#rebook').on('click', () => location.href = '/');

    setPageBackground('page1'); renderSummary('page1'); syncProgress(0); startWelcomeDeck();
    nForm.serviceCount = '1'; updateTimeCountHint();
  });

  function updateNextAvailability(){
    const i=getActiveIndex(); const nextBtn=document.getElementById('footer-next'); let enable=true;
    if(i===0){ enable=true; }
    else if(i===1){ enable=!!($('#area').val()&&$('#service').val()&&$('#numCars').val()); }
    else if(i===2){
      const need = getCarsCount();
      enable = selectedTimes.length === need;
    }
    else if(i===3){ const nameOk=($('#name').val()||'').trim().length>0; enable=nameOk && (window.itiPhone ? itiPhone.isValidNumber() : true); }
    else if(i===4){ enable=!!(document.querySelector('#payGroup input:checked')); }
    else if(i===5){ enable=!!positionUrl; }
    else if(i===6){ enable=true; }
    nextBtn.disabled=!enable; nextBtn.classList.toggle('disabled',!enable);
  }

  async function gotoNext(){
    const i = getActiveIndex(); const id = orderedPages[i];
    if (id === 'page1') { stopWelcomeDeck(); showPage(1); return; }

    if (id === 'page2') {
      const areaOk = !!$('#area').val(), catOk = !!$('#serviceCat').val(), svcOk = !!$('#service').val();
      const carsOk = !!$('#numCars').val();
      $('#err-area').toggle(!areaOk); $('#err-serviceCat').toggle(!catOk); $('#err-service').toggle(!svcOk); $('#err-numCars').toggle(!carsOk);
      if (!areaOk || !catOk || !svcOk || !carsOk) { showToast('error', 'ÙŠØ±Ø¬Ù‰ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù†Ø·Ù‚Ø©/Ø§Ù„ØªØµÙ†ÙŠÙ/Ø§Ù„Ø®Ø¯Ù…Ø©/Ø¹Ø¯Ø¯ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª'); return; }
      nForm.serviceCount = String(getCarsCount());
      document.getElementById('date').dispatchEvent(new Event('change'));
      showPage(2); return;
    }

    if (id === 'page3') {
      const need = getCarsCount();
      if (selectedTimes.length !== need) { showToast('error', `Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± ${need} ÙˆÙ‚Øª`); return; }
      nForm.date = lastSelectedISO;
      showPage(3); return;
    }

    if (id === 'page4') {
      const nameOk = ($('#name').val() || '').trim().length > 0;
      const phoneOk = itiPhone && itiPhone.isValidNumber();
      $('#err-name').toggle(!nameOk); $('#err-mobile').toggle(!phoneOk);
      if (!nameOk || !phoneOk) { showToast('error', 'ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ø³Ù… ÙˆØ±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„'); return; }
      nForm.customerN = $('#name').val().trim();
      nForm.customerM = itiPhone.getNumber().replace(/^\+/, '');
      const carBits = [$('#carBrand').val() || '', $('#carName').val() || '', $('#plateNumber').val() || ''].filter(Boolean);
      const extraBits = (window.additionalServicesSelected || []).map(x => x.label);
      const combined = [...carBits, ...(extraBits.length ? ['Ø®Ø¯Ù…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©: ' + extraBits.join('ØŒ ')] : [])].join(', ');
      nForm.locationDescription = combined;
      showPage(4); return;
    }

    if (id === 'page5') {
      if (!nForm.paymentMethod) { $('#err-pay').show(); showToast('error', 'Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹'); return; }
      $('#err-pay').hide(); showPage(5); return;
    }

    if (id === 'page6') {
      if (!positionUrl) { $('#err-map').show(); showToast('error', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹'); return; }
      $('#err-map').hide(); nForm.urlLocation = positionUrl;
      showPage(6); return;
    }

    if (id === 'page7') {
      await submitAllAppointments();
      return;
    }

    showPage(Math.min(i + 1, orderedPages.length - 1));
  }

  function populateReview(){
    const area = $('#area').find(':selected').text() || 'â€”';
    const srv  = $('#service').find(':selected').text() || 'â€”';
    const cars = String(getCarsCount());
    const dateTxt = nForm.date ? luxon.DateTime.fromISO(nForm.date).toFormat('d LLL yyyy') : 'â€”';
    const timesTxt = selectedTimes.length ? selectedTimes.join('ØŒ ') : 'â€”';
    const name = ($('#name').val()||'').trim() || 'â€”';
    const mobile = (window.itiPhone && itiPhone.isValidNumber()) ? itiPhone.getNumber() : ($('#mobile').val()||'â€”');
    const carBits = [$('#carBrand').val()||'', $('#carName').val()||'', $('#plateNumber').val()||''].filter(Boolean).join(', ');
    const addons = (selectedAddons && selectedAddons.length) ? selectedAddons.join('ØŒ ') : 'â€”';
    const pay = (nForm.paymentMethod||'').toUpperCase() || 'â€”';

    $('#rv-area').text(area);
    $('#rv-service').text(srv);
    $('#rv-cars').text(cars);
    $('#rv-date').text(dateTxt);
    $('#rv-times').text(timesTxt);
    $('#rv-name').text(name);
    $('#rv-mobile').text(mobile);
    $('#rv-car').text(carBits || 'â€”');
    $('#rv-addons').text(addons);
    $('#rv-pay').text(pay);

    const totalObj = computeOrderTotal();
    $('#rv-total').text(totalObj.formatted);

    document.querySelectorAll('#page7 [data-edit-step]').forEach(btn=>{
      btn.onclick = (e)=>{ const step = Number(e.currentTarget.getAttribute('data-edit-step')); const idx = Math.max(0, Math.min(step-1, orderedPages.length-1)); showPage(idx); };
    });
  }

  let map, marker, autocomplete, jubailPoly, jubailBounds;
  const SA_BOUNDS = { north: 26.582151149881536, south: 26.479187374350676, west: 49.94492876846446, east: 50.05681139737682 };
  const JUBAIL_ALLOWED_PATH = [
    {lat:26.484054540578327, lng:50.00261281025426},
    {lat:26.535514751994445, lng:49.95514844270524},
    {lat:26.5592374337014943, lng:49.95322907308383},
    {lat:26.565616456914945, lng:49.99587130060291},
    {lat:26.54367784463272, lng:50.0058700609464},
    {lat:26.532828784787508, lng:50.01205719488301},
    {lat:26.53393587871155, lng:50.03173228080144},
    {lat:26.509023682480127, lng:50.036434502593266},
    {lat:26.50802708220727, lng:50.01614070328118}
  ];
  function initMap(){
    jubailPoly = new google.maps.Polygon({ paths: JUBAIL_ALLOWED_PATH, strokeColor:'#6B3FA6', strokeOpacity:.9, strokeWeight:2, fillColor:'#6B3FA6', fillOpacity:.18, clickable:false });
    jubailBounds = new google.maps.LatLngBounds(); JUBAIL_ALLOWED_PATH.forEach(p => jubailBounds.extend(new google.maps.LatLng(p.lat, p.lng)));
    const def = jubailBounds.getCenter();
    map=new google.maps.Map(document.getElementById('googleMap'),{ center:def, zoom:12, disableDoubleClickZoom:true, mapTypeControl:false, fullscreenControl:true, restriction:{latLngBounds: SA_BOUNDS, strictBounds:false} });
    jubailPoly.setMap(map); map.fitBounds(jubailBounds);
    marker=new google.maps.Marker({position:def,map,draggable:true,title:'Ø§Ø³Ø­Ø¨ Ø£Ùˆ Ø§Ø¶ØºØ· Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¬Ø¨ÙŠÙ„'});

    const pointInJubail = (latLng) => google.maps.geometry.poly.containsLocation(latLng, jubailPoly);
    function snapToPolygon(latLng){
      const path = jubailPoly.getPath(); let bestPoint = null; let bestDist = Infinity;
      function toPoint(ll){ return {x: ll.lng(), y: ll.lat()}; }
      function fromPoint(pt){ return new google.maps.LatLng(pt.y, pt.x); }
      function dist2(a,b){ const dx=a.x-b.x, dy=a.y-b.y; return dx*dx+dy*dy; }
      function clamp01(t){ return Math.max(0, Math.min(1, t)); }
      const p = toPoint(latLng);
      for(let i=0;i<path.getLength();i++){
        const aLL = path.getAt(i); const bLL = path.getAt((i+1)%path.getLength());
        const a = toPoint(aLL), b = toPoint(bLL); const ab = {x: b.x - a.x, y: b.y - a.y};
        const ap = {x: p.x - a.x, y: p.y - a.y}; const abLen2 = ab.x*ab.x + ab.y*ab.y || 1e-12;
        const t = clamp01((ap.x*ab.x + ap.y*ab.y) / abLen2); const proj = { x: a.x + t*ab.x, y: a.y + t*ab.y };
        const d2 = dist2(p, proj); if(d2 < bestDist){ bestDist = d2; bestPoint = proj; }
      }
      return fromPoint(bestPoint || p);
    }
    function setPos(latLng, pan=false, allowSnap=true){
      if(!latLng) return;
      if(!pointInJubail(latLng)){
        if(allowSnap){ latLng = snapToPolygon(latLng); showToast('error','Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø®Ø§Ø±Ø¬ Ù†Ø·Ø§Ù‚ Ø§Ù„Ø¬Ø¨ÙŠÙ„ â€” ØªÙ… ØªÙ‚Ø±ÙŠØ¨ Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ù„Ø£Ù‚Ø±Ø¨ Ù†Ù‚Ø·Ø© Ø¯Ø§Ø®Ù„ Ø§Ù„Ø­Ø¯ÙˆØ¯.'); }
        else{ showToast('error','Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø®Ø§Ø±Ø¬ Ù†Ø·Ø§Ù‚ Ø§Ù„Ø¬Ø¨ÙŠÙ„ â€” ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù†Ù‚Ø·Ø© Ø¯Ø§Ø®Ù„ Ø§Ù„Ø­Ø¯ÙˆØ¯.'); return; }
      }
      marker.setPosition(latLng); if(pan){ map.panTo(latLng); } map.setZoom(Math.max(15, map.getZoom()));
      positionUrl=`https://www.google.com/maps/search/?api=1&query=${latLng.lat()},${latLng.lng()}`;
      const hint=document.getElementById('mapHint');
      if(hint) hint.innerHTML=`ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…ÙˆÙ‚Ø¹: <strong>${latLng.lat().toFixed(5)}, ${latLng.lng().toFixed(5)}</strong>`;
      renderSummary('page6'); updateNextAvailability();
    }
    marker.addListener('dragend',({latLng})=>setPos(latLng,false,true));
    map.addListener('click',({latLng})=>setPos(latLng,true,true));
    const input=document.getElementById('mapSearch');
    const opts={ fields:['geometry','name'], componentRestrictions:{country:'sa'}, strictBounds:false };
    autocomplete=new google.maps.places.Autocomplete(input, opts);
    autocomplete.bindTo('bounds', map);
    autocomplete.addListener('place_changed', ()=>{ const place=autocomplete.getPlace(); if(!place?.geometry) return; setPos(place.geometry.location,true,true); });
    document.getElementById('show-my-location')?.addEventListener('click',()=>{
      if(!navigator.geolocation){ showToast('error','Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹'); return; }
      navigator.geolocation.getCurrentPosition(
        pos=>{ const ll = new google.maps.LatLng(pos.coords.latitude,pos.coords.longitude); setPos(ll,true,true); if(!google.maps.geometry.poly.containsLocation(ll, jubailPoly)){ map.fitBounds(jubailBounds); } },
        _=>{ showToast('error','ØªØ¹Ø°Ø± ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹Ùƒ'); },
        { enableHighAccuracy:true, timeout:10000, maximumAge:30000 }
      );
    });
  }
  window.initMap=initMap;

  async function submitAllAppointments(){
    const cleanBase = sanitizeNahlPayload(nForm);
    const missing = [];
    if (!cleanBase.date) missing.push('Ø§Ù„ØªØ§Ø±ÙŠØ®');
    if (!selectedTimes.length) missing.push('Ø§Ù„Ø£ÙˆÙ‚Ø§Øª');
    if (!cleanBase.location) missing.push('Ø§Ù„Ù…Ù†Ø·Ù‚Ø©');
    if (!cleanBase.service) missing.push('Ø§Ù„Ø®Ø¯Ù…Ø©');
    if (!cleanBase.customerN) missing.push('Ø§Ù„Ø§Ø³Ù…');
    if (!cleanBase.customerM) missing.push('Ø§Ù„Ø¬ÙˆØ§Ù„');
    if (!cleanBase.paymentMethod) missing.push('Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹');
    if (!positionUrl) missing.push('Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©');
    if (missing.length) { showToast('error', 'Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù†Ø§Ù‚ØµØ©: ' + missing.join('ØŒ ')); return; }

    if (isSubmitting) return;
    isSubmitting = true;

    const $next=document.getElementById('footer-next');
    const $prev=document.getElementById('footer-prev');
    const $wait=document.getElementById('footer-wait');
    $next.style.display='none'; $prev.style.display='none'; $wait.classList.add('show');

    const successes = []; const failures  = [];
    for (let idx=0; idx<selectedTimes.length; idx++){
      const t = selectedTimes[idx];
      const payload = { ...cleanBase, time: t, urlLocation: positionUrl };
      try {
        const r = await postReservationOriginal(payload);
        if (r.ok && r.data?.success) successes.push({ time: t, res: r });
        else {
          const msg = r?.data?.msgAR || r?.data?.message || (r.status===404?'Ø§Ù„Ù…Ø³Ø§Ø± ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯':'ÙØ´Ù„ Ø§Ù„Ø­Ø¬Ø²');
          failures.push({ time: t, msg });
        }
      } catch(e){ failures.push({ time: t, msg: String(e) }); }
      await new Promise(res=>setTimeout(res, 200));
    }

    if (failures.length === 0) {
      showToast('success', 'ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª');
      document.getElementById('ts-area').textContent = $('#area').find(':selected').text() || 'â€”';
      document.getElementById('ts-service').textContent = $('#service').find(':selected').text() || 'â€”';
      document.getElementById('ts-cars').textContent = String(getCarsCount());
      const dateTxt = cleanBase.date ? DateTime.fromISO(cleanBase.date).toFormat('d LLL yyyy') : '';
      const timesTxt = selectedTimes.join('ØŒ ');
      document.getElementById('ts-dt').textContent = `${dateTxt} â€¢ ${timesTxt}`;
      document.getElementById('ts-pay').textContent = (cleanBase.paymentMethod || '').toUpperCase() || 'â€”';
      const waMsg = encodeURIComponent(
        `ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø­Ø¬Ø²:\nØ§Ù„Ø®Ø¯Ù…Ø©: ${$('#service').find(':selected').text()}\nØ§Ù„ØªØ§Ø±ÙŠØ®: ${dateTxt}\nØ§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯: ${timesTxt}\nØ¹Ø¯Ø¯ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª: ${getCarsCount()}\nØ§Ù„Ø±Ø§Ø¨Ø·: ${location.href}`
      );
      document.getElementById('ts-whatsapp').href = `https://wa.me/?text=${waMsg}`;
      showPage(7);
    } else {
      let msg = `ØªØ¹Ø°Ø± Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ø¹Ø¶ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª:\n`;
      failures.forEach(f => { msg += `â€¢ ${f.time}: ${f.msg}\n`; });
      showToast('error', msg.trim());
      isSubmitting = false; $wait.classList.remove('show'); $next.style.display=''; $prev.style.display='';
    }
  }

  (function observeStepChange(){
    const obs = new MutationObserver(()=>{ const i=getActiveIndex(); syncProgress(i); });
    obs.observe(document.querySelector('.stage'), { subtree:true, attributes:true, attributeFilter:['class'] });
  })();

  window.addEventListener('pagehide', () => {
    try { if (Array.isArray(controllers)) controllers.forEach(([c]) => { try { c.abort(); } catch(_){} }); } catch(_) {}
  });

  (function ensureMapInitSafety(){
    if (window.__mapInitPatched) return;
    window.__mapInitPatched = true;
    const maybeInit = () => {
      try{
        if (typeof google !== 'undefined' && google.maps && document.getElementById('googleMap') && typeof window.initMap === 'function') {
          if (!window.__mapAlreadyInited) { window.__mapAlreadyInited = true; window.initMap(); }
        }
      }catch(_){}
    };
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', () => { maybeInit(); setTimeout(maybeInit, 500); });
    } else { maybeInit(); setTimeout(maybeInit, 500); }
  })();
</script>
<!-- === END: ORIGINAL APP LOGIC === -->

<!-- ===== Lightweight I18N (AR / JP) â€“ applies only UI text, no workflow changes ===== -->
<script>
  window.__lang = 'ar';

  const I18N = {
    ar: {
      "brand.title":"ğŸ¯ Tiger 77",
      "step.welcome":"Ø§Ù„ØªØ±Ø­ÙŠØ¨",
      "step.service":"ÙˆÙŠÙ† ØªØ­Ø¨ Ù†Ø¬ÙŠÙƒØŸ",
      "step.time":"Ù…ØªÙ‰ ØªØ­Ø¨ Ù†Ø¬ÙŠÙƒØŸ",
      "step.contact":"Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„",
      "step.pay":"Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹",
      "step.map":"Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¹Ù„Ù‰ Ø®Ø±ÙŠØ·Ø© Ù‚ÙˆÙ‚Ù„",
      "step.review":"Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø·Ù„Ø¨",
      "done.title":"Ø´ÙƒØ±Ø§Ù‹ Ù„ÙƒÙ… ğŸŒŸ",
      "done.desc":"ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨ÙƒÙ…ØŒ ÙˆØ³Ù†Ø¤ÙƒØ¯ Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø¹Ù„Ù‰ ÙˆØ§ØªØ³Ø§Ø¨ Ù‚Ø±ÙŠØ¨Ù‹Ø§.",
      "done.times":"Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯",
      "done.pay":"Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹",

      "welcome.s1t":"Ù†Ø¬ÙŠÙƒ Ù„ÙŠÙ† Ø¨Ø§Ø¨ Ø¨ÙŠØªÙƒ",
      "welcome.s1d":"Ø­Ø¬Ø² Ø³Ø±ÙŠØ¹ â€¢ Ø®Ø¯Ù…Ø© Ù…ØªÙ†Ù‚Ù„Ø© â€¢ Ø§Ø­ØªØ±Ø§ÙÙŠØ© ÙÙŠ ÙƒÙ„ ØªÙØµÙŠÙ„",
      "welcome.s2t":"Ù…ÙˆØ§Ø¯ ÙØ§Ø®Ø±Ø©",
      "welcome.s2d":"Ù…Ù†ØªØ¬Ø§Øª Ø¢Ù…Ù†Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø·Ù„Ø§Ø¡ ÙˆØ§Ù„Ø¯Ø§Ø®Ù„ÙŠØ© Ù…Ø¹ Ø¹Ù†Ø§ÙŠØ© Ø¯Ù‚ÙŠÙ‚Ø©",
      "welcome.s3t":"Ù…ÙˆØ¹Ø¯Ùƒ Ø¹Ù„Ù‰ Ø±Ø§Ø­ØªÙƒ",
      "welcome.s3d":"Ø­Ø¯Ø¯ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© ÙˆØ§Ù„Ø®Ø¯Ù…Ø© ÙˆØ§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ â€” ÙˆØ§Ù„Ø¨Ø§Ù‚ÙŠ Ø¹Ù„ÙŠÙ†Ø§",
      "welcome.cta":"Ø§Ù†Ø·Ù„Ù‚ â€” Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„ØªØ§Ù„ÙŠØ© Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù†Ø·Ù‚Ø© ÙˆØ§Ù„Ø®Ø¯Ù…Ø©",

      "labels.area":"Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù†Ø·Ù‚Ø©",
      "labels.category":"Ø§Ù„ØªØµÙ†ÙŠÙ",
      "labels.service":"Ø§Ù„Ø®Ø¯Ù…Ø©",
      "labels.cars":"Ø¹Ø¯Ø¯ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª (Ø­ØªÙ‰ 5)",
      "labels.date":"Ø§Ù„ØªØ§Ø±ÙŠØ®",
      "labels.timeFilter":"ÙÙ„ØªØ±Ø© Ø§Ù„ÙˆÙ‚Øª",
      "labels.name":"Ø§Ù„Ø§Ø³Ù…",
      "labels.mobile":"Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„",
      "labels.carBrand":"Ù…Ø§Ø±ÙƒØ© Ø§Ù„Ø³ÙŠØ§Ø±Ø© ğŸš˜",
      "labels.carName":"Ø§Ø³Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø©",
      "labels.plate":"Ø±Ù‚Ù… Ø§Ù„Ù„ÙˆØ­Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)",

      "hints.plate":"Ø§Ø®ØªÙŠØ§Ø±ÙŠ â€” ÙŠØ³Ø§Ø¹Ø¯ ÙØ±ÙŠÙ‚Ù†Ø§ Ø¹Ù„Ù‰ Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ù…Ø±ÙƒØ¨ØªÙƒ Ø¨Ø³Ø±Ø¹Ø©",
      "hints.map":"Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø£Ùˆ Ø§Ø³Ø­Ø¨ Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ù„ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹Ùƒ",

      "errors.area":"ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù†Ø·Ù‚Ø©",
      "errors.category":"ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØªØµÙ†ÙŠÙ",
      "errors.service":"ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø®Ø¯Ù…Ø©",
      "errors.cars":"ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø¹Ø¯Ø¯ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª",
      "errors.date":"ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ØªØ§Ø±ÙŠØ® ØµØ­ÙŠØ­",
      "errors.name":"ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù…",
      "errors.mobile":"Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø¬ÙˆØ§Ù„ ØµØ­ÙŠØ­",
      "errors.pay":"ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹",
      "errors.map":"Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©",

      "time.all":"ÙƒÙ„ Ø§Ù„Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©",
      "time.morning":"Ø§Ù„ØµØ¨Ø§Ø­ (06:00â€“11:00)",
      "time.afternoon":"Ø§Ù„Ø¸Ù‡ÙŠØ±Ø© (11:00â€“16:00)",
      "time.evening":"Ø§Ù„Ù…Ø³Ø§Ø¡ (16:00â€“21:00)",
      "time.night":"Ù„ÙŠÙ„Ù‹Ø§ (21:00â€“23:59)",

      "state.noServices":"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø®Ø¯Ù…Ø§Øª ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ØªØµÙ†ÙŠÙ",
      "state.loadErr":"ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø¯Ù…Ø§Øª",
      "state.loadingServices":"Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø®Ø¯Ù…Ø§Øªâ€¦",
      "state.fetchTimes":"Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯â€¦",
      "state.sending":"ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨â€¦",

      "pay.cash":"ÙƒØ§Ø´",
      "pay.bank":"ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ",
      "pay.mada":"Ù…Ø¯Ù‰",

      "review.desc":"Ø±Ø§Ø¬Ø¹ ØªÙØ§ØµÙŠÙ„ Ø­Ø¬Ø²Ùƒ Ø«Ù… Ø§Ø¶ØºØ· \"ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨\"",
      "review.area":"Ø§Ù„Ù…Ù†Ø·Ù‚Ø©",
      "review.service":"Ø§Ù„Ø®Ø¯Ù…Ø©",
      "review.cars":"Ø¹Ø¯Ø¯ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª",
      "review.date":"Ø§Ù„ØªØ§Ø±ÙŠØ®",
      "review.times":"Ø§Ù„Ø£ÙˆÙ‚Ø§Øª",
      "review.name":"Ø§Ù„Ø§Ø³Ù…",
      "review.mobile":"Ø§Ù„Ø¬ÙˆØ§Ù„",
      "review.car":"Ø§Ù„Ù…Ø±ÙƒØ¨Ø©",
      "review.addons":"Ø§Ù„Ø¥Ø¶Ø§ÙØ§Øª",
      "review.pay":"Ø§Ù„Ø¯ÙØ¹",
      "review.total":"Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ",

      "actions.retry":"Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©",
      "actions.myLoc":"Ø¥Ø¸Ù‡Ø§Ø± Ù…ÙˆÙ‚Ø¹ÙŠ",
      "actions.prev":"Ø§Ù„Ø³Ø§Ø¨Ù‚",
      "actions.skip":"ØªØ®Ø·ÙŠ Ø§Ù„Ø¹Ø±Ø¶",
      "actions.editService":"ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø®Ø¯Ù…Ø©",
      "actions.editTime":"ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙˆÙ‚Øª",
      "actions.editContact":"ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª",
      "actions.editPay":"ØªØºÙŠÙŠØ± Ø§Ù„Ø¯ÙØ¹",
      "actions.confirm":"ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨",
      "actions.share":"Ù…Ø´Ø§Ø±ÙƒØ© Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨",
      "actions.rebook":"ğŸ” Ø­Ø¬Ø² Ø¬Ø¯ÙŠØ¯"
    },
    jp: {
      "brand.title":"ğŸ¯ ã‚¿ã‚¤ã‚¬ãƒ¼77",
      "step.welcome":"ã‚ˆã†ã“ã",
      "step.service":"ã©ã®ã‚¨ãƒªã‚¢ã«ä¼ºã„ã¾ã™ã‹ï¼Ÿ",
      "step.time":"ã”å¸Œæœ›ã®æ™‚é–“ã¯ï¼Ÿ",
      "step.contact":"é€£çµ¡å…ˆæƒ…å ±",
      "step.pay":"ãŠæ”¯æ‰•ã„æ–¹æ³•",
      "step.map":"Googleãƒãƒƒãƒ—ã§ä½ç½®ã‚’æŒ‡å®š",
      "step.review":"å†…å®¹ã®ç¢ºèª",
      "done.title":"ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ ğŸŒŸ",
      "done.desc":"ã”ä¾é ¼ã‚’å—ã‘ä»˜ã‘ã¾ã—ãŸã€‚ã¾ã‚‚ãªãWhatsAppã§ç¢ºèªã—ã¾ã™ã€‚",
      "done.times":"æ—¥æ™‚",
      "done.pay":"æ”¯æ‰•ã„æ–¹æ³•",

      "welcome.s1t":"ã”è‡ªå®…ã®å‰ã¾ã§ä¼ºã„ã¾ã™",
      "welcome.s1d":"ã‚¹ãƒ”ãƒ¼ãƒ‰äºˆç´„ãƒ»å‡ºå¼µã‚µãƒ¼ãƒ“ã‚¹ãƒ»ãƒ—ãƒ­å“è³ª",
      "welcome.s2t":"ä¸Šè³ªãªã‚±ã‚¢ç”¨å“",
      "welcome.s2d":"å¡—è£…ã‚„å†…è£…ã«å„ªã—ã„è£½å“ã§ä¸å¯§ã«ä»•ä¸Šã’",
      "welcome.s3t":"éƒ½åˆã«åˆã‚ã›ã¦äºˆç´„",
      "welcome.s3d":"ã‚¨ãƒªã‚¢ãƒ»ã‚µãƒ¼ãƒ“ã‚¹ãƒ»æ™‚é–“ã‚’é¸ã¶ã ã‘ã€ã‚ã¨ã¯ãŠä»»ã›",
      "welcome.cta":"æ¬¡ã¸ â€” ã‚¨ãƒªã‚¢ã¨ã‚µãƒ¼ãƒ“ã‚¹ã‚’é¸æŠ",

      "labels.area":"ã‚¨ãƒªã‚¢é¸æŠ",
      "labels.category":"ã‚«ãƒ†ã‚´ãƒª",
      "labels.service":"ã‚µãƒ¼ãƒ“ã‚¹",
      "labels.cars":"å°æ•°ï¼ˆæœ€å¤§5å°ï¼‰",
      "labels.date":"æ—¥ä»˜",
      "labels.timeFilter":"æ™‚é–“å¸¯ã®çµã‚Šè¾¼ã¿",
      "labels.name":"æ°å",
      "labels.mobile":"æºå¸¯ç•ªå·",
      "labels.carBrand":"è»Šã®ãƒ¡ãƒ¼ã‚«ãƒ¼ ğŸš˜",
      "labels.carName":"è»Šå / ã‚°ãƒ¬ãƒ¼ãƒ‰",
      "labels.plate":"ãƒŠãƒ³ãƒãƒ¼ï¼ˆä»»æ„ï¼‰",

      "hints.plate":"ä»»æ„ â€” è»Šä¸¡ã®ç‰¹å®šãŒã‚¹ãƒ ãƒ¼ã‚ºã«ãªã‚Šã¾ã™",
      "hints.map":"åœ°å›³ã‚’ã‚¿ãƒƒãƒ—ã¾ãŸã¯ãƒ”ãƒ³ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ä½ç½®ã‚’æŒ‡å®š",

      "errors.area":"ã‚¨ãƒªã‚¢ã‚’é¸æŠã—ã¦ãã ã•ã„",
      "errors.category":"ã‚«ãƒ†ã‚´ãƒªã‚’é¸æŠã—ã¦ãã ã•ã„",
      "errors.service":"ã‚µãƒ¼ãƒ“ã‚¹ã‚’é¸æŠã—ã¦ãã ã•ã„",
      "errors.cars":"å°æ•°ã‚’é¸æŠã—ã¦ãã ã•ã„",
      "errors.date":"æ­£ã—ã„æ—¥ä»˜ã‚’é¸æŠã—ã¦ãã ã•ã„",
      "errors.name":"æ°åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„",
      "errors.mobile":"æ­£ã—ã„æºå¸¯ç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„",
      "errors.pay":"ãŠæ”¯æ‰•ã„æ–¹æ³•ã‚’é¸æŠã—ã¦ãã ã•ã„",
      "errors.map":"åœ°å›³ã§ä½ç½®ã‚’æŒ‡å®šã—ã¦ãã ã•ã„",

      "time.all":"ã™ã¹ã¦ã®æ™‚é–“å¸¯",
      "time.morning":"æœï¼ˆ06:00â€“11:00ï¼‰",
      "time.afternoon":"æ˜¼ï¼ˆ11:00â€“16:00ï¼‰",
      "time.evening":"å¤•æ–¹ï¼ˆ16:00â€“21:00ï¼‰",
      "time.night":"å¤œï¼ˆ21:00â€“23:59ï¼‰",

      "state.noServices":"ã“ã®ã‚«ãƒ†ã‚´ãƒªã®ã‚µãƒ¼ãƒ“ã‚¹ã¯ã‚ã‚Šã¾ã›ã‚“",
      "state.loadErr":"ã‚µãƒ¼ãƒ“ã‚¹æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ",
      "state.loadingServices":"ã‚µãƒ¼ãƒ“ã‚¹ã‚’èª­ã¿è¾¼ã¿ä¸­â€¦",
      "state.fetchTimes":"ç©ºãæ™‚é–“ã‚’å–å¾—ä¸­â€¦",
      "state.sending":"é€ä¿¡ã—ã¦ã„ã¾ã™â€¦",

      "pay.cash":"ç¾é‡‘",
      "pay.bank":"éŠ€è¡ŒæŒ¯è¾¼",
      "pay.mada":"Mada",

      "review.desc":"å†…å®¹ã‚’ç¢ºèªã—ã€Œäºˆç´„ã‚’ç¢ºå®šã€ã‚’æŠ¼ã—ã¦ãã ã•ã„",
      "review.area":"ã‚¨ãƒªã‚¢",
      "review.service":"ã‚µãƒ¼ãƒ“ã‚¹",
      "review.cars":"å°æ•°",
      "review.date":"æ—¥ä»˜",
      "review.times":"æ™‚é–“",
      "review.name":"æ°å",
      "review.mobile":"æºå¸¯",
      "review.car":"è»Šä¸¡",
      "review.addons":"è¿½åŠ ã‚µãƒ¼ãƒ“ã‚¹",
      "review.pay":"æ”¯æ‰•ã„",
      "review.total":"åˆè¨ˆ",

      "actions.retry":"å†è©¦è¡Œ",
      "actions.myLoc":"ç¾åœ¨åœ°ã‚’è¡¨ç¤º",
      "actions.prev":"æˆ»ã‚‹",
      "actions.skip":"ã‚¹ã‚­ãƒƒãƒ—",
      "actions.editService":"ã‚µãƒ¼ãƒ“ã‚¹ã‚’ç·¨é›†",
      "actions.editTime":"æ™‚é–“ã‚’ç·¨é›†",
      "actions.editContact":"é€£çµ¡å…ˆã‚’ç·¨é›†",
      "actions.editPay":"æ”¯æ‰•ã„ã‚’å¤‰æ›´",
      "actions.confirm":"äºˆç´„ã‚’ç¢ºå®š",
      "actions.share":"WhatsAppã§å…±æœ‰",
      "actions.rebook":"ğŸ” æ–°ã—ãäºˆç´„"
    }
  };

  function applyI18N(lang){
    window.__lang = (lang === 'jp') ? 'jp' : 'ar';
    const dict = I18N[window.__lang];

    // dir & lang
    const html = document.documentElement;
    if(window.__lang==='jp'){ html.setAttribute('lang','ja'); html.setAttribute('dir','ltr'); }
    else { html.setAttribute('lang','ar'); html.setAttribute('dir','rtl'); }

    // data-i18n replacements
    document.querySelectorAll('[data-i18n]').forEach(el=>{
      const key = el.getAttribute('data-i18n');
      if (dict[key]) el.textContent = dict[key];
    });

    // update step labels array (only visible label)
    const i = (typeof getActiveIndex==='function') ? getActiveIndex() : 0;
    const stepEl = document.getElementById('miniStepTitle');
    if (stepEl) stepEl.textContent = dict['step.'+['welcome','service','time','contact','pay','map','review','done'][Math.min(i,7)]] || stepEl.textContent;

    // footer buttons text
    const prev = document.getElementById('footer-prev');
    const next = document.getElementById('footer-next');
    if (prev) prev.textContent = dict['actions.prev'] || prev.textContent;
    if (next){
      const id = (typeof orderedPages!=='undefined') ? orderedPages[i] : 'page1';
      next.textContent =
        (id==='page1') ? (dict['actions.skip']||next.textContent)
        : (id==='page7') ? (dict['actions.confirm']||next.textContent)
        : (window.__lang==='jp' ? 'æ¬¡ã¸' : 'Ø§Ù„ØªØ§Ù„ÙŠ');
    }

    // select2 direction switch for search field
    const search = document.querySelector('.select2-search__field');
    if (search) search.setAttribute('dir', (window.__lang==='jp') ? 'ltr' : 'rtl');
  }

  document.addEventListener('DOMContentLoaded', ()=>{
    // Toggle handlers
    const btnAR = document.getElementById('btnLangAR');
    const btnJP = document.getElementById('btnLangJP');
    const setActive = (lang)=>{
      btnAR.classList.toggle('active', lang==='ar');
      btnJP.classList.toggle('active', lang==='jp');
    };
    btnAR.addEventListener('click', ()=>{ setActive('ar'); applyI18N('ar'); });
    btnJP.addEventListener('click', ()=>{ setActive('jp'); applyI18N('jp'); });

    // default Arabic
    setActive('ar'); applyI18N('ar');
  });
</script>

<!-- Google Maps (with geometry lib) -->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBBHLoO038vsCovHN-SLUgAXqexlA2v0_4&callback=initMap&v=weekly&loading=async&libraries=places,geometry&language=ar&region=SA" async defer></script>
</body>
</html>
