<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>حجوزات المواعيد</title>

  <!-- Primary Meta -->
  <meta name="title" content="حجوزات المواعيد" />
  <meta name="description" content="1. بنغسل سيارتك بخلطة خاصة مدعّمة بالواكس تحميها من الغبار والخدوش. 2. فوطنا دايمًا نظيفة. 3. إسفنجة مخصوصة للكفرات. #غسيل_بدون_طوابير" />

  <!-- Open Graph -->
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://www.spongnsoap.com" />
  <meta property="og:title" content="حجوزات المواعيد" />
  <meta property="og:description" content="1. بنغسل سيارتك بخلطة خاصة... #غسيل_بدون_طوابير" />
  <meta property="og:image" content="https://pdnmghkpepvsfaiqlafk.supabase.co/storage/v1/object/public/nahl%20assets/Sponge%20&%20Soap/Logo%20-%20Sponge%20and%20Soap%20-%201.png" />

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:url" content="https://www.spongnsoap.com" />
  <meta name="twitter:title" content="حجوزات المواعيد" />
  <meta name="twitter:description" content="#غسيل_بدون_طوابير" />
  <meta name="twitter:image" content="https://pdnmghkpepvsfaiqlafk.supabase.co/storage/v1/object/public/nahl%20assets/Sponge%20&%20Soap/Logo%20-%20Sponge%20and%20Soap%20-%201.png" />

  <link rel="shortcut icon" href="https://pdnmghkpepvsfaiqlafk.supabase.co/storage/v1/object/public/nahl%20assets/Sponge%20&%20Soap/Logo%20-%20Sponge%20and%20Soap%20-%201.png" type="image/x-icon" />

  <!-- jQuery (FULL, not slim) -->
  <script src="https://code.jquery.com/jquery-3.6.3.min.js" integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU=" crossorigin="anonymous"></script>

  <!-- Select2 -->
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

  <!-- dayjs & luxon -->
  <script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/luxon@3.4.4/build/global/luxon.min.js"></script>

  <!-- Font / Bootstrap -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&family=Tinos:wght@400;700&display=swap" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

  <!-- intl-tel-input -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/intl-tel-input@24.4.0/build/css/intlTelInput.css" />
  <script src="https://cdn.jsdelivr.net/npm/intl-tel-input@24.4.0/build/js/intlTelInputWithUtils.js"></script>

  <!-- Icons -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet"/>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap');

    html, body {
      margin: 0;
      height: 100%;
      font-family: 'Cairo', sans-serif;
      position: fixed;
      width: 100vw;
      height: 100vh;
    }
    input, select { text-align: center; }

    body {
      display: flex; flex-direction: row; flex-wrap: wrap;
      align-items: center; justify-content: center;
      background-size: cover;
    }
    .bg-image {
      position: absolute; width: 100%; z-index: -1;
      background-image: url("https://www.dropbox.com/s/s9bxuykl0w49dqa/background2.jpg?raw=1");
      filter: blur(8px); -webkit-filter: blur(8px);
      height: 100%; background-position: center; background-repeat: no-repeat; background-size: cover;
    }
    #banner, #form { flex-basis: 50%; height: 100%; }
    #form {
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      background: #48b5d0e0; color: #ffffff;
      box-shadow: 0 0 5px 10px rgba(5, 28, 59, 0.981), 10px 0px 70px 0px rgba(5, 28, 59, 0.426);
    }
    #form-content { width: 100%; overflow: auto; flex-basis: 100%; display: flex; flex-direction: column; justify-content: space-between; }
    #form-content > div { text-align: center; display: flex; flex-direction: column; align-items: center; z-index: 2; position: relative; justify-content: space-evenly; }
    #page1, #page2, #page3, #page4, #page5, #page6, #page7 { height: 70%; }
    .header {
      z-index: 2; text-align: center; color: #ffffff; font-weight: bold; flex-basis: 10%;
      margin: 0; padding: 0; padding-top: 10%;
    }
    .header img { width: 220px; }
    .filter-button {
      align-items: center; background-color: #ffffff; border-radius: 12px;
      box-shadow: transparent 0 0 0 3px, rgba(18,18,18,.1) 0 6px 20px;
      color:#0394b6; cursor: pointer; display: inline-flex; font-size: 1.2rem;
      font-weight: 700; justify-content: center; line-height: 1; padding: 1rem 1.2rem;
      border: 0; transition: box-shadow .2s; user-select: none;
    }
    .filter-button:hover { background-color: #0394b6; color: #f5f5f5; }

    .time-date-box { display: flex; flex-direction: column; border-radius: 10px; width: 100%; margin-top: 30px; padding: 10px; }
    #time-date-header { border-radius: 12px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border: none; }
    .time-date-header { display: flex; flex-direction: row; justify-content: stretch; align-items: center; color: black; }
    .time-date-header div { padding: 15px 0; background-color: white; flex-basis: 33.333%; box-shadow: transparent 0 0 0 3px, rgba(18,18,18,.1) 0 6px 20px; cursor: pointer; transition: all 1s; }
    .time-date-header div:hover, .time-date-header .choosed { background-color: #0394b6; color: #f5f5f5; }

    .spinner-border { border-color:#0394b6; border-right-color: transparent; }
    #department-spinner { color: #0394b6; }

    .time-container {
      display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem;
      background-color: white; height: 23rem; overflow-y: auto; align-content: start; align-items: start;
    }
    .time-button {
      background: #fff; border-radius: 12px; box-shadow: transparent 0 0 0 3px, rgba(18,18,18,.1) 0 6px 20px;
      color: #121212; cursor: pointer; display: inline-flex; font-size: 1rem; font-weight: 700; justify-content: center;
      margin: 3%; padding: 1.5rem 1.2rem; border: 0; transition: box-shadow .2s; align-self: start;
    }
    .time-button:hover { background-color: #0394b6; color: #f5f5f5; }

    #date { padding: 2rem; }

    .instagram-button, .tiktok-button, .whatsapp-button { background-color: #0000; border-radius: 50px; color: #fff; width: 50px; height: 50px; font-size: 30px; display:flex; justify-content:center; align-items:center; position: fixed; left: 15px; z-index: 999; }
    .whatsapp-button { bottom: 15px; }
    .instagram-button { bottom: 74px; }
    .tiktok-button { bottom: 133px; }

    .form-container { display:flex; flex-direction:column; gap:5px; width:100%; max-width:400px; }
    .chip { background: rgba(255,255,255,0); color:#fff; padding:8px; border-radius:8px; display:flex; flex-direction:column; align-items:center; }
    .chip select, .chip input {
      width: 100%; max-width: 280px; font-size: 12px; padding: 4px; border-radius: 6px;
      border: none; text-align: center; background: #fff; color: #37338d; box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    #drag-instructions {
      position: absolute; top: 20px; left: 50%; transform: translateX(-50%);
      background: rgba(255,255,255,0.9); padding: 8px 12px; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      text-align: center; font-size: 14px; color: #333; z-index: 9999; animation: fadeIn .5s ease-in-out;
    }
    #drag-icon { font-size: 40px; display: block; margin: 0 auto 4px; animation: moveHand 1.5s infinite alternate ease-in-out; }
    @keyframes fadeIn { from{opacity:0} to{opacity:1} }
    @keyframes moveHand { from{transform:translateX(0)} to{transform:translateX(15px)} }

    .rebook-button {
      background: linear-gradient(135deg, #0394b6, #48b5d0); color: #fff; font-size: 1.2rem;
      padding: 0.8em 2em; border-radius: 12px; border: none; box-shadow: 0 4px 12px rgba(3,148,182,.3);
      transition: all .3s; font-weight: bold; letter-spacing: .5px;
    }
    .rebook-button:hover { background: linear-gradient(135deg, #027790, #32a5bc); transform: scale(1.05); box-shadow: 0 6px 18px rgba(3,148,182,.5); }

    :root{ --fab-size:56px; --fab-bg:rgba(34,34,34,.55); }
    .social-fab{
      position: fixed; left: 15px; z-index: 999; width: var(--fab-size); height: var(--fab-size); border-radius: 50%;
      display:flex; align-items:center; justify-content:center; color:#fff; text-decoration:none;
      background: var(--fab-bg); backdrop-filter: blur(6px); -webkit-backdrop-filter: blur(6px);
      box-shadow: 0 8px 20px rgba(0,0,0,.35), 0 0 0 2px rgba(255,255,255,.10) inset;
      transition: transform .18s, box-shadow .18s; will-change: transform, box-shadow;
    }
    .social-fab i{ font-size:1.4rem; filter: drop-shadow(0 2px 4px rgba(0,0,0,.4)); }
    .social-fab:hover, .social-fab:focus-visible{ transform: translateY(-2px); box-shadow: 0 12px 26px rgba(0,0,0,.45); }
    .whatsapp-button{ --brand:#25D366; }
    .instagram-button{ --brand:#E1306C; }
    .tiktok-button{ --brand:#69C9D0; }

    @media (max-width: 1000px) {
      #banner { position: absolute; display: none; filter: blur(7px); }
      #form { flex-basis: 100%; }
      .time-container{ grid-template-columns: 1fr 1fr 1fr; }
    }
    @media (max-width: 450px) {
      #date{ padding-top: .5rem; padding-bottom: 2rem; }
    }
  </style>
</head>
<body>
  <div class="bg-image"></div>

  <div id="banner">
    <div class="banner-content">
      <div class="banner-content-holder">
        <img style="margin-left: 20px; margin-right: 20px; width: 111%;" src="https://pdnmghkpepvsfaiqlafk.supabase.co/storage/v1/object/public/nahl%20assets/Sponge%20&%20Soap/Logo%20-%20Sponge%20and%20Soap%20-%201.png" />
      </div>
    </div>
  </div>

  <div id="form">
    <div id="form-content">
      <div class="header">
        <img src="https://pdnmghkpepvsfaiqlafk.supabase.co/storage/v1/object/public/nahl%20assets/Sponge%20&%20Soap/spong&Soap%20-%20logo.png" alt="">
      </div>

      <!-- Page 1 -->
      <div id="page1" style="display:flex;">
        <div>
          <h3 style="text-align:center; line-height:2;">
            ✨ واكس يحمي سيارتك<br/>
            🧼 فوط نظيفة & لمعان مضمون<br/>
            🛞 إسفنجة للكفرات<br/><br/>
            ... نهتم بكل التفاصيل
          </h3>
          <p style="text-align:center; margin-top:10px;">
            <span style="font-weight:bold; font-size:18px;">#غسيل_بدون_طوابير</span>
          </p>
        </div>
        <div class="filter-button-wrap">
          <button id="page1-button" class="filter-button">احجز موعدك</button>
        </div>
      </div>

      <!-- Page 2 -->
      <div id="page2" class="fadeIn" style="display:none;">
        <h1>وين تحب نجيك ؟<br/>اختيار المنطقة</h1>
        <form onsubmit="handleSubmit(event)" id="page2-form" style="width:100%;">
          <div id="select2-container" style="position:relative;">
            <select id="area" class="js-example-basic-single" style="width:80%" required></select>
            <div id="page2-spinner" style="position:absolute; top:0; left:47.6%; display:none;">
              <div class="spinner-border" role="status" style="width:1.5rem; height:1.5rem; margin-top:19%;"></div>
            </div>
          </div>

          <label for="service">الخدمة</label>
          <div style="position:relative;">
            <select id="service" style="width:90%;" required></select>
            <div id="page3-2-spinner" style="position:absolute; top:0; left:47.6%;">
              <div class="spinner-border" role="status" style="width:1.5rem; height:1.5rem; margin-top:19%;"></div>
            </div>
          </div>
        </form>

        <div class="filter-button-wrap">
          <button id="page2-button" class="filter-button">التالي</button>
        </div>
      </div>

      <!-- Page 3 -->
      <div id="page3" class="fadeIn" style="display:none;">
        <div id="page3-wait" style="display:none; position:absolute; inset:0; background:rgba(0,0,0,.6); display:flex; flex-direction:column; justify-content:center; align-items:center; z-index:10;">
          <div class="spinner-border text-light" role="status"></div>
          <p style="color:#fff; margin-top:1em; font-size:1.2em;">جاري جلب المواعيد…</p>
        </div>

        <form onsubmit="handleSubmit(event)" id="page3-form" style="display:flex; flex-direction:column; width:100%; padding:3%;">
          <label for="serviceCat" style="display:none;">صنف الخدمة</label>
          <div style="position:relative; display:none;">
            <select id="serviceCat" style="width:100%;" required></select>
            <div id="page3-1-spinner" style="position:absolute; top:0; left:47.6%;">
              <div class="spinner-border" role="status" style="width:1.5rem; height:1.5rem; margin-top:19%;"></div>
            </div>
          </div>

          <label for="serviceCount" style="display:none;">عدد السيارات</label>
          <select id="serviceCount" style="width:100%; display:none;" required>
            <option value="1" selected>1</option><option value="2">2</option>
            <option value="3">3</option><option value="4">4</option><option value="5">5</option>
            <option value="6">6</option><option value="7">7</option><option value="8">8</option>
            <option value="9">9</option><option value="10">10</option>
          </select>
        </form>

        <div id="page3-buttons">
          <div id="fail-alert-4" class="alert alert-danger" role="alert" style="display:none; margin-top:30px; margin-bottom:0;">
            <span></span><br/><span></span>
          </div>
          <button id="page3-button" class="filter-button" style="margin-top:30px" hidden>التالي</button>
          <button id="page3-return" class="filter-button" style="margin-top:30px" hidden>السابق</button>
        </div>
      </div>

      <!-- Page 4 -->
      <div id="page4" class="fadeIn" style="display:none;">
        <h1>متى تحب نجيك ؟<br/>اختيار الموعد</h1>
        <input type="date" id="date" class="date form-control" style="text-align:center; width:50%;" />

        <div class="time-date-box">
          <div id="time-date-header" class="time-date-header" hidden>
            <div id="dayHeader1" class="choosed" style="border-radius:0 10px 0 0;">
              <span id="day1">sunday</span><br/><span id="day1date">yyyy-mm-dd</span>
            </div>
            <div id="dayHeader2">
              <span id="day2">monday</span><br/><span id="day2date">yyyy-mm-dd</span>
            </div>
            <div id="dayHeader3" style="border-radius:10px 0 0 0;">
              <span id="day3">tuesday</span><br/><span id="day3date">yyyy-mm-dd</span>
            </div>
          </div>

          <div id="time-container" class="time-container"></div>

          <div id="fail-alert-3" class="alert alert-danger" role="alert" style="display:none; margin-top:30px; margin-bottom:0;">
            <span></span><br/><span></span>
          </div>
        </div>

        <div class="filter-button-wrap">
          <button id="page4-return" class="filter-button">السابق</button>
        </div>
      </div>

      <!-- Page 5 -->
      <div id="page5" class="fadeIn" style="display:none;">
        <form onsubmit="handleSubmit(event)" id="page5-form" style="display:flex; flex-direction:column;">
          <h2>معلومات الاتصال</h2>
          <label for="name">الإسم</label>
          <input id="name" type="text" required />

          <label for="mobile">رقم الجوال</label>
          <div class="phoneCountry" style="color:black; margin:3%;">
            <input type="tel" id="mobile" style="width:100%;" />
          </div>

          <h2>معلومات المركبة</h2>
          <div class="chip" style="position:relative; margin-bottom:1em;">
            <select id="carBrand" onchange="updateLocationDescription()" style="width:100%; padding:.6em; font-size:1em; border:1px solid #ccc; border-radius:4px;">
              <option value="" disabled selected>🚘 ماركة السيارة</option>
              <option value="Other">Other</option>
            </select>
          </div>

          <div style="display:flex; gap:1em; margin-bottom:1em; flex-wrap:wrap;">
            <div class="chip" style="flex:1; position:relative;">
              <input type="text" id="carName" placeholder="اسم السيارة (GT-R, كامري، إلنترا)" oninput="updateLocationDescription()" />
            </div>
            <div class="chip" style="flex:1; position:relative;">
              <input type="text" id="plateNumber" maxlength="4" placeholder="🔢 رقم اللوحة (مثال: 1234)" inputmode="numeric" pattern="^\\d{1,4}$" required />
            </div>
          </div>

          <div hidden>
            <input type="text" id="locationDescription" readonly placeholder="ماركة السيارة, اسم السيارة, رقم اللوحة"/>
          </div>

          <h2>طريقة الدفع</h2>
          <div style="display:flex; flex-direction:row-reverse; justify-content:space-evenly; align-items:center;">
            <div style="flex:1;">
              <label class="radio-label" style="position:relative; height:100%;">
                <input type="radio" name="payingMethod" class="radios" value="Cash" required style="position:absolute; opacity:0; width:50%; height:100%;"/>
                <img class="radio-buttons" src="https://pdnmghkpepvsfaiqlafk.supabase.co/storage/v1/object/public/nahl%20assets/CASH%20LOGO.png" alt="" width="125" />
              </label>
            </div>
            <div style="flex:1;">
              <label class="radio-label" style="position:relative; height:100%;">
                <input type="radio" name="payingMethod" class="radios" value="Telr-Online" required style="position:absolute; opacity:0; width:50%; height:100%;" />
                <img class="radio-buttons" src="https://pdnmghkpepvsfaiqlafk.supabase.co/storage/v1/object/public/nahl%20assets/STC%20PAY%20LOGO.png" alt="" width="125" />
              </label>
            </div>
            <div style="flex:1;">
              <label class="radio-label" style="position:relative;">
                <input type="radio" name="payingMethod" class="radios" value="Telr-Online" required style="position:absolute; opacity:0; width:50%; height:100%;" />
                <img class="radio-buttons" src="https://pdnmghkpepvsfaiqlafk.supabase.co/storage/v1/object/public/nahl%20assets/MADA%20LOGO.png" alt="" width="125" />
              </label>
            </div>
          </div>
        </form>

        <div id="page5-buttons">
          <div id="fail-alert-4" class="alert alert-danger" role="alert" style="display:none; margin-top:30px; margin-bottom:0;">
            <span></span><br/><span></span>
          </div>
          <button id="page5-button" class="filter-button" style="margin-top:30px">التالي</button>
          <button id="page5-return" class="filter-button" style="margin-top:30px">السابق</button>
        </div>
      </div>

      <!-- Page 6 -->
      <div id="page6" class="fadeIn" style="display:none;">
        <label for="googleMap" style="font-size:1.5em;">الموقع على خريطة قوقل</label>
        <div id="drag-instructions">
          <i class="fas fa-hand-point-right" id="drag-icon"></i>
          <p>📍 اسحب الخريطة لتغيير الموقع</p>
        </div>

        <div id="googleMap" style="width:100%; height:400px; margin:3% 0; color:#493a68;"></div>
        <p style="text-align:center; font-size:14px; color:#333; margin-bottom:10px;">📍 <strong>قم بسحب المؤشر أو اضغط على اظهار موقعي</strong></p>
        <button class="filter-button" id="show-my-location" style="border-radius:0; width:100%; margin-bottom:1em;">اظهار موقعي</button>

        <form onsubmit="handleSubmit(event)" id="page6-form" style="display:flex; flex-direction:column; width:100%; padding-bottom:3%;"></form>

        <div id="page6-buttons">
          <div id="fail-alert-5" class="alert alert-danger" role="alert" style="display:none; margin:30px 0 0;">
            <span></span><br/><span></span>
          </div>
          <button id="page6-button" class="filter-button" style="margin-top:30px; width:100%;">التالي</button>
          <button id="page6-return" class="filter-button" style="margin-top:30px; width:100%;">السابق</button>
          <div id="page6-spinner" style="display:none; flex-direction:column; align-items:center; margin-top:1em;">
            <span class="mt-3"></span>
            <div class="spinner-border" role="status" style="display:none; margin-top:30px;"></div>
          </div>
        </div>
      </div>

      <!-- Page 7 -->
      <div id="page7" class="fadeIn" style="display:none;">
        <h1>شكرا لكم</h1>
        <h2>تم حجز الموعد، وراح نأكده لكم على الواتساب</h2>
        <h3>متحمسين نجيكم!!</h3>
        <div class="filter-button-wrap">
          <button id="rebook" class="filter-button rebook-button">🔁 حجز جديد</button>
        </div>
      </div>

      <footer style="text-align:center; margin-top:20px;">
        <p>Sponge & Soap</p>
        <a target="_blank" href="https://www.instagram.com/nahl.app?igsh=Y3YyOW05MGI5bnNv&utm_source=qr">Made with Nahl Perfection</a>
      </footer>
    </div>
  </div>

  <!-- FABs -->
  <a target="_blank" href="https://wa.me/966503668222" class="social-fab whatsapp-button" aria-label="واتساب"><i class="fab fa-whatsapp"></i></a>
  <a target="_blank" href="https://www.instagram.com/sponge.soap_sa?igsh=MWRtOHI5OHZpbWpvdA==" class="social-fab instagram-button" aria-label="إنستغرام"><i class="fab fa-instagram"></i></a>
  <a target="_blank" href="https://www.tiktok.com/@sponge.soap_sa?_t=ZS-8zaj1CA4aJg&_r=1" class="social-fab tiktok-button" aria-label="تيك توك"><i class="fab fa-tiktok"></i></a>

  <!-- Terms Modal -->
  <div class="modal fade" id="termsModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">الشروط والأحكام – مغسلة سيارات متنقلة</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="إغلاق"></button>
        </div>
        <div class="modal-body" style="text-align:right;">
          <ol style="padding-right:1rem;">
            <li><strong>الخدمات المقدمة</strong>
              <ul><li>تقدم المغسلة خدمات غسيل وتنظيف السيارات وفق الباقات المعروضة على الموقع أو حسب الاتفاق المسبق.</li></ul>
            </li>
            <li><strong>حجز المواعيد</strong>
              <ul>
                <li>يتم الحجز عبر الموقع أو من خلال التواصل المباشر.</li>
                <li>يحق للمغسلة تعديل أو إلغاء الموعد في حال وجود ظرف طارئ مع إشعار العميل.</li>
              </ul>
            </li>
            <li><strong>الدفع</strong>
              <ul>
                <li>يتم الدفع عبر الوسائل المتاحة (تحويل بنكي، مدى، بطاقة إئتمانية، STC Bank، Apple Pay، نقدًا).</li>
                <li>يجب سداد المبلغ كاملاً قبل بدء الخدمة. وفي حال عدم السداد يحق للمغسلة إلغاء الموعد.</li>
              </ul>
            </li>
            <li><strong>إلغاء الخدمة واسترجاع المبلغ</strong>
              <ul>
                <li>في حال إلغاء الحجز قبل 3 ساعات من الموعد، يحق للعميل استرداد المبلغ أو إعادة جدولة الموعد.</li>
                <li>لا يحق للعميل طلب استرداد المبلغ أو جدولة الموعد في حال تم الإلغاء خلال أقل من 3 ساعات.</li>
              </ul>
            </li>
            <li><strong>مسؤولية المغسلة</strong>
              <ul>
                <li>تلتزم المغسلة بتقديم الخدمة بأفضل جودة ممكنة باستخدام مواد آمنة.</li>
                <li>المغسلة غير مسؤولة عن أي أعطال ميكانيكية أو كهربائية أو تلفيات سابقة في السيارة.</li>
                <li>في حال وقوع ضرر ناتج عن خطأ مباشر من فريق العمل، تتحمل المغسلة مسؤولية تعويض عادل يقتصر على قيمة الضرر المباشر.</li>
              </ul>
            </li>
            <li><strong>مسؤولية العميل</strong>
              <ul>
                <li>إخلاء السيارة من الأغراض الثمينة قبل بدء الخدمة.</li>
                <li>توفير مكان مناسب وآمن لإتمام الخدمة.</li>
              </ul>
            </li>
            <li><strong>الوقت والتأخير</strong>
              <ul>
                <li>مدة الخدمة تقريبية وقد تختلف حسب حالة السيارة.</li>
                <li>التأخير عن الموعد أكثر من 15 دقيقة قد يؤدي لإلغاء الموعد.</li>
              </ul>
            </li>
            <li><strong>التعديلات</strong>
              <ul>
                <li>قد يتم تحديث الشروط والأحكام في أي وقت.</li>
              </ul>
            </li>
            <li><strong>القانون</strong>
              <ul>
                <li>تخضع هذه الشروط لأحكام المملكة العربية السعودية.</li>
              </ul>
            </li>
          </ol>
          <div class="form-check mt-2">
            <input class="form-check-input" type="checkbox" id="termsAccept">
            <label class="form-check-label" for="termsAccept">أوافق على الشروط والأحكام</label>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal">إلغاء</button>
          <button class="btn btn-primary" id="confirmTerms" disabled>تأكيد ومتابعة</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ======= Globals =======
    let countryCodeInput; // exposed after DOMContentLoaded
    const DateTime = luxon.DateTime;

    // Persisted defaults / endpoints
    const defaultLink2 = `https://nahl-platform.vercel.app/api/app/AM/general/${'33e0d05d-d771-46f4-a7e7-7c634b4e3a9e'}/form`;

    // Restore saved user info
    document.addEventListener('DOMContentLoaded', () => {
      try {
        const savedName = localStorage.getItem("name");
        if (savedName) document.getElementById("name").value = savedName;
      } catch {}
    });

    // ======= intl-tel-input init after DOM ready =======
    document.addEventListener('DOMContentLoaded', function () {
      const input = document.getElementById('mobile');
      if (!input) return;

      countryCodeInput = window.intlTelInput(input, {
        utilsScript: "https://cdn.jsdelivr.net/npm/intl-tel-input@24.4.0/build/js/utils.js",
        countryOrder:["sa","qa"],
        initialCountry:"sa",
        onlyCountries:["sa","qa","ae","om","kw","bh"],
        excludeCountries:["il"],
        strictMode:true,
        i18n:{ /* ... (your Arabic i18n map can be inserted here if needed) ... */ }
      });

      const errorMap = ["رقم غير صحيح", "رمز دولة غير صحيح", "المُدخل أقصر من المتوقع", "المُدخل أطول من المتوقع", "رقم غير صحيح"];
      input.addEventListener("change", () => {
        // Example logs
        if (countryCodeInput) {
          console.log(countryCodeInput.getNumber().substring(1));
          console.log(countryCodeInput.isValidNumber());
          const msg = errorMap[countryCodeInput.getValidationError()] || "رقم غير صحيح";
          console.log(msg);
        }
      });

      // load saved phone if any
      try {
        const savedMobile = localStorage.getItem("mobile");
        if (savedMobile) countryCodeInput.setNumber("+" + savedMobile);
      } catch {}
    });

    // ======= Locale & date init =======
    document.addEventListener('DOMContentLoaded', () => {
      const userLang = navigator.language || navigator.userLanguage || '';
      document.getElementById("date").setAttribute("dir", userLang.includes("ar") ? "rtl" : "ltr");
      document.getElementById("date").setAttribute("min", new Date().toLocaleDateString("fr-ca"));
      document.getElementById("date").value = DateTime.now().toFormat('yyyy-MM-dd');
    });

    // ======= Data & helpers =======
    let controllers = [];
    let services, serviceCategories;

    async function callContent2(routText, callback, abortable = false, retries = 3) {
      let signal = '';
      if (abortable) {
        if (controllers.length) {
          controllers.forEach(([c]) => c.abort());
          controllers = [];
        }
        const controller = new AbortController();
        signal = controller.signal;
        controllers.push([controller, signal]);
      }

      await new Promise(r => setTimeout(r, 500));
      fetch(defaultLink2 + `${routText}`, {
        redirect: "follow",
        method: "GET",
        ...(abortable && { signal })
      })
      .then(async (response) => {
        if (!response.ok) {
          if (retries > 0) return callContent2(routText, callback, abortable, retries - 1);
          throw new Error('Network response was not ok');
        }
        const jsonresponse = await response.json();
        callback(jsonresponse);
      })
      .catch(err => {
        console.log("Error:", err);
        if (!String(err.message).includes("aborted") && retries > 0) {
          setTimeout(() => callContent2(routText, callback, abortable, retries - 1), 1500);
        }
      });
    }

    function handleSubmit(e){ e.preventDefault(); }

    // ======= Load locations =======
    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById("page2-spinner").style.display = "block";
      callContent2(`/locations`, (data) => {
        const select = $('#area');
        const list = (data && data.data) || [];
        const selectData = list
          .map(loc => ({ id: loc.id, text: loc.TS_location_arabic_name }))
          .sort((a,b) => a.id - b.id);

        $('.js-example-basic-single').select2({ data: selectData, width: "90%" });
        $('#area').trigger('change');
        document.getElementById("page2-spinner").style.display = "none";
      });
    });

    // ======= Date and time grids =======
    let day1 = DateTime.now();
    let day2 = day1.plus({days:1});
    let day3 = day1.plus({days:2});
    let dates = [day1, day2, day3];

    const weekdays = ["الأحد","الإثنين","الثلاثاء","الأربعاء","الخميس","الجمعة","السبت","الأحد"];
    let appointments = [[],[],[]];
    let ActualTimes = [[],[],[]];
    let timesLoaded = false;

    function setHeaderDates(ds) {
      for (let i = 1; i <= 3; i++) {
        const d = ds[i-1];
        document.getElementById(`day${i}`).innerText = weekdays[d.weekday];
        document.getElementById(`day${i}date`).innerText = d.toFormat('yyyy-MM-dd');
      }
    }
    document.addEventListener('DOMContentLoaded', () => setHeaderDates(dates));

    document.getElementById('date').onchange = () => {
      const dateInput = document.getElementById('date');
      dateInput.disabled = true;

      const tc = document.getElementById('time-container');
      tc.innerHTML = `<div id="department-spinner" class="spinner-border" role="status" style="grid-column: 1/-1; justify-self:center;"></div>`;
      ActualTimes = [[],[],[]];
      appointments = [[],[],[]];
      timesLoaded = false;

      day1 = DateTime.fromISO(dateInput.value);
      day2 = day1.plus({days:1});
      day3 = day1.plus({days:2});
      setHeaderDates([day1,day2,day3]);

      callContent2(`/appointments?startDate=${day1.toFormat('yyyy-MM-dd')}&location=${document.getElementById("area").value}&service=${document.getElementById("service").value}`,
        (data) => {
          const recieved = (data && data.data && data.data.appointments) || [];
          const tempActual = [];

          for (let i = 0; i < recieved.length; i++) {
            const x = DateTime.fromISO(recieved[i]['TS_appointment_date'], { setZone: true });
            const y = DateTime.fromISO(recieved[i]['TS_appointment_time'], { setZone: true });
            recieved[i]['TS_appointment_date'] = x.toISODate();
            recieved[i]['TS_appointment_time'] = y.toLocaleString(DateTime.TIME_SIMPLE).replace(" ", " ");
            tempActual[i] = y.toFormat('hh:mm a');
          }

          for (let i = 0; i < recieved.length; i++) {
            const d = recieved[i]["TS_appointment_date"];
            if (d === day1.toFormat('yyyy-MM-dd')) { appointments[0].push(recieved[i]['TS_appointment_time']); ActualTimes[0].push(tempActual[i]); }
            else if (d === day2.toFormat('yyyy-MM-dd')) { appointments[1].push(recieved[i]['TS_appointment_time']); ActualTimes[1].push(tempActual[i]); }
            else if (d === day3.toFormat('yyyy-MM-dd')) { appointments[2].push(recieved[i]['TS_appointment_time']); ActualTimes[2].push(tempActual[i]); }
          }

          timesLoaded = true;
          timesSetter(0); // render 1st day
          dateInput.disabled = false;
        },
        true
      );
    };

    function timesSetter(index) {
      const tc = document.getElementById("time-container");
      tc.innerHTML = "";
      if (!appointments[index].length) {
        tc.innerHTML = `<div style="grid-column:1/-1; justify-self:center;">لا توجد مواعيد متاحة</div>`;
        return;
      }
      const dayDate = document.getElementById(`day${index+1}date`).innerText;

      // Create buttons safely (no nested template literals)
      for (let y = 0; y < appointments[index].length; y++) {
        const btn = document.createElement('button');
        btn.className = 'time-button';
        btn.dir = 'ltr';
        btn.textContent = appointments[index][y];
        const actual = ActualTimes[index][y];
        btn.addEventListener('click', () => choosedDate(actual, dayDate, 4));
        tc.appendChild(btn);
      }
    }

    // ======= Area/services =======
    $("#area").on("change", () => {
      document.getElementById("page3-1-spinner").style.display = "block";
      document.getElementById("page3-2-spinner").style.display = "block";
      document.getElementById('serviceCat').innerHTML = '';
      document.getElementById('service').innerHTML = '';

      callContent2(`/services?location=${document.getElementById("area").value}`, (data) => {
        services = data.data.services;
        serviceCategories = data.data.servicesCat;

        const byCat = {};
        services.forEach(s => {
          const cid = s.TS_category_id;
          if (!byCat[cid]) byCat[cid] = { category: serviceCategories.find(c => c.TS_category_id === cid), services: [], locations: new Set() };
          byCat[cid].services.push(s);
          s.location.forEach(l => byCat[cid].locations.add(l));
        });

        servicesDropdownLoader2(byCat);

        document.getElementById("page3-1-spinner").style.display = "none";
        document.getElementById("page3-2-spinner").style.display = "none";
      }, true);
    });

    function add_dropdown_list(show_list, value_list, element_id){
      const parent = document.getElementById(element_id);
      parent.innerHTML = "";
      for (let i = 0; i < value_list.length; i++) {
        const opt = document.createElement("option");
        opt.text = show_list[i]; opt.value = value_list[i];
        if (i === 0) opt.selected = true;
        parent.appendChild(opt);
      }
      parent.dispatchEvent(new Event('change'));
    }

    function servicesDropdownLoader2(data) {
      // categories
      const catIDs = Object.keys(data);
      const catNames = catIDs.map(id => data[id].category.TS_category_arabic_name);
      add_dropdown_list(catNames, catIDs, "serviceCat");

      document.getElementById('serviceCat').addEventListener('change', function(){
        const cid = document.getElementById("serviceCat").value;
        const sortedServices = data[cid].services.sort((a,b) => a.TS_service_id - b.TS_service_id);
        const ids = sortedServices.map(s => s.TS_service_id);
        const names = sortedServices.map(s => s.TS_service_arabic_name);
        add_dropdown_list(names, ids, "service");
      });

      document.getElementById('service').addEventListener('change', () => {
        document.getElementById('date').dispatchEvent(new Event('change'));
      });

      document.getElementById('serviceCat').dispatchEvent(new Event('change'));
    }

    // ======= Multi-page navigation =======
    const nForm = { date:'', time:'', location:'', service:'', serviceCount:'', serviceCat:'', customerM:'', customerN:'', paymentMethod:'', urlLocation:'', locationDescription:'' };
    const formData = [];

    // Page 1 -> 2
    document.getElementById('page1-button').onclick = () => {
      showPage(1,2);
    };

    // Page 2 -> 3
    document.getElementById('page2-button').onclick = () => {
      const area = document.getElementById("area");
      if (!area.value) { document.getElementById("page2-form").reportValidity(); return; }
      formData[0] = area.value;
      nForm.location = area.value;
      showPage(2,3);
    };

    // Page 3 buttons are hidden (auto-advance logic below)

    // Page 4 -> back
    document.getElementById('page4-return').onclick = () => showPage(4,2);

    // Page 5 -> 6
    document.getElementById('page5-button').onclick = () => {
      const name = document.getElementById("name");
      const form = document.getElementById("page5-form");
      let method = "";

      try {
        method = document.querySelector('input[name="payingMethod"]:checked').value;
        if (name.value.trim() === "") {
          name.setCustomValidity("يُرجى ملئ هذا الحقل");
          throw new Error("no name");
        }
      } catch {
        form.reportValidity(); return;
      }
      if (!checkNumberValidity()) { form.reportValidity(); return; }

      nForm.paymentMethod = method;
      nForm.customerN = name.value.trim();
      nForm.customerM = countryCodeInput.getNumber().substring(1);

      formData[4] = nForm.customerN;
      formData[5] = nForm.customerM;
      formData[8] = method;

      showPage(5,6);
    };

    document.getElementById('page5-return').onclick = () => showPage(5,4);

    // Page 6 -> submit AFTER terms modal
    document.getElementById('page6-button').onclick = () => {
      if (!position) {
        infoWindow.setPosition(map.getCenter());
        infoWindow.setContent("الرجاء تحديد الموقع");
        infoWindow.open(map);
        return;
      }
      const termsModalEl = document.getElementById('termsModal');
      const termsModal = new bootstrap.Modal(termsModalEl);
      const accept = document.getElementById('termsAccept');
      const confirmBtn = document.getElementById('confirmTerms');
      accept.checked = false;
      confirmBtn.disabled = true;
      accept.onchange = () => { confirmBtn.disabled = !accept.checked; };
      termsModal.show();

      confirmBtn.onclick = () => {
        termsModal.hide();
        finalizeReservation();
      };
    };

    document.getElementById('page6-return').onclick = () => showPage(6,5);

    function showPage(from, to) {
      const p1 = document.getElementById(`page${from}`);
      const p2 = document.getElementById(`page${to}`);
      p1.classList.remove("fadeIn"); p1.classList.add("fadeOut");
      p2.classList.remove("fadeOut"); p2.classList.add("fadeIn");
      setTimeout(() => { p1.style.display = "none"; p2.style.display = "flex"; }, 300);
    }

    function choosedDate(time12, dateISO, currentPageIndex) {
      formData[2] = dateISO;
      formData[3] = time12;

      nForm.date = dateISO;
      const parsed = DateTime.fromFormat(time12, "h:mm a");
      nForm.time = parsed.toFormat("HH:mm");

      showPage(currentPageIndex, currentPageIndex + 1);
    }

    function checkNumberValidity() {
      const number = document.getElementById("mobile");
      const phoneNumber = countryCodeInput?.getNumber().substring(1);
      if (!countryCodeInput || isNaN(phoneNumber) || !countryCodeInput.isValidNumber() || !phoneNumber) {
        number.setCustomValidity("رقم غير صحيح");
        return false;
      }
      number.setCustomValidity("");
      return true;
    }

    // ======= Map & boundaries =======
    let map, infoWindow, marker, polygon = null;
    let position = "";
    const prePosition = "https://www.google.com/maps/search/?api=1&query=";
    let defaultLocation = { lat: 26.34165524787632, lng: 50.11524831545726 };

    function myMap() {
      map = new google.maps.Map(document.getElementById("googleMap"), {
        center: defaultLocation,
        zoom: 12,
        disableDoubleClickZoom: true
      });

      infoWindow = new google.maps.InfoWindow();

      marker = new google.maps.Marker({
        position: defaultLocation,
        map,
        draggable: true,
        title: "اضغط أو اسحب لتحديد الموقع",
      });

      marker.addListener("dragend", (e) => validateAndSetPosition(e.latLng));
      map.addListener("click", (e) => validateAndSetPosition(e.latLng));
      map.addListener("dblclick", (e) => validateAndSetPosition(e.latLng)); // removed e.stop()

      let pressTimer;
      map.addListener("mousedown", (e) => { pressTimer = setTimeout(() => validateAndSetPosition(e.latLng), 600); });
      map.addListener("mouseup",   ()  => { clearTimeout(pressTimer); });
      map.addListener("touchstart",(e) => { pressTimer = setTimeout(() => validateAndSetPosition(e.latLng), 600); });
      map.addListener("touchend",  ()  => { clearTimeout(pressTimer); });

      const dragHint = document.getElementById("drag-instructions");
      setTimeout(() => { dragHint.style.display = "none"; }, 5000);
      map.addListener("dragstart", () => { dragHint.style.display = "none"; });
    }
    window.myMap = myMap; // <-- expose globally for callback

    function validateAndSetPosition(latLng) {
      if (polygon && !google.maps.geometry.poly.containsLocation(latLng, polygon)) {
        alert("⚠️ عذرًا، موقعك خارج نطاق الخدمة");
        position = "";
        infoWindow.setContent("🚫 موقع خارج الخدمة");
        infoWindow.open(map);
        return;
      }
      marker.setPosition(latLng);
      map.panTo(latLng);
      map.setZoom(17);
      position = `${prePosition}${latLng.lat()},${latLng.lng()}`;
      infoWindow.setContent("✅ تم تحديث موقعك هنا");
      infoWindow.open(map, marker);
    }

    function setBoundries() {
      const areaSelect = document.getElementById("area");
      const selectedArea = areaSelect.options[areaSelect.selectedIndex]?.text?.trim();
      let APP_Location, polygonCoords;

      if (selectedArea === "العزيزية - الخبر") {
        APP_Location = { north: 26.237892901838705, south: 26.15102181049713, west: 50.090294685184475, east: 50.234894203935546 };
        polygonCoords = [
          { lng: 50.215045355428195, lat: 26.219724394350184 },
          { lng: 50.2135291654911,   lat: 26.1870383495685 },
          { lng: 50.137875179099595, lat: 26.069703060741347 },
          { lng: 50.10628808282646,  lat: 26.15001891083389 },
          { lng: 50.143828288837895, lat: 26.21660551929113 },
          { lng: 50.19603263782255,  lat: 26.21897351180097 },
        ];
      } else if (selectedArea === "أجيال - أرامكو") {
        APP_Location = { north: 26.289037271670438, south: 26.237817336683204, west: 50.05143566513406, east: 50.096905737932595 };
        polygonCoords = [
          { lng: 50.06256215323989,  lat: 26.275519772515292 },
          { lng: 50.070562455580834, lat: 26.277608292466685 },
          { lng: 50.08514528516432,  lat: 26.257720425641132 },
          { lng: 50.06822454797902,  lat: 26.24524748257814 },
          { lng: 50.06115405632103,  lat: 26.262628935642045 },
          { lng: 50.05894452767791,  lat: 26.267950423932856 },
        ];
      } else if (selectedArea === "الدوحة و الدانة") {
        APP_Location = { north: 26.37969652644046, south: 26.277002257490476, west: 50.11899625151807, east: 50.195753733969404 };
        polygonCoords = [
          { lng: 50.11488540829821, lat: 26.341056543806932 },
          { lng: 50.136645122501264, lat: 26.353671078060277 },
          { lng: 50.14577577434936,  lat: 26.363004767230812 },
          { lng: 50.178697561294584, lat: 26.332926849815746 },
          { lng: 50.17972636713662,  lat: 26.31448441448552 },
          { lng: 50.16468008169681,  lat: 26.29799900302895 },
        ];
      } else {
        alert("⚠️ المنطقة غير معرفة، يرجى الاختيار الصحيح");
        return;
      }

      defaultLocation = { lat: (APP_Location.north + APP_Location.south)/2, lng: (APP_Location.east + APP_Location.west)/2 };
      if (polygon) polygon.setMap(null);

      polygon = new google.maps.Polygon({
        paths: polygonCoords, strokeColor:"#ff0000", strokeOpacity:0.4, strokeWeight:2, fillColor:"#00ff00", fillOpacity:0.1
      });
      polygon.setMap(map);

      map.setCenter(defaultLocation);
      map.setZoom(14);
      marker.setPosition(defaultLocation);
      position = `${prePosition}${defaultLocation.lat},${defaultLocation.lng}`;
    }
    window.setBoundries = setBoundries;

    function detectMyLocation() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          (pos) => {
            const userPos = new google.maps.LatLng(pos.coords.latitude, pos.coords.longitude);
            if (polygon && !google.maps.geometry.poly.containsLocation(userPos, polygon)) {
              alert("⚠️ عذرًا، موقعك خارج نطاق الخدمة");
              return;
            }
            marker.setPosition(userPos);
            map.panTo(userPos);
            map.setZoom(17);
            position = `${prePosition}${pos.coords.latitude},${pos.coords.longitude}`;
            infoWindow.close();
          },
          () => handleLocationError(true)
        );
      } else {
        handleLocationError(false);
      }
    }
    document.addEventListener("DOMContentLoaded", () => {
      const btn = document.getElementById("show-my-location");
      if (btn) btn.addEventListener("click", detectMyLocation);
    });

    function handleLocationError(browserHasGeolocation) {
      infoWindow.setPosition(map.getCenter());
      infoWindow.setContent(browserHasGeolocation ? "⚠️ تعذر الحصول على موقعك. يرجى السماح بالوصول للموقع." : "⚠️ جهازك لا يدعم تحديد الموقع.");
      infoWindow.open(map);
    }

    // ======= Reserve flow (Page 6 confirm) =======
    function finalizeReservation() {
      const pb1 = document.getElementById('page6-button');
      const backBtn = document.getElementById('page6-return');
      const pageSpinner = document.getElementById('page6-spinner');
      const failAlert = document.getElementById('fail-alert-5');

      backBtn.style.display = "none";
      pb1.style.display = "none";
      failAlert.style.display = "none";
      pageSpinner.style.display = "flex";
      pageSpinner.children[1].style.display = "block";

      nForm.urlLocation = position;

      const x = document.getElementById("locationDescription");
      if (x.value.trim().length > 200) {
        x.setCustomValidity("الوصف أطول من المتوقع");
        document.getElementById("page6-form").reportValidity();
        backBtn.style.display = "inline-block";
        pb1.style.display = "inline-block";
        pageSpinner.style.display = "none";
        pageSpinner.children[1].style.display = "none";
        return;
      }
      nForm.locationDescription = x.value;

      fetch(defaultLink2 + `/reserveAppointment`, {
        redirect: "follow",
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(nForm)
      })
      .then(async (response) => {
        pageSpinner.style.display = 'none';
        if (!response.ok) {
          const errJson = await response.json().catch(()=>({}));
          throw { response: errJson };
        }
        const data = await response.json();
        if (data.success) {
          showPage(6,7);
          if (confirm(`عزيزنا/عزيزتنا, ودك نتذكر بياناتك على هذا الجهاز لتسهيل الغسلات الجاية ؟`)) {
            localStorage.setItem("name", document.getElementById("name").value);
            localStorage.setItem("mobile", countryCodeInput.getNumber().substring(1));
          } else {
            localStorage.removeItem("name"); localStorage.removeItem("mobile");
          }
        }
      })
      .catch(async err => {
        console.log("Reserve error:", err);
        backBtn.style.display = "inline-block";
        pb1.style.display = "inline-block";
        const p1 = document.getElementById('page6');
        const p2 = document.getElementById('page4');
        p1.classList.remove("fadeIn"); p1.classList.add("fadeOut");
        p2.classList.remove("fadeOut"); p2.classList.add("fadeIn");
        p1.style.display = "none"; p2.style.display = "flex";
        const failAlert3 = document.getElementById('fail-alert-3');
        failAlert3.style.display = "block";
        failAlert3.children[0].innerHTML = (err.response && err.response.msgAR) ? err.response.msgAR : "عذرًا حصل خطأ غير متوقع الرجاء التواصل معنا";
        failAlert3.children[2].innerHTML = "";
        document.getElementById('date').dispatchEvent(new Event('change'));
      });
    }

    // ======= Car brand list & select2 =======
    document.addEventListener('DOMContentLoaded', () => {
      const brands = ["Acura","Alfa Romeo","Aston Martin","Audi","Bentley","BMW","Bugatti","Buick","Cadillac","Chevrolet","Chrysler","Citroën","Dacia","Daewoo","Daihatsu","Dodge","Ferrari","Fiat","Ford","Genesis","GMC","Haval","Holden","Honda","Hummer","Hyundai","Infiniti","Isuzu","Jaguar","Jeep","Kia","Koenigsegg","Lada","Lamborghini","Lancia","Land Rover","Lexus","Lincoln","Lotus","Maserati","Maybach","Mazda","McLaren","Mercedes-Benz","Mercury","MG","Mini","Mitsubishi","Nissan","Opel","Pagani","Peugeot","Plymouth","Pontiac","Porsche","RAM","Renault","Rolls-Royce","Saab","Saturn","Scion","Seat","Skoda","Smart","SsangYong","Subaru","Suzuki","Tata","Tesla","Toyota","Volkswagen","Volvo","Wiesmann","Zotye"];
      const brandSelect = $('#carBrand');
      brands.sort().forEach(b => brandSelect.append(`<option value="${b}">${b}</option>`));
      brandSelect.select2({ placeholder:"Select a car brand", allowClear:true, width: 'resolve' });

      // plate enforce numeric <=4
      const plate = document.getElementById('plateNumber');
      plate.addEventListener('input', function(){
        this.value = this.value.replace(/\D/g, '').slice(0,4);
        this.setCustomValidity('');
        updateLocationDescription();
      });
    });

    function updateLocationDescription() {
      const brand = document.getElementById("carBrand").value || "";
      const name  = document.getElementById("carName").value || "";
      const plate = document.getElementById("plateNumber").value || "";
      document.getElementById("locationDescription").value = [brand, name, plate].filter(Boolean).join(", ");
    }

    // Auto transition page3->page4 after shown for 5s
    (function(){
      const page3 = document.getElementById('page3');
      const nextBtn = document.getElementById('page3-button');
      if (!page3 || !nextBtn) return;
      const obs = new MutationObserver(() => {
        if (page3.style.display === 'flex') {
          setTimeout(() => nextBtn.click(), 5000);
        }
      });
      obs.observe(page3, { attributes:true, attributeFilter:['style'] });
    })();

    // Rebook
    document.getElementById("rebook")?.addEventListener("click", () => {
      window.location.href = "https://www.spongnsoap.com/";
    });
  </script>

  <!-- Google Maps (exposes callback=myMap) -->
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBBHLoO038vsCovHN-SLUgAXqexlA2v0_4&callback=myMap&libraries=geometry" async defer></script>
</body>
</html>
