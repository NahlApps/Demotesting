<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, viewport-fit=cover"
  />
  <title>Maison Hikari â€¢ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</title>

  <!-- Fonts & Icons -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap"
    rel="stylesheet"
  />
  <link
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    rel="stylesheet"
  />

  <!-- Bootstrap & Tel Input -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <link
    href="https://cdn.jsdelivr.net/npm/intl-tel-input@24.4.0/build/css/intlTelInput.css"
    rel="stylesheet"
  />

  <style>
    :root{
      --bg:#fafafa;
      --ink:#0b0d13;
      --muted:#6b7280;
      --rule:#e6e6e6;
      --brand:#111;
      --cta:#111;
      --cta-ink:#fff;
      --chip:#f1f1f1;
      --chip-ink:#111;
      --radius:14px;
      --radius-pill:999px;
      --shadow:0 10px 30px rgba(0,0,0,.08);
      --ease:cubic-bezier(.22,.61,.36,1);
    }
    html,body{height:100%}
    body{
      font-family:'Cairo',system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--ink); background:var(--bg);
      display:flex; flex-direction:column;
      -webkit-tap-highlight-color: transparent;
    }

    /* Header */
    .app-header{
      position:sticky; top:0; z-index:50;
      background:#fff; border-bottom:1px solid var(--rule);
      backdrop-filter: saturate(1.2) blur(6px);
    }
    .brand{font-weight:900; letter-spacing:.3px}
    .cart-btn{
      position:relative; min-width:46px; min-height:46px;
      border-radius:var(--radius-pill);
      border:1px solid var(--rule); background:#fff;
    }
    .cart-badge{
      position:absolute; top:-6px; inset-inline-start:-6px;
      background:#111; color:#fff; border-radius:999px;
      font-size:.75rem; padding:2px 7px; font-weight:900;
      box-shadow:0 6px 16px rgba(0,0,0,.18);
    }

    main{flex:1 1 auto; display:flex; flex-direction:column}

    /* Sticky category chips bar */
    .chips-wrap{
      position:sticky; top:62px; z-index:40;
      background:linear-gradient(#fff,#fffcc0 0) top/100% 0 no-repeat,#fff;
      border-bottom:1px solid var(--rule);
      padding:10px 12px;
    }
    .chip{
      background:var(--chip); color:var(--chip-ink);
      border:1px solid var(--rule); border-radius:var(--radius-pill);
      padding:10px 14px; font-weight:800; font-size:.95rem;
      transition:all .18s var(--ease); cursor:pointer;
      min-height:44px;
    }
    .chip.active{ background:#111; color:#fff; border-color:#111 }

    /* Search */
    .searchbox{
      border:1px solid var(--rule); border-radius:var(--radius-pill);
      overflow:hidden; background:#fff;
    }
    .searchbox input{ border:0; padding:12px 16px; min-height:46px; }

    /* Cards */
    .menu-grid{ display:grid; gap:14px; grid-template-columns:repeat(1,minmax(0,1fr)); }
    @media(min-width:640px){ .menu-grid{ grid-template-columns:repeat(2,minmax(0,1fr)); } }
    @media(min-width:992px){ .menu-grid{ grid-template-columns:repeat(3,minmax(0,1fr)); } }
    .dish{
      background:#fff; border:1px solid var(--rule); border-radius:var(--radius);
      overflow:hidden; box-shadow:var(--shadow);
      display:grid; grid-template-columns:120px 1fr; gap:12px;
    }
    .dish-img{ width:120px; height:120px; object-fit:cover }
    .dish-body{ padding:12px 12px 14px }
    .dish h6{ font-weight:900; margin:0 0 4px }
    .price{ font-weight:900 }
    .tags{ display:flex; flex-wrap:wrap; gap:6px; }
    .tag{ border:1px solid var(--rule); border-radius:999px; padding:4px 8px; font-size:.8rem; color:#555 }

    /* Controls */
    .add-wrap{ display:flex; align-items:center; gap:8px; margin-top:8px }
    .qty{
      display:inline-grid; grid-auto-flow:column; gap:6px; align-items:center;
      border:1px solid var(--rule); border-radius:999px; padding:4px;
      min-height:42px;
    }
    .qty button{ width:36px; height:36px; border:0; background:#f6f6f6; border-radius:999px; font-weight:900 }
    .add-btn{
      flex:1; min-height:44px; border-radius:999px; border:1px solid #111;
      background:#111; color:#fff; font-weight:900;
    }

    /* Mini checkout bar */
    .mini-bar{
      position:sticky; bottom:0; z-index:45;
      background:#0a0a0a; color:#fff; padding:10px 12px;
      border-top:1px solid rgba(255,255,255,.12);
      padding-bottom: calc(10px + env(safe-area-inset-bottom));
    }
    .mini-btn{
      min-height:48px; border-radius:999px; font-weight:900;
    }

    /* Drawer cart */
    .drawer{
      position:fixed; inset-block:0; inset-inline-start:0; width:min(420px,92vw);
      background:#fff; border-inline-end:1px solid var(--rule); box-shadow: 0 30px 80px rgba(0,0,0,.25);
      transform:translateX(-100%); transition:transform .28s var(--ease); z-index:60;
      display:flex; flex-direction:column;
    }
    .drawer.open{ transform:none }
    .drawer-header{ padding:12px; border-bottom:1px solid var(--rule); display:flex; align-items:center; justify-content:space-between }
    .drawer-body{ padding:12px; overflow:auto }
    .drawer-footer{ padding:12px; border-top:1px solid var(--rule) }
    .line{ display:flex; align-items:center; gap:10px; justify-content:space-between; padding:10px 0; border-bottom:1px dashed var(--rule) }

    /* Tabs */
    .nav-underline .nav-link{ color:#555; font-weight:800 }
    .nav-underline .nav-link.active{ color:#111; border-color:#111 }

    /* ===== Ø¨ÙŠØ§Ù†Ø§Øª page polish ===== */
    .card-paper{ background:#fff; border:1px solid var(--rule); border-radius:var(--radius); box-shadow:var(--shadow) }
    .seg{display:inline-grid; grid-auto-flow:column; gap:8px; background:#F6F6F6;
      padding:6px; border-radius:999px; border:1px solid var(--rule)}
    .seg button{
      background:#fff; border:1px solid var(--rule); border-radius:999px;
      padding:11px 16px; min-height:44px; font-weight:900; cursor:pointer;
      transition:background .2s var(--ease), color .2s var(--ease), border-color .2s var(--ease);
    }
    .seg button[aria-pressed="true"]{background:#0A0A0A; color:#fff; border-color:#0A0A0A}

    #etaBadge{background:#E6F6FE; color:#0369A1; padding:4px 10px; border-radius:999px; font-weight:800}
    .inp-wrap{position:relative}
    .inp-wrap .ico{
      position:absolute; inset-inline-start:12px; inset-block-start:50%;
      transform:translateY(-50%); color:#6b7280; pointer-events:none;
    }
    .pad-icon{padding-inline-start:42px}
    .form-control, .form-select{ min-height:56px }

    /* intlTelInput fixes */
    .iti{width:100%}
    html[dir="rtl"] .iti--allow-dropdown .iti__flag-container{left:12px; right:auto}
    html[dir="rtl"] #custPhone.form-control{padding-inline-start:76px}
    .iti__country-list{
      z-index: 10000 !important; max-height: 320px !important; overflow:auto !important;
      border-radius:10px; box-shadow:0 18px 38px rgba(0,0,0,.18);
    }
    .iti__country.iti__highlight{background:#F5F5F5}
    .iti__search-results{display:none}

    /* Footer spacing helper on long pages */
    .spacer{height:18vh}
  </style>
</head>
<body>

  <!-- Header -->
  <header class="app-header">
    <div class="container py-2 d-flex align-items-center justify-content-between gap-2">
      <div class="d-flex align-items-center gap-3">
        <img src="https://images.unsplash.com/photo-1544025162-d76694265947?q=80&w=120&auto=format&fit=crop" alt="" width="44" height="44" style="border-radius:12px;object-fit:cover">
        <div>
          <div class="brand">Maison Hikari</div>
          <small class="text-secondary">Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙŠØ§Ø¨Ø§Ù†ÙŠØ©</small>
        </div>
      </div>

      <button id="openCart" class="cart-btn px-3">
        <i class="fa-solid fa-bag-shopping"></i>
        <span id="badge" class="cart-badge">0</span>
      </button>
    </div>

    <!-- Tabs -->
    <div class="container">
      <ul class="nav nav-underline">
        <li class="nav-item"><a class="nav-link active" data-bs-toggle="tab" href="#tab-menu">Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</a></li>
        <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#tab-data">Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</a></li>
      </ul>
    </div>
  </header>

  <main>
    <div class="tab-content flex-1">

      <!-- MENU -->
      <section id="tab-menu" class="tab-pane fade show active">
        <!-- Sticky chips + search -->
        <div class="chips-wrap">
          <div class="container">
            <div class="row g-2 align-items-center">
              <div class="col-12 col-lg-8">
                <div id="chips" class="d-flex flex-wrap gap-2">
                  <button class="chip active" data-cat="all">Ø§Ù„ÙƒÙ„</button>
                  <button class="chip" data-cat="sushi">Ø³ÙˆØ´ÙŠ</button>
                  <button class="chip" data-cat="don">Ø¯ÙˆÙ†</button>
                  <button class="chip" data-cat="meat">Ù„Ø­ÙˆÙ…</button>
                  <button class="chip" data-cat="drinks">Ù…Ø´Ø±ÙˆØ¨Ø§Øª</button>
                </div>
              </div>
              <div class="col-12 col-lg-4">
                <div class="searchbox d-flex">
                  <input id="q" type="search" class="form-control" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø·Ø¨Ù‚ â€¦" />
                  <button class="btn" aria-label="Ø¨Ø­Ø«"><i class="fa-solid fa-magnifying-glass"></i></button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Menu grid -->
        <div class="container py-3">
          <div id="grid" class="menu-grid"></div>
          <div class="spacer"></div>
        </div>

        <!-- Mini checkout bar -->
        <div class="mini-bar">
          <div class="container d-flex align-items-center gap-2">
            <div class="flex-grow-1">
              <div class="d-flex align-items-baseline gap-2">
                <strong id="miniCount">0 Ø¹Ù†ØµØ±</strong>
                <span class="text-white-50">â€¢</span>
                <strong id="miniTotal">0.00 Ø±.Ø³</strong>
              </div>
              <small class="text-white-50">ÙŠÙØ¶Ø§Ù Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¯ÙØ¹</small>
            </div>
            <button id="miniCartBtn" class="btn btn-outline-light mini-btn"><i class="fa-solid fa-bag-shopping"></i> Ø¹Ø±Ø¶ Ø§Ù„Ø³Ù„Ø©</button>
            <a href="#tab-data" data-bs-toggle="tab" id="nextBtn" class="btn btn-light mini-btn text-dark">Ø§Ù„ØªØ§Ù„ÙŠ</a>
          </div>
        </div>
      </section>

      <!-- DATA -->
      <section id="tab-data" class="tab-pane fade">
        <div class="container py-4">
          <div class="d-flex align-items-center gap-2 mb-3">
            <div class="seg" role="tablist" aria-label="Ù†ÙˆØ¹ Ø§Ù„Ø·Ù„Ø¨">
              <button id="segPickup" class="btn" aria-pressed="true" type="button">Ø§Ø³ØªÙ„Ø§Ù…</button>
              <button id="segDelivery" class="btn" aria-pressed="false" type="button">ØªÙˆØµÙŠÙ„</button>
            </div>
            <span id="etaBadge">ETA ~ 15</span>
          </div>

          <div class="card-paper p-3 p-md-4">
            <div class="row g-3">
              <div class="col-12 col-md-6">
                <label class="form-label fw-bold">Ø§Ù„Ø§Ø³Ù…</label>
                <div class="inp-wrap">
                  <i class="fa-regular fa-user ico"></i>
                  <input id="custName" class="form-control pad-icon" placeholder="Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ§Ù…Ù„" />
                </div>
                <div id="err-name" class="text-danger small d-none mt-2">ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù…</div>
              </div>
              <div class="col-12 col-md-6">
                <label class="form-label fw-bold">Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„</label>
                <input id="custPhone" class="form-control" type="tel" placeholder="5XXXXXXXX" />
                <div id="ok-phone" class="text-success small d-none mt-2">Ø±Ù‚Ù… ØµØ­ÙŠØ­ âœ…</div>
                <div id="err-phone" class="text-danger small d-none mt-2">Ø±Ù‚Ù… ØºÙŠØ± ØµØ§Ù„Ø­</div>
              </div>

              <div class="col-12" id="addressWrap" style="display:none">
                <label class="form-label fw-bold">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
                <div class="inp-wrap">
                  <i class="fa-solid fa-location-dot ico"></i>
                  <input id="address" class="form-control pad-icon" placeholder="Ø§Ù„Ø­ÙŠØŒ Ø§Ù„Ø´Ø§Ø±Ø¹ØŒ Ø¹Ù„Ø§Ù…Ø© Ù…Ù…ÙŠØ²Ø©" />
                </div>
                <div id="err-address" class="text-danger small d-none mt-2">Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ù„Ù„ØªÙˆØµÙŠÙ„</div>
                <small class="text-secondary" id="typeHint"></small>
              </div>

              <div class="col-12">
                <label class="form-label fw-bold">Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                <textarea id="notes" class="form-control" maxlength="140" placeholder="Ù„Ø§ Ø«Ù„Ø¬ØŒ Ø­Ø§Ø±ØŒ Ø¨Ø¯ÙˆÙ† Ø¨ØµÙ„ â€¦"></textarea>
                <div class="d-flex small text-secondary mt-2">
                  <span>Ù†Ø­Ø§ÙˆÙ„ ØªÙ†ÙÙŠØ° ØªÙØ¶ÙŠÙ„Ø§ØªÙƒ Ø¨Ù‚Ø¯Ø± Ø§Ù„Ø¥Ù…ÙƒØ§Ù†</span>
                  <span class="ms-auto">(<span id="notesCount">0</span>/140)</span>
                </div>
              </div>
            </div>
          </div>

          <div class="d-flex gap-2 mt-3">
            <a href="#tab-menu" data-bs-toggle="tab" class="btn btn-outline-dark flex-fill py-3 fw-bold">Ø§Ù„Ø³Ù„Ø©</a>
            <button id="confirmBtn" class="btn btn-dark flex-fill py-3 fw-bold">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨</button>
          </div>
        </div>
        <div class="spacer"></div>
      </section>

    </div>
  </main>

  <!-- Drawer Cart -->
  <aside id="drawer" class="drawer" aria-label="Ø³Ù„Ø© Ø§Ù„Ø·Ù„Ø¨">
    <div class="drawer-header">
      <strong>Ø³Ù„Ø© Ø§Ù„Ø·Ù„Ø¨</strong>
      <button id="closeCart" class="btn btn-sm btn-outline-dark"><i class="fa-solid fa-xmark"></i></button>
    </div>
    <div id="cartList" class="drawer-body"></div>
    <div class="drawer-footer">
      <div class="d-flex justify-content-between">
        <span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</span>
        <strong id="cartTotal">0.00 Ø±.Ø³</strong>
      </div>
      <a href="#tab-data" data-bs-toggle="tab" class="btn btn-dark w-100 mt-2 py-3 fw-bold">Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨</a>
      <div class="mt-2 small text-secondary">ÙŠÙØ¶Ø§Ù Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¯ÙØ¹</div>
    </div>
  </aside>

  <!-- Templates -->
  <template id="dishTpl">
    <div class="dish" data-cat="">
      <img class="dish-img" alt="" />
      <div class="dish-body">
        <h6 class="title"></h6>
        <div class="text-secondary small mb-1 desc"></div>
        <div class="d-flex align-items-center justify-content-between">
          <div class="price"></div>
          <div class="tags"></div>
        </div>
        <div class="add-wrap">
          <div class="qty" hidden>
            <button class="minus" type="button">âˆ’</button>
            <div class="count px-1">1</div>
            <button class="plus" type="button">+</button>
          </div>
          <button class="add-btn">Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø©</button>
        </div>
      </div>
    </div>
  </template>

  <template id="cartLineTpl">
    <div class="line">
      <div class="d-flex align-items-center gap-2">
        <button class="btn btn-sm btn-outline-dark rounded-pill minus">âˆ’</button>
        <strong class="qty">1</strong>
        <button class="btn btn-sm btn-dark rounded-pill plus">+</button>
      </div>
      <div class="flex-grow-1 text-truncate text-end">
        <div class="fw-bold name"></div>
        <div class="small text-secondary">Ã— <span class="unit">0.00</span> Ø±.Ø³</div>
      </div>
      <div class="text-nowrap fw-bold total">0.00 Ø±.Ø³</div>
    </div>
  </template>

  <!-- JS libs -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/intl-tel-input@24.4.0/build/js/intlTelInputWithUtils.js"></script>

  <script>
    /* ---------- Mock data ---------- */
    const DISHES = [
      {id:'s1', title:'Ø³Ø§Ù„Ù…ÙˆÙ† Ù…ÙŠØ²Ùˆ', desc:'Ø³Ø§Ù„Ù…ÙˆÙ† Ù…Ø­Ù…Ù‘Ø± Ø¨ØµÙ„ØµØ© Ù…ÙŠØ²Ùˆ ÙˆØ³ÙˆØ³Ùˆ Ø­Ù„Ùˆ', price:62, cat:'sushi', img:'https://images.unsplash.com/photo-1604908176997-431c3960b8f4?q=80&w=600&auto=format&fit=crop', tags:['Ø¨Ø­Ø±ÙŠ']},
      {id:'s2', title:'A5 ÙˆØ§Ø¬ÙŠÙˆ Ø¯ÙˆÙ†', desc:'ÙˆØ§Ø¬Ø¨Ùˆ Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ø±ÙŠÙ„ Ù…Ø¹ ØµÙˆØµ ÙŠÙˆØ²Ùˆ', price:120, cat:'don', img:'https://images.unsplash.com/photo-1542806104-95cdefc6ea3f?q=80&w=600&auto=format&fit=crop', tags:['Ø§Ù„Ø£Ø·Ø¨Ø§Ù‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©','Ù„Ø­Ù…']},
      {id:'m1', title:'ÙŠØ§ÙƒÙŠØªÙˆØ±ÙŠ Ù„Ø­Ù…', desc:'Ù…Ø±Ù‚ Ø­Ø± ØºÙ†ÙŠ + Ù„Ø­Ù… Ù…Ø´ÙˆÙŠ', price:64, cat:'meat', img:'https://images.unsplash.com/photo-1617195737491-0e3c5b9234b9?q=80&w=600&auto=format&fit=crop', tags:['Ø­Ø§Ø±']},
      {id:'s3', title:'Ø³ÙˆØ´ÙŠ ØªÙˆÙ†Ø§', desc:'6 Ù‚Ø·Ø¹ ØªÙˆÙ†Ø§ Ø·Ø§Ø²Ø¬Ø©', price:58, cat:'sushi', img:'https://images.unsplash.com/photo-1542736667-069246bdbc74?q=80&w=600&auto=format&fit=crop', tags:['Ù†ÙŠØ¡']},
      {id:'d1', title:'Ø¨ÙŠØ¨Ø³ÙŠ', desc:'Ù…Ø´Ø±ÙˆØ¨ ØºØ§Ø²ÙŠ', price:8, cat:'drinks', img:'https://images.unsplash.com/photo-1541976076758-347942db1970?q=80&w=600&auto=format&fit=crop', tags:['Ù…Ø¨Ø±Ø¯']},
      {id:'m2', title:'Ø³ØªÙŠÙƒØ³ ØªØ±ÙŠØ§ÙƒÙŠ', desc:'Ù‚Ø·Ø¹ Ù„Ø­Ù… Ø¨ØªØªØ¨ÙŠÙ„Ø© Ø§Ù„ØªØ±ÙŠØ§ÙƒÙŠ', price:98, cat:'meat', img:'https://images.unsplash.com/photo-1561758033-d89a9ad46330?q=80&w=600&auto=format&fit=crop', tags:['Ù…Ø´ÙˆÙŠ']},
    ];

    /* ---------- State ---------- */
    const state = {
      q: '',
      cat: 'all',
      cart: {}, // id -> {id, qty}
    };

    const fmt = new Intl.NumberFormat('ar-SA', { style:'currency', currency:'SAR' });

    /* ---------- Render menu ---------- */
    const grid = document.getElementById('grid');
    const tpl = document.getElementById('dishTpl');
    function renderGrid(){
      grid.innerHTML='';
      const q = state.q.trim().toLowerCase();
      const list = DISHES.filter(d => (state.cat==='all'||d.cat===state.cat) && (q===''||d.title.toLowerCase().includes(q)||d.desc.toLowerCase().includes(q)));
      list.forEach(d=>{
        const node = tpl.content.firstElementChild.cloneNode(true);
        node.dataset.cat = d.cat;
        node.querySelector('.dish-img').src = d.img;
        node.querySelector('.dish-img').alt = d.title;
        node.querySelector('.title').textContent = d.title;
        node.querySelector('.desc').textContent = d.desc;
        node.querySelector('.price').textContent = fmt.format(d.price);
        const tags = node.querySelector('.tags');
        d.tags.forEach(t=>{ const span=document.createElement('span'); span.className='tag'; span.textContent=t; tags.appendChild(span); });

        const addBtn = node.querySelector('.add-btn');
        const qtyWrap = node.querySelector('.qty');
        const minus = qtyWrap.querySelector('.minus');
        const plus  = qtyWrap.querySelector('.plus');
        const count = qtyWrap.querySelector('.count');

        function reflect(){
          const line = state.cart[d.id];
          if(line && line.qty>0){ addBtn.hidden=true; qtyWrap.hidden=false; count.textContent=line.qty; }
          else{ addBtn.hidden=false; qtyWrap.hidden=true; }
        }
        addBtn.addEventListener('click', ()=>{ state.cart[d.id]={id:d.id, qty:1}; bump(); reflect(); });
        minus.addEventListener('click', ()=>{ if(state.cart[d.id]){ state.cart[d.id].qty--; if(state.cart[d.id].qty<=0) delete state.cart[d.id]; bump(); reflect(); }});
        plus.addEventListener('click',  ()=>{ state.cart[d.id]=(state.cart[d.id]||{id:d.id,qty:0}); state.cart[d.id].qty++; bump(); reflect(); });

        reflect();
        grid.appendChild(node);
      });
      if(list.length===0){
        const empty = document.createElement('div');
        empty.className='text-center text-secondary py-5';
        empty.textContent='Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø·Ø¨Ø§Ù‚ Ù…Ø·Ø§Ø¨Ù‚Ø©';
        grid.appendChild(empty);
      }
    }

    /* ---------- Search & chips ---------- */
    document.getElementById('q').addEventListener('input', e=>{ state.q=e.target.value; renderGrid(); });

    document.getElementById('chips').addEventListener('click', e=>{
      const b = e.target.closest('.chip'); if(!b) return;
      document.querySelectorAll('.chip').forEach(x=>x.classList.remove('active'));
      b.classList.add('active');
      state.cat = b.dataset.cat; renderGrid();
    });

    /* ---------- Cart ---------- */
    function cartToArray(){
      return Object.values(state.cart).map(l=>{
        const d = DISHES.find(x=>x.id===l.id); return {...l, ...d};
      });
    }
    function totals(){
      const arr = cartToArray();
      const count = arr.reduce((a,b)=>a+b.qty,0);
      const total = arr.reduce((a,b)=>a+b.qty*b.price,0);
      return {count,total,arr};
    }
    function bump(){
      const t = totals();
      document.getElementById('badge').textContent = t.count;
      document.getElementById('miniCount').textContent = `${t.count} Ø¹Ù†ØµØ±`;
      document.getElementById('miniTotal').textContent = fmt.format(t.total);
      document.getElementById('cartTotal').textContent = fmt.format(t.total);
      renderCartList();
      persistCart();
    }

    /* Drawer */
    const drawer = document.getElementById('drawer');
    function openDrawer(){ drawer.classList.add('open'); }
    function closeDrawer(){ drawer.classList.remove('open'); }
    document.getElementById('openCart').addEventListener('click', openDrawer);
    document.getElementById('miniCartBtn').addEventListener('click', openDrawer);
    document.getElementById('closeCart').addEventListener('click', closeDrawer);

    const cartList = document.getElementById('cartList');
    const lineTpl = document.getElementById('cartLineTpl');
    function renderCartList(){
      cartList.innerHTML='';
      const {arr} = totals();
      if(arr.length===0){
        const p=document.createElement('p'); p.className='text-secondary text-center my-4'; p.textContent='Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©';
        cartList.appendChild(p); return;
      }
      arr.forEach(it=>{
        const row=lineTpl.content.firstElementChild.cloneNode(true);
        row.querySelector('.name').textContent = it.title;
        row.querySelector('.unit').textContent = it.price.toFixed(2);
        row.querySelector('.qty').textContent  = it.qty;
        row.querySelector('.total').textContent= fmt.format(it.qty*it.price);
        row.querySelector('.minus').addEventListener('click', ()=>{ state.cart[it.id].qty--; if(state.cart[it.id].qty<=0) delete state.cart[it.id]; bump(); });
        row.querySelector('.plus').addEventListener('click',  ()=>{ state.cart[it.id].qty++; bump(); });
        cartList.appendChild(row);
      });
    }

    /* ---------- Persistence ---------- */
    function persistCart(){
      try{ localStorage.setItem('hk_cart', JSON.stringify(state.cart)); }catch(_){}
    }
    function loadCart(){
      try{
        const raw=localStorage.getItem('hk_cart'); if(!raw) return;
        const obj=JSON.parse(raw)||{}; state.cart=obj;
      }catch(_){}
    }

    /* ---------- DATA page polish ---------- */
    const nameEl   = document.getElementById('custName');
    const phoneEl  = document.getElementById('custPhone');
    const addrWrap = document.getElementById('addressWrap');
    const addrEl   = document.getElementById('address');
    const notesEl  = document.getElementById('notes');
    const segPick  = document.getElementById('segPickup');
    const segDel   = document.getElementById('segDelivery');
    const typeHint = document.getElementById('typeHint');

    // intl-tel-input
    const iti = window.intlTelInput(phoneEl,{
      initialCountry:'sa',
      onlyCountries:['sa','ae','bh','kw','om','qa'],
      utilsScript:'https://cdn.jsdelivr.net/npm/intl-tel-input@24.4.0/build/js/utils.js',
      separateDialCode:true
    });

    function setType(delivery){
      segPick.setAttribute('aria-pressed', String(!delivery));
      segDel.setAttribute('aria-pressed', String(delivery));
      addrWrap.style.display = delivery ? '' : 'none';
      typeHint.textContent = delivery ? 'Ø§Ù„ØªÙˆØµÙŠÙ„ Ø¹Ø§Ø¯Ø© 30â€“45 Ø¯Ù‚ÙŠÙ‚Ø© Ø­Ø³Ø¨ Ø§Ù„Ù…ÙˆÙ‚Ø¹.' : 'Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† Ø§Ù„Ù…Ø·Ø¹Ù… Ø£Ø³Ø±Ø¹ (10â€“15 Ø¯Ù‚ÙŠÙ‚Ø©).';
      if(delivery) setTimeout(()=>addrEl.focus(), 80);
    }
    segPick.addEventListener('click', ()=>setType(false));
    segDel.addEventListener('click', ()=>setType(true));
    setType(false);

    // notes counter
    notesEl.addEventListener('input', ()=>{ document.getElementById('notesCount').textContent = notesEl.value.length; });

    // simple validation
    function validate(){
      const nameOk = (nameEl.value||'').trim().length>1;
      const phoneOk = iti.isValidNumber();
      const delivery = segDel.getAttribute('aria-pressed')==='true';
      const addressOk = !delivery || (addrEl.value||'').trim().length>3;

      document.getElementById('err-name').classList.toggle('d-none', nameOk);
      document.getElementById('ok-phone').classList.toggle('d-none', !phoneOk);
      document.getElementById('err-phone').classList.toggle('d-none', phoneOk);
      document.getElementById('err-address').classList.toggle('d-none', addressOk);

      return nameOk && phoneOk && addressOk;
    }
    ['input','blur'].forEach(ev=>{
      nameEl.addEventListener(ev, validate);
      phoneEl.addEventListener(ev, ()=>setTimeout(validate, ev==='blur'?0:120));
      addrEl.addEventListener(ev, validate);
    });

    document.getElementById('confirmBtn').addEventListener('click', ()=>{
      if(!validate()){ window.scrollTo({top:0,behavior:'smooth'}); return; }
      const payload = {
        type: segDel.getAttribute('aria-pressed')==='true' ? 'delivery' : 'pickup',
        name: nameEl.value.trim(),
        phone: iti.getNumber(),
        address: addrEl.value.trim(),
        notes: notesEl.value.trim(),
        items: cartToArray().map(x=>({id:x.id, title:x.title, qty:x.qty, price:x.price})),
        totals: totals()
      };
      console.log('Submitting order:', payload);
      alert('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ ğŸ‰\nØ³ÙŠØªÙ… Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ù„ØªØ£ÙƒÙŠØ¯Ù‡.');
    });

    // Enter key flow
    nameEl.addEventListener('keydown', e=>{ if(e.key==='Enter'){ e.preventDefault(); phoneEl.focus(); }});
    phoneEl.addEventListener('keydown', e=>{ if(e.key==='Enter'){ e.preventDefault(); (segDel.getAttribute('aria-pressed')==='true'?addrEl:notesEl).focus(); }});

    // Keep mini bar "Ø§Ù„ØªØ§Ù„ÙŠ" disabled when cart empty
    const nextBtn = document.getElementById('nextBtn');
    function reflectNext(){
      const has = totals().count>0;
      nextBtn.classList.toggle('disabled', !has);
      nextBtn.setAttribute('aria-disabled', String(!has));
    }

    /* ---------- Init ---------- */
    loadCart();
    renderGrid();
    bump();
    reflectNext();

    // Also reflect next on any cart change
    const _bump = bump;
    bump = function(){ _bump(); reflectNext(); }
  </script>
</body>
</html>
