<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1, viewport-fit=cover"
  />

  <!-- Primary Meta Tags -->
  <title>ุญุฌูุฒุงุช ุงูููุงุนูุฏ</title>
  <meta name="title" content="ุญุฌูุฒุงุช ุงูููุงุนูุฏ" />
  <meta
    name="description"
    content="1. ุจูุบุณู ุณูุงุฑุชู ุจุฎูุทุฉ ุฎุงุตุฉ ูุฏุนููุฉ ุจุงููุงูุณ ุชุญูููุง ูู ุงูุบุจุงุฑ ูุงูุฎุฏูุด. 2. ููุทูุง ุฏุงูููุง ูุธููุฉ. 3. ููุณุชุฎุฏู ุฅุณููุฌุฉ ูุฎุตูุตุฉ ููููุฑุงุช ุนุดุงู ููุชู ุจูู ุชูุงุตูู ุณูุงุฑุชู. #ุบุณูู_ุจุฏูู_ุทูุงุจูุฑ"
  />
  <meta name="keywords" content="ุงููุฏููุฉ,ุงููููุฑุฉ,ุงูุดุฑููุฉ,ุงููุทูู,ุงูุฎุจุฑ,ุงูุฏูุงู,ุณููุงุช,car,ุณูุงุฑุฉ,mobile,ููุจูู,ููุจุงูู,ููุฒุณ,lexus,ูุงุด,wash,car wash,ุบุณูู,ุบุณูู_ุจุฏูู_ุทูุงุจูุฑ,ุทุงุจูุฑ,ุจุฏูู,ุทูุงุจูุฑ,ููุณู,ุฏุงุฎูู,ุฎุงุฑุฌู,ูุธูู,ุชูููุน,ุชุธููู,clean,internal,ุญุฌุฒ,ููุนุฏ,reserve,appointment,ticket,work,ุนูู,riyad,dahran,dhahran,ุชูุธูู,ูุธุงูุฉ,ุจุฎุงุฑ,ูุงุก,ูุงู,ูุงู,ูููู,ุตุงุจูู,ูุญู,nahl,nahl.app,ุฃุฒุฑู,Blue,Last clean,ุงุณูุฌูุฉ ูุตุงุจูู,sponge, soap, spongnsoap,spongensoap,ุงุฎุฑ ูุธุงูุฉ,ูุงููููู" />
  <meta name="robots" content="index, follow" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="language" content="Arabic" />

  <!-- Open Graph -->
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://www.spongnsoap.com" />
  <meta property="og:title" content="ุญุฌูุฒุงุช ุงูููุงุนูุฏ" />
  <meta
    property="og:description"
    content="1. ุจูุบุณู ุณูุงุฑุชู ุจุฎูุทุฉ ุฎุงุตุฉ ูุฏุนููุฉ ุจุงููุงูุณ ุชุญูููุง ูู ุงูุบุจุงุฑ ูุงูุฎุฏูุด. 2. ููุทูุง ุฏุงูููุง ูุธููุฉ. 3. ููุณุชุฎุฏู ุฅุณููุฌุฉ ูุฎุตูุตุฉ ููููุฑุงุช ุนุดุงู ููุชู ุจูู ุชูุงุตูู ุณูุงุฑุชู. #ุบุณูู_ุจุฏูู_ุทูุงุจูุฑ"
  />
  <meta
    property="og:image"
    content="https://pdnmghkpepvsfaiqlafk.supabase.co/storage/v1/object/public/nahl%20assets/Sponge%20&%20Soap/Logo%20-%20Sponge%20and%20Soap%20-%201.png"
  />

  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image" />
  <meta property="twitter:url" content="https://www.spongnsoap.com" />
  <meta property="twitter:title" content="ุญุฌูุฒุงุช ุงูููุงุนูุฏ" />
  <meta
    property="twitter:description"
    content="1. ุจูุบุณู ุณูุงุฑุชู ุจุฎูุทุฉ ุฎุงุตุฉ ูุฏุนููุฉ ุจุงููุงูุณ ุชุญูููุง ูู ุงูุบุจุงุฑ ูุงูุฎุฏูุด. 2. ููุทูุง ุฏุงูููุง ูุธููุฉ. 3. ููุณุชุฎุฏู ุฅุณููุฌุฉ ูุฎุตูุตุฉ ููููุฑุงุช ุนุดุงู ููุชู ุจูู ุชูุงุตูู ุณูุงุฑุชู. #ุบุณูู_ุจุฏูู_ุทูุงุจูุฑ"
  />
  <meta
    property="twitter:image"
    content="https://pdnmghkpepvsfaiqlafk.supabase.co/storage/v1/object/public/nahl%20assets/Sponge%20&%20Soap/Logo%20-%20Sponge%20and%20Soap%20-%201.png"
  />

  <link
    rel="shortcut icon"
    href="https://pdnmghkpepvsfaiqlafk.supabase.co/storage/v1/object/public/nahl%20assets/Sponge%20&%20Soap/Logo%20-%20Sponge%20and%20Soap%20-%201.png"
    type="image/x-icon"
  />

  <!-- Fonts & CSS libs -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/intl-tel-input@24.4.0/build/css/intlTelInput.css">

  <style>
    :root{
      --brand-primary:#0394b6;
      --brand-secondary:#48b5d0;
      --brand-dark:#493a68;
      --text:#ffffff;
      --bg:#f5f5f5;
      --radius:12px;
    }
    *{ box-sizing:border-box }
    html,body{
      height:100%;
      margin:0;
      font-family:'Cairo',system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial,'Noto Sans',sans-serif;
      overflow:hidden;
      background:#0e2a36;
    }
    a{ text-decoration:none }

    /* Layout */
    #banner,#form{ height:100% }
    #banner{
      flex:1 1 50%;
      position:relative;
      display:flex;align-items:center;justify-content:center;
    }
    #form{
      flex:1 1 50%;
      display:flex;flex-direction:column;align-items:center;justify-content:center;
      background: #48b5d0e0;
      color:var(--text);
      box-shadow: 0 0 5px 10px rgba(5,28,59,.98), 10px 0 70px 0 rgba(5,28,59,.42);
    }
    .bg-image{
      position:absolute;inset:0;z-index:-2;
      background:url("https://www.dropbox.com/s/s9bxuykl0w49dqa/background2.jpg?raw=1") center/cover no-repeat;
      filter:blur(8px);
    }

    /* Header */
    .header{ width:100%; text-align:center; padding-top: 4vh; }
    .header img{ width:220px; }

    /* Wizard pages */
    #form-content{ width:100%; height:100%; display:flex; flex-direction:column; }
    #form-content section{
      flex:1; display:none; flex-direction:column; align-items:center; justify-content:center; gap:16px; padding:24px;
    }
    #page1{ display:flex }
    .filter-button-wrap{ background:linear-gradient(to right,#d3d3d3,var(--brand-primary)); padding:3px; border-radius:15px; }
    .filter-button{
      border:0; border-radius:12px; padding:1rem 1.2rem; font-weight:700; background:#fff; color:var(--brand-primary); cursor:pointer;
    }
    .filter-button:hover{ background:var(--brand-primary); color:#f5f5f5 }

    /* Time grid */
    .time-date-box{ width:min(900px,92%); margin-top:10px }
    .time-date-header{ display:flex; border-radius:12px; overflow:hidden; box-shadow:0 2px 8px rgba(0,0,0,.1) }
    .time-date-header>div{ flex:1; background:#fff; padding:12px 6px; cursor:pointer; text-align:center }
    .time-date-header>div:hover,.time-date-header .choosed{ background:var(--brand-primary); color:#fff }
    .time-container{
      display:grid; grid-template-columns:repeat(3,1fr); gap:12px;
      background:#fff; border-radius:10px; height:23rem; overflow:auto; padding:12px;
    }
    .time-button{
      background:#fff; border:0; border-radius:12px; padding:1rem 1.2rem; font-weight:700; cursor:pointer; box-shadow:0 6px 20px rgba(18,18,18,.1);
    }
    .time-button:hover{ background:var(--brand-primary); color:#fff }

    /* Inputs group (chips) */
    .form-container{ width:min(480px,92%); display:flex; flex-direction:column; gap:8px }
    .chip{ background:transparent; color:#fff; display:flex; flex-direction:column; align-items:center; gap:6px }
    .chip input,.chip select{
      width:100%; max-width:320px; background:#fff; color:#37338d; border:none; border-radius:6px; padding:8px; text-align:center; box-shadow:0 1px 3px rgba(0,0,0,.1)
    }
    #locationDescription{ background:#e9ecef; color:#555; font-weight:700 }

    /* Social FABs */
    :root{ --fab-size:56px; --fab-bg:rgba(34,34,34,.55) }
    .social-fab{
      position:fixed; left:15px; z-index:999; width:var(--fab-size); height:var(--fab-size);
      border-radius:50%; display:flex; align-items:center; justify-content:center; color:#fff; background:var(--fab-bg);
      backdrop-filter:blur(6px); -webkit-backdrop-filter:blur(6px);
      box-shadow:0 8px 20px rgba(0,0,0,.35), inset 0 0 0 2px rgba(255,255,255,.1);
      transition:transform .18s ease, box-shadow .18s ease;
    }
    .social-fab i{ font-size:1.4rem; filter:drop-shadow(0 2px 4px rgba(0,0,0,.4)) }
    .whatsapp-button{ bottom:15px; --brand:#25D366 }
    .instagram-button{ bottom:74px; --brand:#E1306C }
    .tiktok-button{ bottom:133px; --brand:#69C9D0 }
    .social-fab:hover{ transform:translateY(-2px); box-shadow:0 12px 26px rgba(0,0,0,.45), inset 0 0 0 2px var(--brand), 0 0 14px var(--brand) }

    /* Map */
    #googleMap{ width:100%; height:400px; margin: 12px 0; border-radius:12px; overflow:hidden }
    #drag-instructions{
      position:absolute; top:20px; left:50%; transform:translateX(-50%);
      background:rgba(255,255,255,.9); color:#333; padding:8px 12px; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,.2); font-size:14px; z-index:10;
    }

    /* Animations */
    @keyframes fadeIn{ from{opacity:0} to{opacity:1} }
    @keyframes fadeOut{ from{opacity:1} to{opacity:0} }
    .fadeIn{ animation:fadeIn .6s ease forwards }
    .fadeOut{ animation:fadeOut .6s ease forwards }

    /* Responsive */
    @media (max-width:1000px){
      #banner{ display:none }
      #form{ flex:1 1 100% }
      .time-container{ grid-template-columns:repeat(3,1fr) }
    }
    @media (max-width:600px){
      .time-container{ grid-template-columns:repeat(2,1fr) }
    }
  </style>
</head>
<body>
  <div class="bg-image"></div>

  <!-- Left visual / hidden on mobile -->
  <aside id="banner" aria-hidden="true">
    <div class="banner-content">
      <div class="banner-content-holder">
        <img style="margin-inline:20px; width:111%; max-width:540px"
             src="https://pdnmghkpepvsfaiqlafk.supabase.co/storage/v1/object/public/nahl%20assets/Sponge%20&%20Soap/Logo%20-%20Sponge%20and%20Soap%20-%201.png"
             alt="Sponge & Soap" />
      </div>
    </div>
  </aside>

  <!-- Right form / wizard -->
  <main id="form">
    <div id="form-content">
      <!-- Header -->
      <header class="header">
        <img
          src="https://pdnmghkpepvsfaiqlafk.supabase.co/storage/v1/object/public/nahl%20assets/Sponge%20&%20Soap/spong&Soap%20-%20logo.png"
          alt="Sponge & Soap Logo" />
      </header>

      <!-- Page 1 -->
      <section id="page1" class="fadeIn">
        <div>
          <h3 style="text-align:center; line-height:2; margin-bottom:10px">
            โจ ูุงูุณ ูุญูู ุณูุงุฑุชู<br />
            ๐งผ ููุท ูุธููุฉ & ููุนุงู ูุถููู<br />
            ๐ ุฅุณููุฌุฉ ููููุฑุงุช<br /><br />... ููุชู ุจูู ุงูุชูุงุตูู
          </h3>
          <p style="text-align:center">
            <span style="font-weight:bold; font-size:18px">#ุบุณูู_ุจุฏูู_ุทูุงุจูุฑ</span>
          </p>
        </div>
        <div class="filter-button-wrap">
          <button id="page1-button" class="filter-button">ุงุญุฌุฒ ููุนุฏู</button>
        </div>
      </section>

      <!-- Page 2: Location & Service -->
      <section id="page2" class="fadeIn">
        <h1>
          ููู ุชุญุจ ูุฌูู ุ<br />
          ุงุฎุชูุงุฑ ุงูููุทูุฉ
        </h1>

        <form id="page2-form" class="form-container">
          <div id="select2-container" style="position:relative; width:100%">
            <select id="area" class="js-example-basic-single" style="width:100%" required></select>
            <div id="page2-spinner" class="spinner-border" style="position:absolute; top:50%; inset-inline-start:50%; transform:translate(-50%,-50%); display:none" role="status"></div>
          </div>

          <label for="service" class="mt-2">ุงูุฎุฏูุฉ</label>
          <div style="position:relative; width:100%">
            <select id="service" style="width:100%" required></select>
            <div id="page3-2-spinner" class="spinner-border" style="position:absolute; top:50%; inset-inline-start:50%; transform:translate(-50%,-50%); display:none" role="status"></div>
          </div>
        </form>

        <div class="filter-button-wrap">
          <button id="page2-button" class="filter-button">ุงูุชุงูู</button>
        </div>
      </section>

      <!-- Page 3: Extra service details -->
      <section id="page3" class="fadeIn">
        <div id="page3-wait" style="display:none; position:absolute; inset:0; background:rgba(0,0,0,.6); display:flex; align-items:center; justify-content:center; flex-direction:column; z-index:10">
          <div class="spinner-border text-light" role="status"></div>
          <p style="color:#fff; margin-top:1em; font-size:1.2em">ุฌุงุฑู ุฌูุจ ุงูููุงุนูุฏโฆ</p>
        </div>

        <form id="page3-form" class="form-container">
          <label for="serviceCat" style="display:none">ุตูู ุงูุฎุฏูุฉ</label>
          <div style="position:relative; width:100%; display:none">
            <select id="serviceCat" style="width:100%"></select>
            <div id="page3-1-spinner" class="spinner-border" style="position:absolute; top:50%; inset-inline-start:50%; transform:translate(-50%,-50%); display:none" role="status"></div>
          </div>

          <label for="serviceCount" style="display:none">ุนุฏุฏ ุงูุณูุงุฑุงุช</label>
          <select id="serviceCount" style="display:none">
            <option value="1" selected>1</option>
            <option value="2">2</option><option value="3">3</option>
            <option value="4">4</option><option value="5">5</option>
            <option value="6">6</option><option value="7">7</option>
            <option value="8">8</option><option value="9">9</option>
            <option value="10">10</option>
          </select>
        </form>

        <div id="page3-buttons" class="mt-2">
          <div id="fail-alert-4" class="alert alert-danger" role="alert" style="display:none; margin-top:10px; margin-bottom:0">
            <span></span><br /><span></span>
          </div>
          <button id="page3-button" class="filter-button" hidden>ุงูุชุงูู</button>
          <button id="page3-return" class="filter-button" hidden>ุงูุณุงุจู</button>
        </div>
      </section>

      <!-- Page 4: Date & time -->
      <section id="page4" class="fadeIn">
        <h1>
          ูุชู ุชุญุจ ูุฌูู ุ<br />
          ุงุฎุชูุงุฑ ุงูููุนุฏ
        </h1>

        <input type="date" id="date" name="date" class="date form-control" style="text-align:center; width:50%" />

        <div class="time-date-box">
          <div id="time-date-header" class="time-date-header" hidden>
            <div id="dayHeader1" class="choosed" style="border-radius:0 10px 0 0">
              <span id="day1">ุงูุฃุญุฏ</span><br />
              <span id="day1date">โ</span>
            </div>
            <div id="dayHeader2">
              <span id="day2">ุงูุฅุซููู</span><br />
              <span id="day2date">โ</span>
            </div>
            <div id="dayHeader3" style="border-radius:10px 0 0 0">
              <span id="day3">ุงูุซูุงุซุงุก</span><br />
              <span id="day3date">โ</span>
            </div>
          </div>

          <div id="time-container" class="time-container"></div>

          <div id="fail-alert-3" class="alert alert-danger" role="alert" style="display:none; margin-top:16px; margin-bottom:0">
            <span></span><br /><span></span>
          </div>
        </div>

        <div class="filter-button-wrap">
          <button id="page4-return" class="filter-button">ุงูุณุงุจู</button>
        </div>
      </section>

      <!-- Page 5: Contact & payment -->
      <section id="page5" class="fadeIn">
        <form id="page5-form" class="form-container">
          <h2>ูุนูููุงุช ุงูุงุชุตุงู</h2>

          <label for="name">ุงูุฅุณู</label>
          <input id="name" type="text" required />

          <label for="mobile">ุฑูู ุงูุฌูุงู</label>
          <div class="phoneCountry" style="color:#000">
            <input type="tel" id="mobile" style="width:100%" />
          </div>

          <h2>ูุนูููุงุช ุงููุฑูุจุฉ</h2>
          <div class="chip" style="margin-bottom:8px">
            <label for="carBrand">ูุงุฑูุฉ ุงูุณูุงุฑุฉ</label>
            <select id="carBrand" style="width:100%">
              <option value="" disabled selected>๐ ูุงุฑูุฉ ุงูุณูุงุฑุฉ</option>
              <option value="Other">Other</option>
            </select>
          </div>

          <div style="display:flex; gap:10px; flex-wrap:wrap; width:100%">
            <div class="chip" style="flex:1">
              <label for="carName">ุงุณู ุงูุณูุงุฑุฉ</label>
              <input id="carName" type="text" placeholder="GT-R, ูุงูุฑูุ ุฅููุชุฑุง" />
            </div>
            <div class="chip" style="flex:1">
              <label for="plateNumber">ุฑูู ุงูููุญุฉ</label>
              <input id="plateNumber" type="text" maxlength="4" inputmode="numeric" placeholder="1234" required />
            </div>
          </div>

          <div hidden>
            <input id="locationDescription" type="text" readonly placeholder="ูุงุฑูุฉ ุงูุณูุงุฑุฉ, ุงุณู ุงูุณูุงุฑุฉ, ุฑูู ุงูููุญุฉ" />
          </div>

          <h2>ุทุฑููุฉ ุงูุฏูุน</h2>
          <div style="display:flex; gap:10px; align-items:stretch; justify-content:space-between">
            <label class="radio-label" style="flex:1; position:relative">
              <input type="radio" name="payingMethod" class="radios" value="Cash" required style="position:absolute; inset:0; opacity:0" />
              <img class="filter-button" style="width:100%" src="https://pdnmghkpepvsfaiqlafk.supabase.co/storage/v1/object/public/nahl%20assets/CASH%20LOGO.png" alt="Cash" />
            </label>

            <label class="radio-label" style="flex:1; position:relative">
              <input type="radio" name="payingMethod" class="radios" value="Telr-Online" required style="position:absolute; inset:0; opacity:0" />
              <img class="filter-button" style="width:100%" src="https://pdnmghkpepvsfaiqlafk.supabase.co/storage/v1/object/public/nahl%20assets/STC%20PAY%20LOGO.png" alt="STC Pay" />
            </label>

            <label class="radio-label" style="flex:1; position:relative">
              <input type="radio" name="payingMethod" class="radios" value="Mada" required style="position:absolute; inset:0; opacity:0" />
              <img class="filter-button" style="width:100%" src="https://pdnmghkpepvsfaiqlafk.supabase.co/storage/v1/object/public/nahl%20assets/MADA%20LOGO.png" alt="Mada" />
            </label>
          </div>
        </form>

        <div id="page5-buttons">
          <div id="fail-alert-4" class="alert alert-danger" role="alert" style="display:none; margin-top:16px; margin-bottom:0">
            <span></span><br /><span></span>
          </div>
          <div class="filter-button-wrap" style="margin-top:10px">
            <button id="page5-button" class="filter-button">ุงูุชุงูู</button>
          </div>
          <div class="filter-button-wrap" style="margin-top:10px">
            <button id="page5-return" class="filter-button">ุงูุณุงุจู</button>
          </div>
        </div>
      </section>

      <!-- Page 6: Map -->
      <section id="page6" class="fadeIn" style="position:relative">
        <label for="googleMap" style="font-size:1.25rem; font-weight:700">ุงููููุน ุนูู ุฎุฑูุทุฉ ูููู</label>

        <div id="drag-instructions">
          <i class="fas fa-hand-point-right" id="drag-icon"></i>
          <p>๐ ุงุณุญุจ ุงูุฎุฑูุทุฉ ูุชุบููุฑ ุงููููุน</p>
        </div>

        <div id="googleMap"></div>

        <p style="text-align:center; font-size:14px; color:#fff; margin:6px 0 0">
          ๐ <strong>ูู ุจุณุญุจ ุงููุคุดุฑ ุฃู ุงุถุบุท ุนูู ุงุธูุงุฑ ูููุนู</strong>
        </p>

        <button id="show-my-location" class="filter-button" style="width:100%">ุงุธูุงุฑ ูููุนู</button>

        <form id="page6-form" class="form-container" style="width:100%"></form>

        <div id="page6-buttons" style="width:min(480px,92%)">
          <div id="fail-alert-5" class="alert alert-danger" role="alert" style="display:none; margin:16px 0 0">
            <span></span><br /><span></span>
          </div>

          <div class="filter-button-wrap" style="margin-top:10px">
            <button id="page6-button" class="filter-button" style="width:100%">ุงูุชุงูู</button>
          </div>
          <div class="filter-button-wrap" style="margin-top:10px">
            <button id="page6-return" class="filter-button" style="width:100%">ุงูุณุงุจู</button>
          </div>

          <div id="page6-spinner" style="display:none; align-items:center; margin-top:10px">
            <span class="mt-3"></span>
            <div class="spinner-border" role="status" style="display:none; margin-top:10px">
              <span class="sr-only">Loading...</span>
            </div>
          </div>
        </div>
      </section>

      <!-- Page 7: Done -->
      <section id="page7" class="fadeIn">
        <h1>ุดูุฑุงู ููู</h1>
        <h2>ุชู ุญุฌุฒ ุงูููุนุฏุ ูุฑุงุญ ูุฃูุฏู ููู ุนูู ุงููุงุชุณุงุจ</h2>
        <h3>ูุชุญูุณูู ูุฌููู!!</h3>
        <div class="filter-button-wrap">
          <button id="rebook" class="filter-button" style="font-size:1.1rem">๐ ุญุฌุฒ ุฌุฏูุฏ</button>
        </div>
      </section>

      <footer style="text-align:center; margin: 10px 0 20px">
        <p>Sponge &amp; Soap</p>
        <a target="_blank" href="https://www.instagram.com/nahl.app?igsh=Y3YyOW05MGI5bnNv&utm_source=qr">Made with Nahl Perfection</a>
      </footer>
    </div>
  </main>

  <!-- Floating social buttons -->
  <a target="_blank" href="https://wa.me/966503668222" class="social-fab whatsapp-button" aria-label="ุชูุงุตู ุนุจุฑ ูุงุชุณุงุจ">
    <i class="fab fa-whatsapp" aria-hidden="true"></i>
  </a>
  <a target="_blank" href="https://www.instagram.com/sponge.soap_sa?igsh=MWRtOHI5OHZpbWpvdA==" class="social-fab instagram-button" aria-label="ุชุงุจุนูุง ุนูู ุฅูุณุชุบุฑุงู">
    <i class="fab fa-instagram" aria-hidden="true"></i>
  </a>
  <a target="_blank" href="https://www.tiktok.com/@sponge.soap_sa?_t=ZS-8zaj1CA4aJg&_r=1" class="social-fab tiktok-button" aria-label="ุชุงุจุนูุง ุนูู ุชูู ุชูู">
    <i class="fab fa-tiktok" aria-hidden="true"></i>
  </a>

  <!-- Terms Modal -->
  <div class="modal fade" id="termsModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable modal-lg">
      <div class="modal-content" dir="rtl">
        <div class="modal-header">
          <h5 class="modal-title">ุงูุดุฑูุท ูุงูุฃุญูุงู โ ูุบุณูุฉ ุณูุงุฑุงุช ูุชูููุฉ</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ุฅุบูุงู"></button>
        </div>
        <div class="modal-body" style="text-align:right">
          <ol style="padding-right:1rem">
            <li><strong>ุงูุฎุฏูุงุช ุงูููุฏูุฉ</strong>
              <ul><li>ุชูุฏู ุงููุบุณูุฉ ุฎุฏูุงุช ุบุณูู ูุชูุธูู ุงูุณูุงุฑุงุช ููู ุงูุจุงูุงุช ุงููุนุฑูุถุฉ ุนูู ุงููููุน ุฃู ุญุณุจ ุงูุงุชูุงู ุงููุณุจู.</li></ul>
            </li>
            <li><strong>ุญุฌุฒ ุงูููุงุนูุฏ</strong>
              <ul>
                <li>ูุชู ุงูุญุฌุฒ ุนุจุฑ ุงููููุน ุฃู ูู ุฎูุงู ุงูุชูุงุตู ุงููุจุงุดุฑ.</li>
                <li>ูุญู ูููุบุณูุฉ ุชุนุฏูู ุฃู ุฅูุบุงุก ุงูููุนุฏ ูู ุญุงู ูุฌูุฏ ุธุฑู ุทุงุฑุฆ ูุน ุฅุดุนุงุฑ ุงูุนููู.</li>
              </ul>
            </li>
            <li><strong>ุงูุฏูุน</strong>
              <ul>
                <li>ูุชู ุงูุฏูุน ุนุจุฑ ุงููุณุงุฆู ุงููุชุงุญุฉ (ุชุญููู ุจูููุ ูุฏูุ ุจุทุงูุฉ ุฅุฆุชูุงููุฉุ STC Payุ Apple Payุ ููุฏูุง).</li>
                <li>ูุฌุจ ุณุฏุงุฏ ุงููุจูุบ ูุงููุงู ูุจู ุจุฏุก ุงูุฎุฏูุฉ. ููู ุญุงู ุนุฏู ุงูุณุฏุงุฏ ูุญู ูููุบุณูุฉ ุฅูุบุงุก ุงูููุนุฏ.</li>
              </ul>
            </li>
            <li><strong>ุฅูุบุงุก ุงูุฎุฏูุฉ ูุงุณุชุฑุฌุงุน ุงููุจูุบ</strong>
              <ul>
                <li>ูู ุญุงู ุฅูุบุงุก ุงูุญุฌุฒ ูุจู 3 ุณุงุนุงุช ูู ุงูููุนุฏุ ูุญู ููุนููู ุงุณุชุฑุฏุงุฏ ุงููุจูุบ ุฃู ุฅุนุงุฏุฉ ุฌุฏููุฉ ุงูููุนุฏ.</li>
                <li>ูุง ูุญู ููุนููู ุทูุจ ุงุณุชุฑุฏุงุฏ ุงููุจูุบ ุฃู ุฌุฏููุฉ ุงูููุนุฏ ูู ุญุงู ุชู ุงูุฅูุบุงุก ุฎูุงู ุฃูู ูู 3 ุณุงุนุงุช.</li>
              </ul>
            </li>
            <li><strong>ูุณุคูููุฉ ุงููุบุณูุฉ</strong>
              <ul>
                <li>ุชูุชุฒู ุงููุบุณูุฉ ุจุชูุฏูู ุงูุฎุฏูุฉ ุจุฃูุถู ุฌูุฏุฉ ููููุฉ ุจุงุณุชุฎุฏุงู ููุงุฏ ุขููุฉ.</li>
                <li>ุงููุบุณูุฉ ุบูุฑ ูุณุคููุฉ ุนู ุฃู ุฃุนุทุงู ูููุงููููุฉ ุฃู ููุฑุจุงุฆูุฉ ุฃู ุชูููุงุช ุณุงุจูุฉ ูู ุงูุณูุงุฑุฉ.</li>
                <li>ูู ุญุงู ูููุน ุถุฑุฑ ูุงุชุฌ ุนู ุฎุทุฃ ูุจุงุดุฑ ูู ูุฑูู ุงูุนููุ ุชุชุญูู ุงููุบุณูุฉ ูุณุคูููุฉ ุชุนููุถ ุนุงุฏู ููุชุตุฑ ุนูู ูููุฉ ุงูุถุฑุฑ ุงููุจุงุดุฑ.</li>
              </ul>
            </li>
            <li><strong>ูุณุคูููุฉ ุงูุนููู</strong>
              <ul>
                <li>ูุฌุจ ุนูู ุงูุนููู ุฅุฒุงูุฉ ุฃู ุฅุฎูุงุก ุงูุณูุงุฑุฉ ูู ุฃู ูุชุนููุงุช ุดุฎุตูุฉ ุฃู ุซูููุฉ ูุจู ุจุฏุก ุงูุฎุฏูุฉ.</li>
                <li>ุงููุบุณูุฉ ุบูุฑ ูุณุคููุฉ ุนู ููุฏุงู ุฃู ุชูู ุฃู ุฃุบุฑุงุถ ุดุฎุตูุฉ ุชูุชุฑู ุฏุงุฎู ุงูุณูุงุฑุฉ.</li>
                <li>ุชูููุฑ ููุงู ููุงุณุจ ูุขูู ูุฅุชูุงู ุงูุฎุฏูุฉ (ููููุ ุชุตุฑูุญ ุฏุฎููุ ุฅูุฎ).</li>
              </ul>
            </li>
            <li><strong>ุงูููุช ูุงูุชุฃุฎูุฑ</strong>
              <ul>
                <li>ูุฏุฉ ุงูุฎุฏูุฉ ุชูุฑูุจูุฉ ููุฏ ุชุฎุชูู ุญุณุจ ุญุงูุฉ ุงูุณูุงุฑุฉ.</li>
                <li>ุงูุชุฃุฎูุฑ ุนู ุงูููุนุฏ ูุญุฏ ุฃูุตู 15 ุฏูููุฉ ููุนุชุจุฑ ุงูููุนุฏ ูุงุบููุง ุจุนุฏูุง.</li>
              </ul>
            </li>
            <li><strong>ุงูุชุนุฏููุงุช</strong>
              <ul>
                <li>ุชุญุชูุธ ุงููุบุณูุฉ ุจุญู ุชุนุฏูู ูุฐู ุงูุดุฑูุท ูู ุฃู ููุช.</li>
              </ul>
            </li>
            <li><strong>ุงููุงููู</strong>
              <ul>
                <li>ุชุฎุถุน ูุฐู ุงูุดุฑูุท ูููุงููู ุงูููููุฉ ุงูุนุฑุจูุฉ ุงูุณุนูุฏูุฉ.</li>
              </ul>
            </li>
          </ol>
          <div class="form-check mt-2">
            <input class="form-check-input" type="checkbox" id="termsAccept" />
            <label class="form-check-label" for="termsAccept">ุฃูุงูู ุนูู ุงูุดุฑูุท ูุงูุฃุญูุงู</label>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal">ุฅูุบุงุก</button>
          <button class="btn btn-primary" id="confirmTerms" disabled>ุชุฃููุฏ ููุชุงุจุนุฉ</button>
        </div>
      </div>
    </div>
  </div>
<script>
/* =========================
   Globals & Config
========================= */
const { DateTime } = luxon;

// Your Apps Script backend base (update this to your deployed Web App URL)
const APPS_SCRIPT_BASE = "https://script.google.com/macros/s/REPLACE_WITH_YOUR_DEPLOYED_ID/exec";

// Nahl endpoints (unchanged from your flow โ update IDs if needed)
const defaultLink2 = `https://nahl-platform.vercel.app/api/app/AM/general/${'33e0d05d-d771-46f4-a7e7-7c634b4e3a9e'}/form`;

// In-memory form model
const nForm = {
  date: "",
  time: "",
  location: "",
  service: "",
  serviceCount: "1",
  serviceCat: "",
  customerM: "",
  customerN: "",
  paymentMethod: "",
  urlLocation: "",
  locationDescription: "",
};

let services, serviceCategories;
let appointments = [[], [], []];
let ActualTimes = [[], [], []];
let timesLoaded = false;

// Map globals (declare BEFORE myMap to avoid TDZ error)
let map, infoWindow, marker, polygon = null;
let position = ""; // google maps search link once user picks
let defaultLocation = { lat: 26.34165524787632, lng: 50.11524831545726 };
const prePosition = "https://www.google.com/maps/search/?api=1&query=";

/* =========================
   Helpers
========================= */
const qs = (sel, el = document) => el.querySelector(sel);
const qsa = (sel, el = document) => [...el.querySelectorAll(sel)];

function show(el){ el.style.display = "flex"; }
function hide(el){ el.style.display = "none"; }
function swapPages(from, to){
  from.classList.remove("fadeIn"); from.classList.add("fadeOut");
  to.classList.remove("fadeOut");   to.classList.add("fadeIn");
  setTimeout(()=>{ from.style.display = "none"; to.style.display = "flex"; }, 600);
}
function param(name){
  const url = new URL(location.href);
  return url.searchParams.get(name);
}

/* =========================
   Phone input (GCC-only)
========================= */
let iti; // intl-tel-input instance
function initPhone(){
  const tel = qs("#mobile");
  if(!tel) return;

  iti = window.intlTelInput(tel, {
    utilsScript: "https://cdn.jsdelivr.net/npm/intl-tel-input@24.4.0/build/js/utils.js",
    initialCountry: "sa",
    onlyCountries: ["sa","ae","kw","bh","om","qa"], // GCC only
    excludeCountries: ["il"],
    strictMode: true,
    countryOrder: ["sa","ae","kw","bh","om","qa"],
    i18n: {
      // keep short; you can paste your full Arabic i18n if you want
      "sa":"ุงูููููุฉ ุงูุนุฑุจูุฉ ุงูุณุนูุฏูุฉ","ae":"ุงูุฅูุงุฑุงุช","kw":"ุงููููุช","bh":"ุงูุจุญุฑูู","om":"ุนููุงู","qa":"ูุทุฑ"
    }
  });

  tel.addEventListener("change", () => {
    // Optional debug
    // console.log(iti.getNumber(), iti.isValidNumber());
  });
}
function checkNumberValidity(){
  const input = qs("#mobile");
  if(!iti || !iti.isValidNumber()){
    input.setCustomValidity("ุฑูู ุบูุฑ ุตุญูุญ");
    return false;
  }
  input.setCustomValidity("");
  return true;
}

/* =========================
   Persist/Load name & phone
========================= */
function loadLocal(){
  const nm = localStorage.getItem("name");
  const m  = localStorage.getItem("mobile");
  if(nm) qs("#name").value = nm;
  if(m && iti){
    iti.setNumber("+"+m);
  }
}

/* =========================
   Car plate / description
========================= */
function updateLocationDescription(){
  const brand = qs("#carBrand").value || "";
  const name  = qs("#carName").value || "";
  const plate = qs("#plateNumber").value || "";
  qs("#locationDescription").value = [brand,name,plate].filter(Boolean).join(", ");
}
function initCarFields(){
  const brands = [
    "Acura","Alfa Romeo","Aston Martin","Audi","Bentley","BMW","Bugatti","Buick",
    "Cadillac","Chevrolet","Chrysler","Citroรซn","Dacia","Daewoo","Daihatsu","Dodge",
    "Ferrari","Fiat","Ford","Genesis","GMC","Haval","Holden","Honda","Hummer",
    "Hyundai","Infiniti","Isuzu","Jaguar","Jeep","Kia","Koenigsegg","Lada",
    "Lamborghini","Lancia","Land Rover","Lexus","Lincoln","Lotus","Maserati",
    "Maybach","Mazda","McLaren","Mercedes-Benz","Mercury","MG","Mini","Mitsubishi",
    "Nissan","Opel","Pagani","Peugeot","Plymouth","Pontiac","Porsche","RAM",
    "Renault","Rolls-Royce","Saab","Saturn","Scion","Seat","Skoda","Smart",
    "SsangYong","Subaru","Suzuki","Tata","Tesla","Toyota","Volkswagen","Volvo","Wiesmann","Zotye"
  ];
  const sel = qs("#carBrand");
  brands.sort().forEach(b => sel.insertAdjacentHTML("beforeend", `<option value="${b}">${b}</option>`));

  $("#carBrand").select2({ placeholder:"ูุงุฑูุฉ ุงูุณูุงุฑุฉ", allowClear:true, width:"100%" });

  qsa("#carBrand,#carName,#plateNumber").forEach(el=>{
    el.addEventListener("input", updateLocationDescription);
    el.addEventListener("change", updateLocationDescription);
  });
  qs("#plateNumber").addEventListener("input", function(){
    this.value = this.value.replace(/\D/g,"").slice(0,4);
    this.setCustomValidity("");
  });
}

/* =========================
   Select2: locations/services
========================= */
let controllers = [];
function callContent2(path, cb, abortable=false, retries=2){
  let signal = undefined;
  if(abortable){
    controllers.forEach(([c])=>c.abort());
    controllers = [];
    const c = new AbortController();
    signal = c.signal;
    controllers.push([c, signal]);
  }

  fetch(defaultLink2 + path, { method:"GET", redirect:"follow", ...(signal?{signal}:{}) })
    .then(async res=>{
      if(!res.ok){
        if(retries>0) return callContent2(path, cb, abortable, retries-1);
        throw new Error("Network not ok");
      }
      const j = await res.json();
      cb(j);
    })
    .catch(err=>{
      if(!String(err.message).includes("aborted") && retries>0){
        setTimeout(()=>callContent2(path, cb, abortable, retries-1), 1200);
      }
    });
}

function loadLocations(){
  const spin = qs("#page2-spinner");
  show(spin);
  callContent2(`/locations`, (data)=>{
    const select = $("#area");
    const locations = data?.data || [];
    const opts = locations
      .map(l => ({ id:l.id, text:l.TS_location_arabic_name }))
      .sort((a,b)=> a.id - b.id);

    select.empty().select2({ data:opts, width:"100%" });
    $("#area").trigger("change");
    hide(spin);
  }, true);
}

function loadServicesByArea(){
  const ar = $("#area").val();
  if(!ar) return;
  const s1 = qs("#page3-1-spinner"), s2 = qs("#page3-2-spinner");
  show(s1); show(s2);
  $("#serviceCat").empty(); $("#service").empty();

  callContent2(`/services?location=${ar}`, (data)=>{
    services = data?.data?.services || [];
    serviceCategories = data?.data?.servicesCat || [];

    // build category->services map
    const catMap = {};
    services.forEach(s=>{
      const cid = s.TS_category_id;
      if(!catMap[cid]){
        catMap[cid] = { category: serviceCategories.find(c => c.TS_category_id===cid), services: [] };
      }
      catMap[cid].services.push(s);
    });

    // Fill serviceCat (hidden by default but kept for compatibility)
    const $cat = $("#serviceCat");
    $cat.empty();
    Object.keys(catMap).forEach(cid=>{
      const c = catMap[cid].category;
      $cat.append(new Option(c.TS_category_arabic_name, cid));
    });

    // Fill services for first category (or flatten all if one category)
    const $srv = $("#service");
    $srv.empty();
    const firstCid = Object.keys(catMap)[0];
    const arr = firstCid ? catMap[firstCid].services : services;

    arr.sort((a,b)=> a.TS_service_id - b.TS_service_id).forEach(s=>{
      $srv.append(new Option(s.TS_service_arabic_name, s.TS_service_id));
    });

    hide(s1); hide(s2);

    // refresh times when service changes
    $("#service").off("change").on("change", ()=> $("#date").trigger("change"));
    $("#date").trigger("change");
  }, true);
}

/* =========================
   Dates & times
========================= */
const weekdaysAR = ["ุงูุฃุญุฏ","ุงูุฅุซููู","ุงูุซูุงุซุงุก","ุงูุฃุฑุจุนุงุก","ุงูุฎููุณ","ุงูุฌูุนุฉ","ุงูุณุจุช"];
function resetDays(baseISO){
  const d1 = DateTime.fromISO(baseISO);
  const d2 = d1.plus({days:1});
  const d3 = d1.plus({days:2});

  qs("#day1").textContent = weekdaysAR[d1.weekday%7];
  qs("#day2").textContent = weekdaysAR[d2.weekday%7];
  qs("#day3").textContent = weekdaysAR[d3.weekday%7];

  qs("#day1date").textContent = d1.toFormat("yyyy-LL-dd");
  qs("#day2date").textContent = d2.toFormat("yyyy-LL-dd");
  qs("#day3date").textContent = d3.toFormat("yyyy-LL-dd");
}

function renderTimes(dayIndex){
  const box = qs("#time-container");
  box.innerHTML = "";

  if(appointments[dayIndex].length===0){
    box.innerHTML = `<div style="grid-column:1/-1; text-align:center; padding:12px;">ูุง ุชูุฌุฏ ููุงุนูุฏ ูุชุงุญุฉ</div>`;
    return;
  }
  appointments[dayIndex].forEach((humanTime, idx)=>{
    const actual = ActualTimes[dayIndex][idx]; // "hh:mm a"
    const btn = document.createElement("button");
    btn.className = "time-button";
    btn.dir = "ltr";
    btn.textContent = humanTime;
    btn.onclick = ()=> chooseDate(actual, qs(`#day${dayIndex+1}date`).textContent, 4);
    box.appendChild(btn);
  });
}

function chooseDate(timeAMPM, dateISO, currentPageIndex){
  nForm.date = dateISO;
  // convert "h:mm a" => "HH:mm"
  const t = DateTime.fromFormat(timeAMPM, "hh:mm a");
  nForm.time = t.toFormat("HH:mm");
  // goto next page
  const pCur = qs(`#page${currentPageIndex}`);
  const pNext= qs(`#page${currentPageIndex+1}`);
  swapPages(pCur, pNext);
}

function fetchAppointments(startISO){
  const area = $("#area").val();
  const serviceId = $("#service").val();
  // guard
  if(!area || !serviceId) return;

  const box = qs("#time-container");
  box.innerHTML = `<div class="spinner-border" style="grid-column:1/-1;justify-self:center"></div>`;

  appointments = [[],[],[]];
  ActualTimes = [[],[],[]];
  timesLoaded = false;

  callContent2(`/appointments?startDate=${startISO}&location=${area}&service=${serviceId}`, (data)=>{
    const items = data?.data?.appointments || [];
    // normalize & split into 3 days
    items.forEach(it=>{
      const d = DateTime.fromISO(it.TS_appointment_date, { setZone:true }).toISODate();
      const tm = DateTime.fromISO(it.TS_appointment_time, { setZone:true });
      const human = tm.toLocaleString(DateTime.TIME_SIMPLE).replace(" ", " ");
      const simple = tm.toFormat("hh:mm a");

      const d1 = DateTime.fromISO(startISO);
      const d2 = d1.plus({days:1}).toISODate();
      const d3 = d1.plus({days:2}).toISODate();

      if(d===d1.toISODate()){ appointments[0].push(human); ActualTimes[0].push(simple); }
      else if(d===d2){ appointments[1].push(human); ActualTimes[1].push(simple); }
      else if(d===d3){ appointments[2].push(human); ActualTimes[2].push(simple); }
    });

    timesLoaded = true;
    renderTimes(0); // default: first day
  }, true);
}

/* =========================
   Wizard navigation
========================= */
function initWizard(){
  // p1 -> p2
  qs("#page1-button").onclick = ()=>{
    swapPages(qs("#page1"), qs("#page2"));
  };

  // p2 -> p3
  qs("#page2-button").onclick = ()=>{
    if(!$("#area").val() || !$("#service").val()){
      qs("#page2-form").reportValidity();
      return;
    }
    nForm.location = $("#area").val();
    swapPages(qs("#page2"), qs("#page3"));
    // Auto advance to p4 after 5s like your old behavior
    setTimeout(()=> qs("#page3-button").click(), 5000);
  };

  // p3 -> p4 (hidden button; we click after 5s)
  qs("#page3-button").onclick = ()=>{
    swapPages(qs("#page3"), qs("#page4"));
  };

  // p4 back
  qs("#page4-return").onclick = ()=>{
    swapPages(qs("#page4"), qs("#page2"));
  };

  // p5 back
  qs("#page5-return").onclick = ()=>{
    swapPages(qs("#page5"), qs("#page4"));
  };

  // p6 back
  qs("#page6-return").onclick = ()=>{
    swapPages(qs("#page6"), qs("#page5"));
  };

  // p7 rebook
  qs("#rebook")?.addEventListener("click", ()=> {
    location.href = "https://www.spongnsoap.com/";
  });

  // when service changes -> ensure dates refreshed
  $("#service").on("change", ()=> $("#date").trigger("change"));

  // date change
  const todayISO = DateTime.now().toFormat("yyyy-LL-dd");
  qs("#date").setAttribute("min", todayISO);
  qs("#date").value = todayISO;
  resetDays(todayISO);
  $("#date").on("change", function(){
    this.disabled = true;
    resetDays(this.value);
    fetchAppointments(this.value);
    this.disabled = false;
  });

  // p5 -> routing (Mada payment page or Map)
  qs("#page5-button").onclick = async ()=>{
    const name = qs("#name").value.trim();
    if(!name){
      qs("#name").setCustomValidity("ููุฑุฌู ุฅุฏุฎุงู ุงูุงุณู");
      qs("#page5-form").reportValidity();
      return;
    } else { qs("#name").setCustomValidity(""); }

    if(!checkNumberValidity()){
      qs("#page5-form").reportValidity();
      return;
    }

    // Collect fields
    nForm.customerN = name;
    nForm.customerM = iti.getNumber().substring(1);
    nForm.paymentMethod = (document.querySelector('input[name="payingMethod"]:checked')||{}).value || "";
    nForm.locationDescription = qs("#locationDescription").value || "";

    // persist?
    try{
      if(confirm("ูุฏู ูุชุฐูุฑ ุจูุงูุงุชู ุนูู ูุฐุง ุงูุฌูุงุฒ ูุชุณููู ุงูุบุณูุงุช ุงูุฌุงูุฉ ุ")){
        localStorage.setItem("name", nForm.customerN);
        localStorage.setItem("mobile", nForm.customerM);
      } else {
        localStorage.removeItem("name"); localStorage.removeItem("mobile");
      }
    }catch(e){}

    if(nForm.paymentMethod === "Mada"){
      // Create a Telr payment session via Apps Script, then redirect to gateway
      try{
        const payload = {
          fn: "createTelrMadaSession",
          // include what you need to store in Sheets (Apps Script side writes to Google Sheet)
          order: {
            date: nForm.date,
            time: nForm.time,
            areaId: nForm.location,
            serviceId: nForm.service,
            serviceCount: nForm.serviceCount,
            customerName: nForm.customerN,
            customerMobile: nForm.customerM,
            carDesc: nForm.locationDescription
          },
          // Optional: success/cancel URLs (point back to same page with params)
          successUrl: location.origin + location.pathname + "?payment=success",
          cancelUrl:  location.origin + location.pathname + "?payment=cancel"
        };
        const res = await fetch(APPS_SCRIPT_BASE, {
          method:"POST",
          headers:{"Content-Type":"application/json"},
          body: JSON.stringify(payload)
        });
        const j = await res.json();
        if(!j.success || !j.redirect_url){
          alert(j.message || "ุชุนุฐุฑ ูุชุญ ุจูุงุจุฉ ุงูุฏูุน ูุฏู");
          return;
        }
        // You may want to keep order id in localStorage for later verification
        localStorage.setItem("order_id", j.order_id || "");
        // Redirect to Telr (or your hosted payment page)
        location.href = j.redirect_url;
        return; // stop wizard here; we will resume after redirect
      }catch(e){
        console.error(e);
        alert("ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุฅูุดุงุก ุนูููุฉ ุงูุฏูุน. ุญุงูู ูุฑุฉ ุฃุฎุฑู.");
        return;
      }
    }

    // Non-Mada โ go to map page
    swapPages(qs("#page5"), qs("#page6"));
  };

  // p6 submit โ Terms modal then reserveAppointment
  qs("#page6-button").onclick = ()=>{
    if(!position){
      infoWindow.setPosition(map.getCenter());
      infoWindow.setContent("ุงูุฑุฌุงุก ุชุญุฏูุฏ ุงููููุน");
      infoWindow.open(map);
      return;
    }

    const modalEl = qs("#termsModal");
    const modal   = new bootstrap.Modal(modalEl);
    const accept  = qs("#termsAccept");
    const confirm = qs("#confirmTerms");

    accept.checked = false; confirm.disabled = true;
    accept.onchange = ()=> confirm.disabled = !accept.checked;

    modal.show();
    confirm.onclick = async ()=>{
      modal.hide();

      // submit reservation to your backend
      nForm.urlLocation = position;
      const spinner = qs("#page6-spinner"); show(spinner); spinner.children[1].style.display = "block";
      try{
        const res = await fetch(defaultLink2 + `/reserveAppointment`, {
          method:"POST",
          body: JSON.stringify(nForm),
          redirect:"follow"
        });
        const j = await res.json();
        hide(spinner); spinner.children[1].style.display = "none";
        if(j.success){
          swapPages(qs("#page6"), qs("#page7"));
        } else {
          // bounce back to page4 and show error
          swapPages(qs("#page6"), qs("#page4"));
          const fail = qs("#fail-alert-3");
          fail.style.display = "block";
          fail.children[0].textContent = j.msgAR || "ุนุฐุฑูุง ุญุตู ุฎุทุฃ ุบูุฑ ูุชููุน ุงูุฑุฌุงุก ุงูุชูุงุตู ูุนูุง";
          $("#date").trigger("change");
        }
      }catch(e){
        hide(spinner); spinner.children[1].style.display = "none";
        swapPages(qs("#page6"), qs("#page4"));
        const fail = qs("#fail-alert-3");
        fail.style.display = "block";
        fail.children[0].textContent = "ุนุฐุฑูุง ุญุตู ุฎุทุฃ ุบูุฑ ูุชููุน ุงูุฑุฌุงุก ุงูุชูุงุตู ูุนูุง";
      }
    };
  };
}

/* =========================
   Maps
========================= */
function myMap(){
  // If coming back from Telr
  const p = param("payment");
  if(p === "success"){
    // Continue to map page
    setTimeout(()=> swapPages(qs("#page5"), qs("#page6")), 50);
  }else if(p === "cancel"){
    alert("ุชู ุฅูุบุงุก ุนูููุฉ ุงูุฏูุน.");
  }

  // init map
  map = new google.maps.Map(qs("#googleMap"), {
    center: defaultLocation,
    zoom: 12,
    disableDoubleClickZoom: true,
  });
  infoWindow = new google.maps.InfoWindow();

  marker = new google.maps.Marker({
    position: defaultLocation, map, draggable:true, title:"ุงุถุบุท ุฃู ุงุณุญุจ ูุชุญุฏูุฏ ุงููููุน",
  });

  marker.addListener("dragend", e => validateAndSetPosition(e.latLng));
  map.addListener("click", e => validateAndSetPosition(e.latLng));
  map.addListener("dblclick", e => { e.stop(); validateAndSetPosition(e.latLng); });

  let pressTimer;
  map.addListener("mousedown", e => { pressTimer = setTimeout(()=>validateAndSetPosition(e.latLng), 600); });
  map.addListener("mouseup",   ()=> clearTimeout(pressTimer));
  map.addListener("touchstart",e => { pressTimer = setTimeout(()=>validateAndSetPosition(e.latLng), 600); });
  map.addListener("touchend",  ()=> clearTimeout(pressTimer));

  const hint = qs("#drag-instructions");
  setTimeout(()=> hint.style.display = "none", 5000);
  map.addListener("dragstart", ()=> hint.style.display = "none");

  // area boundaries will be set on area change
  qs("#show-my-location").addEventListener("click", detectMyLocation);
}
window.myMap = myMap; // expose to Google Maps callback

function validateAndSetPosition(latLng){
  if(polygon && !google.maps.geometry.poly.containsLocation(latLng, polygon)){
    alert("โ๏ธ ุนุฐุฑูุงุ ูููุนู ุฎุงุฑุฌ ูุทุงู ุงูุฎุฏูุฉ");
    position = "";
    infoWindow.setContent("๐ซ ูููุน ุฎุงุฑุฌ ุงูุฎุฏูุฉ");
    infoWindow.open(map);
    return;
  }
  marker.setPosition(latLng);
  map.panTo(latLng);
  map.setZoom(17);
  position = `${prePosition}${latLng.lat()},${latLng.lng()}`;
  infoWindow.setContent("โ ุชู ุชุญุฏูุซ ูููุนู ููุง");
  infoWindow.open(map, marker);
}

function detectMyLocation(){
  if(navigator.geolocation){
    navigator.geolocation.getCurrentPosition((pos)=>{
      const latLng = new google.maps.LatLng(pos.coords.latitude, pos.coords.longitude);
      if(polygon && !google.maps.geometry.poly.containsLocation(latLng, polygon)){
        alert("โ๏ธ ุนุฐุฑูุงุ ูููุนู ุฎุงุฑุฌ ูุทุงู ุงูุฎุฏูุฉ");
        return;
      }
      marker.setPosition(latLng);
      map.panTo(latLng);
      map.setZoom(17);
      position = `${prePosition}${pos.coords.latitude},${pos.coords.longitude}`;
      infoWindow.close();
    }, ()=> handleLocationError(true));
  } else {
    handleLocationError(false);
  }
}
function handleLocationError(browserHasGeo){
  infoWindow.setPosition(map.getCenter());
  infoWindow.setContent(browserHasGeo? "โ๏ธ ุชุนุฐุฑ ุงูุญุตูู ุนูู ูููุนู. ูุฑุฌู ุงูุณูุงุญ ุจุงููุตูู ูููููุน." : "โ๏ธ ุฌูุงุฒู ูุง ูุฏุนู ุชุญุฏูุฏ ุงููููุน.");
  infoWindow.open(map);
}

/* =========================
   Service Area Polygons
========================= */
function setBoundries(){
  const selectedArea = $("#area option:selected").text().trim();
  let polygonCoords = null;

  // ูุซุงู: ุซูุงุซ ููุงุทู โ ุนุฏูู ุฃู ุฃุถู ุญุณุจ ุจูุงูุงุชู
  if(selectedArea === "ุงูุนุฒูุฒูุฉ - ุงูุฎุจุฑ"){
    polygonCoords = [
      { lng: 50.215045355428195, lat: 26.219724394350184 },
      { lng: 50.2135291654911,   lat: 26.1870383495685 },
      { lng: 50.137875179099595, lat: 26.069703060741347 },
      { lng: 50.10628808282646,  lat: 26.15001891083389 },
      { lng: 50.143828288837895, lat: 26.21660551929113 },
      { lng: 50.19603263782255,  lat: 26.21897351180097 },
    ];
  } else if(selectedArea === "ุฃุฌูุงู - ุฃุฑุงููู"){
    polygonCoords = [
      { lng: 50.06256215323989,  lat: 26.275519772515292 },
      { lng: 50.070562455580834, lat: 26.277608292466685 },
      { lng: 50.08514528516432,  lat: 26.257720425641132 },
      { lng: 50.06822454797902,  lat: 26.24524748257814 },
      { lng: 50.06115405632103,  lat: 26.262628935642045 },
      { lng: 50.05894452767791,  lat: 26.267950423932856 },
    ];
  } else if(selectedArea === "ุงูุฏูุญุฉ ู ุงูุฏุงูุฉ"){
    polygonCoords = [
      { lng: 50.11488540829821, lat: 26.341056543806932 },
      { lng: 50.136645122501264, lat: 26.353671078060277 },
      { lng: 50.14577577434936,  lat: 26.363004767230812 },
      { lng: 50.178697561294584,  lat: 26.3329268498157454 },
      { lng: 50.17972636713662,  lat: 26.31448441448552 },
      { lng: 50.16468008169681,  lat: 26.29799900302895 },
    ];
  } else {
    // no polygon
  }

  if(polygon){ polygon.setMap(null); polygon = null; }

  if(polygonCoords){
    polygon = new google.maps.Polygon({
      paths: polygonCoords,
      strokeColor: "#ff0000",
      strokeOpacity: .4,
      strokeWeight: 2,
      fillColor: "#00ff00",
      fillOpacity: .1
    });
    polygon.setMap(map);

    // center map on polygon
    const b = new google.maps.LatLngBounds();
    polygon.getPath().forEach(x => b.extend(x));
    map.fitBounds(b);
    marker.setPosition(b.getCenter());
    position = `${prePosition}${b.getCenter().lat()},${b.getCenter().lng()}`;
  }
}

/* =========================
   Boot
========================= */
document.addEventListener("DOMContentLoaded", ()=>{
  initPhone();
  initCarFields();
  loadLocal();
  // location & service lists
  loadLocations();
  $("#area").on("change", ()=>{ setBoundries(); loadServicesByArea(); });

  initWizard();
});
</script>

  <!-- External JS libs (kept here; app script will be sent next) -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css">
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/luxon@3.4.4/build/global/luxon.min.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/intl-tel-input@24.4.0/build/js/intlTelInputWithUtils.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Google Maps (callback + logic will be defined in the next messageโs script) -->
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBBHLoO038vsCovHN-SLUgAXqexlA2v0_4&libraries=geometry&callback=myMap" async defer></script>

  <!-- APP SCRIPT WILL BE PASTED HERE IN PART 2 -->
</body>
</html>
