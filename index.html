<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Maison Hikari • الطلب</title>

  <!-- Fonts & Icons -->
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet"/>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet"/>

  <!-- Bootstrap & Intl Tel Input -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://cdn.jsdelivr.net/npm/intl-tel-input@24.4.0/build/css/intlTelInput.css" rel="stylesheet"/>

  <meta name="theme-color" content="#0A0A0A">
  <meta name="description" content="Maison Hikari — اطلب الآن">

  <style>
    :root{
      --bg:#FAFAFA; --ink:#0B0D13; --muted:#6B7280; --rule:#EAEAEA;
      --brand:#111; --chip:#F2F2F2; --chip-ink:#111;
      --radius:14px; --radius-pill:999px; --shadow:0 10px 30px rgba(0,0,0,.08);
      --ease:cubic-bezier(.22,.61,.36,1);
      --focus:#0A0A0A;
      /* updated by JS based on real header height */
      --topbar-h:56px;
    }
    html,body{height:100%}
    body{
      font-family:'Cairo',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      color:var(--ink); background:var(--bg); display:flex; flex-direction:column;
      -webkit-tap-highlight-color:transparent; line-height:1.6;
    }

    /* focus */
    :where(button,a,.chip):focus-visible{outline:3px solid color-mix(in oklab, var(--focus) 45%, white); outline-offset:2px}
    .btn:active{transform:translateY(1px)}

    /* Header */
    .app-header{
      position:sticky; top:0; z-index:70; background:#fff;
      border-bottom:1px solid var(--rule);
      backdrop-filter: saturate(1.15) blur(6px);
      padding-top:max(0px, env(safe-area-inset-top));
      transition: padding .2s var(--ease);
    }
    .brand{font-weight:900}
    .cart-btn{position:relative;min-width:44px;min-height:44px;border-radius:var(--radius-pill);border:1px solid var(--rule);background:#fff}
    .cart-badge{position:absolute;top:-6px;inset-inline-start:-6px;background:#111;color:#fff;border-radius:999px;font-size:.75rem;padding:2px 7px;font-weight:900;box-shadow:0 6px 16px rgba(0,0,0,.18)}

    /* Chips row — sticks under header */
    .chips-wrap{background:#fff; border-bottom:1px solid var(--rule)}
    #chips{
      position: sticky;
      top: var(--topbar-h);     /* sits right under header */
      z-index: 66;
      background: #fff;
      padding:10px 0;
      border-bottom:1px solid var(--rule);
      transition: box-shadow .18s var(--ease);
    }
    .chip{
      background:var(--chip);color:var(--chip-ink);border:1px solid var(--rule);
      border-radius:var(--radius-pill);padding:10px 14px;font-weight:800;font-size:.95rem;min-height:44px;
      transition:all .18s var(--ease)
    }
    .chip.active{background:#111;color:#fff;border-color:#111}
    .pill-clear{background:#fff;border:1px dashed #bbb}
    .searchbox{border:1px solid var(--rule);border-radius:var(--radius-pill);overflow:hidden;background:#fff}
    .searchbox input{border:0;padding:12px 16px;min-height:46px}

    /* Subtle shadow when scrolled */
    body.scrolled #chips{ box-shadow:0 6px 16px rgba(0,0,0,.06) }

    /* Menu grid (cards with image on top) */
    main{flex:1 1 auto;display:flex;flex-direction:column}
    .menu-grid{display:grid;gap:14px;grid-template-columns:repeat(1,minmax(0,1fr))}
    @media(min-width:640px){.menu-grid{grid-template-columns:repeat(2,minmax(0,1fr))}}
    @media(min-width:992px){.menu-grid{grid-template-columns:repeat(3,minmax(0,1fr))}}

    .dish{background:#fff;border:1px solid var(--rule);border-radius:var(--radius);overflow:hidden;box-shadow:var(--shadow);display:flex;flex-direction:column}
    .dish-img{width:100%;aspect-ratio:16/9;object-fit:cover;display:block;background:#f3f4f6}
    .dish-body{padding:12px 12px 14px}
    .dish h6{font-weight:900;margin:0 0 4px}
    .price{font-weight:900}
    .badges{display:flex;align-items:center;justify-content:space-between;margin-bottom:6px}
    .badges .left{display:flex;gap:6px;flex-wrap:wrap}
    .b{border:1px solid var(--rule);border-radius:999px;padding:3px 8px;font-size:.75rem;font-weight:800}
    .b.hot{border-color:#fecaca;color:#b91c1c;background:#fff5f5}
    .b.new{border-color:#fde68a;color:#b45309;background:#fffbeb}
    .b.best{border-color:#bbf7d0;color:#166534;background:#f0fdf4}
    .tags{display:flex;flex-wrap:wrap;gap:6px}
    .tag{border:1px solid var(--rule);border-radius:999px;padding:4px 8px;font-size:.8rem;color:#555}
    .add-wrap{margin-top:10px}
    .add-btn{width:100%;min-height:46px;border-radius:999px;border:1px solid #111;background:#111;color:#fff;font-weight:900}

    /* Mini bar */
    .mini-bar{
      position:sticky;bottom:0;z-index:55;background:#0A0A0A;color:#fff;
      padding:10px 12px;border-top:1px solid rgba(255,255,255,.12);
      padding-bottom:calc(14px + env(safe-area-inset-bottom));
    }
    .mini-btn{min-height:52px;border-radius:999px;font-weight:900}

    /* Toast & helpers */
    #toasts{position:fixed;inset-block-start:14px;left:50%;transform:translateX(-50%);z-index:200;display:flex;flex-direction:column;gap:8px}
    .toast-msg{background:#111;color:#fff;padding:10px 14px;border-radius:12px;box-shadow:0 14px 40px rgba(0,0,0,.25);font-weight:800;transition:transform .18s var(--ease),opacity .18s var(--ease)}
    .spacer{height:18vh}

    /* Overlays (loading) */
    .overlay{
      position:fixed; inset:0; z-index:999; display:none;
      align-items:center; justify-content:center; text-align:center;
      background:rgba(255,255,255,.92); backdrop-filter:blur(6px) saturate(1.1);
    }
    .overlay.show{ display:flex; }
    .overlay .box{
      background:#fff; border:1px solid var(--rule); border-radius:16px;
      padding:18px 20px; box-shadow:var(--shadow); min-width:220px;
    }
    .overlay .msg{ margin-top:.5rem; color:#555; font-weight:800 }
  </style>
</head>
<body>
  <!-- App Loading Overlay -->
  <div id="appLoading" class="overlay" aria-live="polite" aria-busy="true" style="display:none">
    <div class="box">
      <div class="spinner-border" role="status" aria-label="جارِ التحميل"></div>
      <div class="msg">جاري تحميل القائمة…</div>
    </div>
  </div>

  <!-- Submit/Confirm Overlay -->
  <div id="submitLoading" class="overlay" aria-live="polite" aria-busy="true" style="display:none">
    <div class="box">
      <div class="spinner-border" role="status" aria-label="جارِ المعالجة"></div>
      <div class="msg">جارِ تأكيد الطلب…</div>
    </div>
  </div>

  <!-- Toasts -->
  <div id="toasts" aria-live="polite" aria-atomic="true"></div>

  <!-- Header -->
  <header class="app-header" id="topbar">
    <div class="container py-2 d-flex align-items-center justify-content-between gap-2">
      <div class="d-flex align-items-center gap-3">
        <img src="https://images.unsplash.com/photo-1544025162-d76694265947?q=80&w=120&auto=format&fit=crop" alt="" width="44" height="44" style="border-radius:12px;object-fit:cover" loading="lazy">
        <div>
          <div class="brand">Maison Hikari</div>
          <small class="text-secondary">الياباني المعاصر</small>
        </div>
      </div>

      <button id="openCart" class="cart-btn px-3" aria-label="السلة">
        <i class="fa-solid fa-bag-shopping"></i>
        <span id="badge" class="cart-badge" aria-live="polite">0</span>
      </button>
    </div>
  </header>

  <!-- Chips & Search (sticky under header) -->
  <div class="chips-wrap">
    <div class="container">
      <div id="chips" aria-label="تصنيفات">
        <div class="d-flex flex-wrap gap-2 align-items-center">
          <button class="chip active" data-cat="all">الكل</button>
          <button class="chip" data-cat="sushi">سوشي</button>
          <button class="chip" data-cat="don">دون</button>
          <button class="chip" data-cat="meat">لحوم</button>
          <button class="chip" data-cat="drinks">مشروبات</button>
          <button id="clearFilters" class="chip pill-clear d-none" type="button">مسح التصفية</button>

          <div class="ms-auto flex-grow-1" style="min-width:240px">
            <div class="searchbox d-flex" role="search">
              <input id="q" type="search" class="form-control" placeholder="ابحث عن طبق … (سالمون، واجيو…)" autocomplete="off" aria-label="بحث"/>
              <button class="btn" aria-label="بحث"><i class="fa-solid fa-magnifying-glass"></i></button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- CONTENT -->
  <main>
    <!-- MENU -->
    <section class="py-3">
      <div class="container">
        <h6 class="mb-2 text-secondary">القائمة</h6>
        <div id="grid" class="menu-grid" aria-live="polite"></div>
        <div class="spacer"></div>
      </div>

      <!-- Mini checkout bar -->
      <div class="mini-bar">
        <div class="container d-flex align-items-center gap-2">
          <div class="flex-grow-1">
            <div class="d-flex align-items-baseline gap-2">
              <strong id="miniCount" aria-live="polite" aria-atomic="true">0 عنصر</strong>
              <span class="text-white-50">•</span>
              <strong id="miniTotal" aria-live="polite" aria-atomic="true">0.00 ر.س</strong>
            </div>
            <small class="text-white-50" id="miniProgress">الضريبة ورسوم التوصيل تُضاف لاحقاً</small>
          </div>
          <a id="goCartBtn" href="#cart" class="btn btn-light mini-btn text-dark disabled" aria-disabled="true">الانتقال للسلة</a>
        </div>
      </div>
    </section>

    <!-- CART (very light for this demo) -->
    <section id="cart" class="py-4">
      <div class="container">
        <div class="card p-3 p-md-4">
          <h5 class="mb-3"><i class="fa-solid fa-bag-shopping"></i> السلة</h5>
          <div id="cartList" class="mb-3"></div>
          <div class="d-flex justify-content-between border-top pt-3">
            <span>الإجمالي</span>
            <strong id="cartTotal">0.00 ر.س</strong>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Templates -->
  <template id="dishTpl">
    <div class="dish" data-cat="">
      <img class="dish-img" alt="" width="1200" height="675" loading="lazy"/>
      <div class="dish-body">
        <div class="badges">
          <div class="left"></div>
          <div class="price"></div>
        </div>
        <h6 class="title"></h6>
        <div class="text-secondary small mb-1 desc"></div>
        <div class="tags d-none"></div>
        <div class="add-wrap">
          <button class="add-btn" type="button" aria-label="أضف للسلة">أضف للسلة</button>
        </div>
      </div>
    </div>
  </template>

  <template id="cartLineTpl">
    <div class="d-flex align-items-center justify-content-between py-2 border-bottom">
      <div class="flex-grow-1 text-truncate text-end me-2">
        <div class="fw-bold name"></div>
        <div class="small text-secondary">× <span class="unit">0.00</span> ر.س</div>
      </div>
      <div class="d-flex align-items-center gap-2">
        <button class="btn btn-sm btn-outline-dark rounded-pill minus" aria-label="إنقاص">−</button>
        <strong class="qty" aria-live="polite">1</strong>
        <button class="btn btn-sm btn-dark rounded-pill plus" aria-label="زيادة">+</button>
        <div class="text-nowrap fw-bold total ms-2">0.00 ر.س</div>
      </div>
    </div>
  </template>

  <!-- JS libs -->
  <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/intl-tel-input@24.4.0/build/js/intlTelInputWithUtils.js"></script>

  <script>
  // --- Demo menu source (replace with your GAS endpoint if needed)
  const DEMO_MENU = [
    {id:'1', title:'A5 واجيو دون', desc:'واجبو على الجريل مع صوص يوزو', price:120, img:'https://images.unsplash.com/photo-1550547660-d9450f859349?q=80&w=1200&auto=format&fit=crop', cat:'don', badges:['الأكثر طلبًا']},
    {id:'2', title:'سوشي سالمون', desc:'قطع سالمون طازجة', price:48, img:'https://images.unsplash.com/photo-1553621042-f6e147245754?q=80&w=1200&auto=format&fit=crop', cat:'sushi', badges:['جديد']},
    {id:'3', title:'رييش لحم', desc:'رييش مشوية ببطء', price:86, img:'https://images.unsplash.com/photo-1551183053-bf91a1d81141?q=80&w=1200&auto=format&fit=crop', cat:'meat', badges:['حار']},
    {id:'4', title:'دون كاتسو', desc:'كاتسو كرسبي مع أرز', price:64, img:'https://images.unsplash.com/photo-1540189549336-e6e99c3679fe?q=80&w=1200&auto=format&fit=crop', cat:'don'},
    {id:'5', title:'آيس ماتشا لاتيه', desc:'مشروب منعش', price:22, img:'https://images.unsplash.com/photo-1525382455947-f319bc05f3be?q=80&w=1200&auto=format&fit=crop', cat:'drinks'},
    {id:'6', title:'سوشي تونا', desc:'تونا طازجة', price:52, img:'https://images.unsplash.com/photo-1514517220038-65df93a1d34c?q=80&w=1200&auto=format&fit=crop', cat:'sushi'}
  ];

  window.addEventListener('DOMContentLoaded', () => {
    const state = { q:'', cat:'all', cart:{}, menu:[...DEMO_MENU] };
    const fmt = new Intl.NumberFormat('ar-SA', { style:'currency', currency:'SAR' });

    /* ===== Sticky var (header height) & scroll shadow ===== */
    const topbarEl = document.getElementById('topbar');
    function setStickyVars(){
      const h = topbarEl?.getBoundingClientRect().height || 56;
      document.documentElement.style.setProperty('--topbar-h', `${Math.round(h)}px`);
    }
    window.addEventListener('resize', setStickyVars, { passive:true });
    setStickyVars();

    window.addEventListener('scroll', () => {
      document.body.classList.toggle('scrolled', window.scrollY > 8);
    }, { passive:true });

    /* ===== Elements ===== */
    const grid=document.getElementById('grid');
    const dishTpl=document.getElementById('dishTpl');
    const search=document.getElementById('q');
    const chips=document.getElementById('chips');
    const clearFilters=document.getElementById('clearFilters');
    const badge=document.getElementById('badge');
    const miniCount=document.getElementById('miniCount');
    const miniTotal=document.getElementById('miniTotal');
    const goCartBtn=document.getElementById('goCartBtn');
    const cartList=document.getElementById('cartList');
    const cartLineTpl=document.getElementById('cartLineTpl');
    const cartTotal=document.getElementById('cartTotal');

    /* ===== Helpers ===== */
    function imgFallback(el){
      el.src='data:image/svg+xml;utf8,'+encodeURIComponent(`<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="675"><rect width="100%" height="100%" fill="#f3f4f6"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="#9ca3af" font-family="Arial" font-size="28">لا صورة</text></svg>`);
    }
    function stableId(str){ let h=0; for(let i=0;i<str.length;i++){ h=((h<<5)-h)+str.charCodeAt(i); h|=0;} return 'l_'+Math.abs(h).toString(36); }
    function toast(msg){
      const box=document.getElementById('toasts'); const el=document.createElement('div');
      el.className='toast-msg'; el.textContent=msg; box.appendChild(el);
      setTimeout(()=>{el.style.opacity='0'; el.style.transform='translateY(-6px)'; setTimeout(()=>el.remove(),180);},2200);
    }

    /* ===== Render menu ===== */
    function renderGrid(){
      grid.innerHTML='';
      const q=(state.q||'').toLowerCase().trim();
      const list=state.menu.filter(d=>{
        const inCat=(state.cat==='all'||(d.cat||'')===state.cat);
        const inTxt=!q||[d.title||'',d.desc||''].join(' ').toLowerCase().includes(q);
        return inCat && inTxt;
      });

      if(list.length===0){
        const empty=document.createElement('div'); empty.className='text-center text-secondary py-5';
        empty.textContent='لا توجد أطباق مطابقة — جرّب تصنيف آخر أو كلمة مختلفة'; grid.appendChild(empty);
      }

      list.forEach(d=>{
        const node=dishTpl.content.firstElementChild.cloneNode(true);
        const img=node.querySelector('.dish-img');
        img.alt=d.title||''; img.addEventListener('error',()=>imgFallback(img));
        if(d.img && /^https?:\/\//.test(d.img)) img.src=d.img; else imgFallback(img);

        const left=node.querySelector('.badges .left');
        (d.badges||[]).slice(0,2).forEach(b=>{
          const s=document.createElement('span'); s.className='b';
          if(/حار|hot/i.test(b)) s.classList.add('hot');
          if(/جديد|new/i.test(b)) s.classList.add('new');
          if(/الأكثر|best/i.test(b)) s.classList.add('best');
          s.textContent=b; left.appendChild(s);
        });

        node.querySelector('.price').textContent=fmt.format(Number(d.price||0));
        node.querySelector('.title').textContent=d.title||'—';
        node.querySelector('.desc').textContent=d.desc||'';
        node.querySelector('.add-btn').addEventListener('click', ()=>addToCart(d,1));
        grid.appendChild(node);
      });

      clearFilters.classList.toggle('d-none', state.cat==='all' && !state.q.trim());
    }

    /* ===== Filters ===== */
    chips.addEventListener('click', e=>{
      const b=e.target.closest('.chip'); if(!b) return;
      if(b.id==='clearFilters'){ state.q=''; search.value=''; state.cat='all'; document.querySelectorAll('.chip').forEach(x=>x.classList.remove('active')); document.querySelector('.chip[data-cat="all"]').classList.add('active'); renderGrid(); return; }
      document.querySelectorAll('.chip').forEach(x=>x.classList.remove('active'));
      b.classList.add('active'); state.cat=b.dataset.cat; renderGrid();
    });
    let searchTimer=null;
    search.addEventListener('input', e=>{ clearTimeout(searchTimer); searchTimer=setTimeout(()=>{ state.q=e.target.value; renderGrid(); },180); });

    /* ===== Cart ===== */
    function cartArr(){ return Object.values(state.cart); }
    function totals(){ const arr=cartArr(); return { count:arr.reduce((a,b)=>a+b.qty,0), total:arr.reduce((a,b)=>a+b.qty*b.price,0), arr }; }
    function bump(){
      const t=totals();
      badge.textContent=t.count;
      miniCount.textContent=`${t.count} عنصر`;
      miniTotal.textContent=fmt.format(t.total);
      cartTotal.textContent=fmt.format(t.total);
      goCartBtn.classList.toggle('disabled', t.count===0);
      goCartBtn.setAttribute('aria-disabled', String(t.count===0));
      renderCartList();
    }
    function addToCart(item, qty){
      const id = stableId(item.id);
      if(state.cart[id]) state.cart[id].qty += qty;
      else state.cart[id] = {id, title:item.title, price:Number(item.price||0), qty};
      bump(); toast(`أُضيف ${item.title} ✅`);
    }
    function renderCartList(){
      cartList.innerHTML='';
      const {arr}=totals();
      if(arr.length===0){ cartList.innerHTML = '<p class="text-center text-secondary my-4">السلة فارغة</p>'; return; }
      arr.forEach(it=>{
        const row=cartLineTpl.content.firstElementChild.cloneNode(true);
        row.querySelector('.name').textContent=it.title;
        row.querySelector('.unit').textContent=Number(it.price||0).toFixed(2);
        row.querySelector('.qty').textContent=it.qty;
        row.querySelector('.total').textContent=fmt.format(it.qty*it.price);
        row.querySelector('.minus').addEventListener('click', ()=>{ if(!state.cart[it.id]) return; if(--state.cart[it.id].qty<=0) delete state.cart[it.id]; bump(); });
        row.querySelector('.plus').addEventListener('click',  ()=>{ if(!state.cart[it.id]) return; state.cart[it.id].qty++; bump(); });
        cartList.appendChild(row);
      });
    }

    // Init
    renderGrid(); bump();
  });
  </script>
</body>
</html>
