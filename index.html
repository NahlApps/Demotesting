<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Maison Hikari • الطلب</title>

  <!-- Fonts & Icons -->
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Didact+Gothic&family=Cairo:wght@400;700;900&display=swap" rel="stylesheet"/>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet"/>

  <!-- Bootstrap & Intl Tel Input -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://cdn.jsdelivr.net/npm/intl-tel-input@24.4.0/build/css/intlTelInput.css" rel="stylesheet"/>

  <meta name="theme-color" content="#141414" />
  <meta name="description" content="Maison Hikari — اطلب الآن" />

  <style>
    :root{
      --charcoal:#141414; --porcelain:#adadad; --gold:#D4AF37;
      --ink-on-dark:#EDEBE6; --ink-on-light:#1A1A1A;
      --border-on-dark: rgba(237,235,230,.15); --border-on-light: rgba(20,20,20,.12);
      --radius:14px; --radius-pill:999px; --shadow:0 10px 30px rgba(0,0,0,.25);
      --topbar-h:56px; --chips-h:0px;
      --focus: var(--gold);
    }
    html,body{height:100%}
    html{scroll-behavior:smooth;}
    body{
      font-family:'Cairo','Didact Gothic','Perandory',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      color:var(--ink-on-dark); background:var(--charcoal);
      display:flex; flex-direction:column; -webkit-tap-highlight-color:transparent;
    }
    :where(a,button,[role="button"],input,select,textarea):focus-visible{
      outline:2px solid var(--focus); outline-offset:2px; box-shadow:0 0 0 4px rgba(212,175,55,.25);
    }

    /* Header */
    .app-header{position:sticky;top:0;z-index:70;background:color-mix(in srgb, var(--charcoal) 88%, black);border-bottom:1px solid var(--border-on-dark);backdrop-filter:saturate(1.05) blur(6px)}
    .brand{font-family:'Perandory','Didact Gothic','Cairo',sans-serif;font-weight:900;letter-spacing:.3px;color:var(--ink-on-dark)}
    .cart-btn{position:relative;min-width:44px;min-height:44px;border-radius:var(--radius-pill);border:1px solid var(--border-on-dark);background:transparent;color:var(--ink-on-dark)}
    .cart-badge{position:absolute;top:-6px;inset-inline-start:-6px;background:var(--gold);color:#141414;border-radius:999px;font-size:.75rem;padding:2px 7px;font-weight:900;box-shadow:0 6px 16px rgba(0,0,0,.4)}
    @media (prefers-reduced-motion:no-preference){ .cart-badge.bump{ animation:bump .4s } @keyframes bump{0%{transform:scale(1)}30%{transform:scale(1.18)}100%{transform:scale(1)}} }

    /* Chips/Search (in normal flow) */
    .chips-wrap{background:color-mix(in srgb, var(--charcoal) 86%, black);border-bottom:1px solid var(--border-on-dark)}
    #chips{display:flex;flex-wrap:wrap;gap:8px;padding-block:10px;align-items:center}
    .chip{background:var(--porcelain);color:var(--ink-on-light);border:1px solid var(--border-on-light);border-radius:var(--radius-pill);padding:10px 14px;min-height:44px;font-weight:800;font-size:.95rem;transition:.18s}
    .chip:hover{filter:saturate(1.02) brightness(1.02)}
    .chip.active{background:var(--gold);color:#141414;border-color:color-mix(in srgb, var(--gold) 70%, #000)}
    .pill-clear{background:transparent;border:1px dashed var(--border-on-dark);color:var(--ink-on-dark)}
    .search-wrap{margin-inline-start:auto}
    .searchbox{display:flex;align-items:center;gap:6px;border:1px solid var(--border-on-dark);border-radius:var(--radius-pill);background:color-mix(in srgb, var(--charcoal) 70%, #000);padding-inline:8px;transition:.18s;color:var(--ink-on-dark)}
    .searchbox .btn{min-width:36px;color:var(--ink-on-dark)}
    .searchbox input{border:0;min-height:46px;color:var(--ink-on-dark);background:transparent;width:0;min-width:0;padding:0;opacity:0;pointer-events:none;transition:.18s}
    .searchbox.open{box-shadow:0 8px 28px rgba(0,0,0,.45)}
    .searchbox.open input{width:66vw;opacity:1;pointer-events:auto;padding:12px 16px}
    @media (min-width:768px){.searchbox.open input{width:320px}}

    /* Affixed clone shown on scroll */
    #chipsAffix{position:fixed;inset-inline:0;top:var(--topbar-h);z-index:90;background:color-mix(in srgb, var(--charcoal) 86%, black);border-bottom:1px solid var(--border-on-dark);display:none}
    #chipsAffix.visible{display:block;box-shadow:0 8px 24px rgba(0,0,0,.35);animation:fadeSlide .18s ease}
    @keyframes fadeSlide{from{opacity:0;transform:translateY(-6px)}to{opacity:1;transform:none}}

    /* Sections */
    .menu-section{scroll-margin-top:calc(var(--topbar-h) + var(--chips-h) + 12px);padding-top:8px}
    .sec-title{margin:12px 0;font-weight:900;color:var(--ink-on-dark);position:relative;display:inline-block;padding-inline:8px;padding-block:2px;background:linear-gradient(90deg, color-mix(in srgb, var(--gold) 35%, transparent), transparent 60%);border-radius:6px}

    .menu-grid{display:grid;gap:14px;grid-template-columns:repeat(1,minmax(0,1fr))}
    @media(min-width:640px){.menu-grid{grid-template-columns:repeat(2,minmax(0,1fr))}}
    @media(min-width:992px){.menu-grid{grid-template-columns:repeat(3,minmax(0,1fr))}}

    .dish{background:var(--porcelain);color:var(--ink-on-light);border:1px solid var(--border-on-light);border-radius:var(--radius);overflow:hidden;box-shadow:var(--shadow);display:flex;flex-direction:column}
    .dish-img{width:100%;aspect-ratio:16/9;object-fit:cover;background:#e9e6df}
    .dish-body{padding:12px 12px 14px}
    .dish h6{font-family:'Perandory','Didact Gothic','Cairo',sans-serif;font-weight:900;margin:0 0 4px;color:var(--ink-on-light)}
    .desc{color:rgba(26,26,26,.72)}
    .price{font-weight:900;color:var(--gold)}
    .tags{display:flex;flex-wrap:wrap;gap:6px}
    .tag{background:#EFECE6;color:#2b2b2b;border:1px solid var(--border-on-light);border-radius:999px;padding:4px 8px;font-size:.8rem}
    .add-wrap{margin-top:8px}
    .add-btn{width:100%;min-height:46px;border-radius:999px;border:1px solid var(--gold);background:var(--gold);color:#141414;font-weight:900}
    .add-btn:hover{background:color-mix(in srgb, var(--gold) 85%, #000 15%);border-color:color-mix(in srgb, var(--gold) 85%, #000 15%)}

    .cart-card,.card-paper{background:var(--porcelain);color:var(--ink-on-light);border:1px solid var(--border-on-light);border-radius:var(--radius);box-shadow:var(--shadow)}
    .line{display:flex;align-items:center;gap:10px;justify-content:space-between;padding:10px 0;border-bottom:1px dashed var(--border-on-light)}
    .seg{display:inline-grid;grid-auto-flow:column;gap:8px;background:#EFECE6;padding:6px;border-radius:999px;border:1px solid var(--border-on-light)}
    .seg button{background:#fff;border:1px solid var(--border-on-light);border-radius:999px;padding:11px 16px;min-height:46px;font-weight:900;color:#1a1a1a}
    .seg button[aria-pressed="true"]{background:var(--gold);color:#141414;border-color:var(--gold)}
    #etaBadge{background:color-mix(in srgb, var(--gold) 18%, #fff);color:#141414;padding:4px 10px;border-radius:999px;font-weight:800;border:1px solid var(--gold)}
    .inp-wrap{position:relative}.inp-wrap .ico{position:absolute;inset-inline-start:12px;inset-block-start:50%;transform:translateY(-50%);color:#6b6760;pointer-events:none}
    .pad-icon{padding-inline-start:42px}
    .form-control,.form-select{min-height:56px;border-color:var(--border-on-light);color:#1a1a1a}
    .iti{direction:ltr}.iti input{text-align:left}

    .mini-bar{position:sticky;bottom:0;z-index:55;background:var(--charcoal);color:var(--ink-on-dark);padding:10px 12px;border-top:1px solid var(--border-on-dark);padding-bottom:calc(14px + env(safe-area-inset-bottom))}
    .mini-btn{min-height:52px;border-radius:999px;font-weight:900}

    #toasts{position:fixed;inset-block-start:14px;left:50%;transform:translateX(-50%);z-index:200;display:flex;flex-direction:column;gap:8px}
    .toast-msg{background:#171717;color:var(--ink-on-dark);padding:10px 14px;border-radius:12px;box-shadow:0 14px 40px rgba(0,0,0,.5);font-weight:800;border:1px solid var(--border-on-dark)}

    #appLoading,#submitLoading{position:fixed;inset:0;z-index:999;display:none;align-items:center;justify-content:center;text-align:center;background:rgba(20,20,20,.9);backdrop-filter:blur(6px);color:var(--ink-on-dark)}
    .overlay.show{display:flex}
    .overlay .box{background:var(--porcelain);color:var(--ink-on-light);border:1px solid var(--border-on-light);border-radius:16px;padding:18px 20px;box-shadow:var(--shadow);min-width:220px}
    .overlay .msg{margin-top:.5rem;color:#2b2b2b;font-weight:800}

    .btn-dark,#optAddBtn,#confirmBtn,#thBackMenu{background:var(--gold)!important;border-color:var(--gold)!important;color:#141414!important}
    .btn-dark:hover,#optAddBtn:hover,#confirmBtn:hover,#thBackMenu:hover{background:color-mix(in srgb, var(--gold) 85%, #000 15%)!important;border-color:color-mix(in srgb, var(--gold) 85%, #000 15%)!important;color:#141414!important}
    .btn-outline-dark,#thBackCart{color:var(--ink-on-light)!important;border-color:var(--border-on-light)!important;background:transparent!important}
    .btn-outline-dark:hover,#thBackCart:hover{background:#EFECE6!important;border-color:var(--gold)!important;color:#141414!important}
  </style>

  <!-- Reels (optional) -->
  <style>
    #reels{position:fixed;inset:0;z-index:1100;display:none;background:#000;color:#fff}
    #reels.show{display:block}
    #reelsHeader{position:absolute;inset-inline:0;inset-block-start:0;display:flex;align-items:center;justify-content:space-between;padding:10px 12px;background:linear-gradient(180deg,rgba(0,0,0,.6),rgba(0,0,0,0));pointer-events:none;z-index:2}
    #reelsHeader .btn,#reelsHeader .chip{pointer-events:auto}
    .reels-list{height:100vh;overflow-y:auto;overscroll-behavior:contain;scroll-snap-type:y mandatory;-webkit-overflow-scrolling:touch;outline:none;touch-action:pan-y}
    .reel{position:relative;height:100vh;display:grid;grid-template-rows:1fr auto;isolation:isolate;scroll-snap-align:start;scroll-snap-stop:always}
    .reel .media{position:relative;background:#000;min-height:0;display:grid;place-items:center}
    .reel img{width:100%;height:100%;object-fit:cover;background:#111}
    .reel .glass{position:absolute;inset-inline:0;inset-block-end:0;padding:14px 12px 18px;background:linear-gradient(0deg,rgba(0,0,0,.65),rgba(0,0,0,0));color:#fff;z-index:1}
    .reel .title{font-family:'Perandory','Didact Gothic','Cairo',sans-serif;font-weight:900;margin:0 0 6px}
    .reel .desc{opacity:.9;font-size:.95rem}
    .reel .tagbox{display:flex;gap:6px;flex-wrap:wrap;margin-top:8px}
    .reel .tag{background:rgba(255,255,255,.12);border:1px solid rgba(255,255,255,.18);color:#fff;border-radius:999px;padding:4px 8px;font-size:.8rem}
    .reel .cta{position:absolute;inset-inline:12px;inset-block-end:12px;z-index:2;display:flex;gap:8px}
    .reel .cta .btn{border-radius:999px;font-weight:900;min-height:46px}
    #reelsLoading{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;z-index:3;background:linear-gradient(180deg,rgba(0,0,0,.5),rgba(0,0,0,.35))}
    #reelsLoading[hidden]{display:none}
  </style>
</head>
<body>
  <!-- Overlays -->
  <div id="appLoading" class="overlay" aria-live="polite" aria-busy="true">
    <div class="box">
      <div class="spinner-border text-gold" role="status" aria-label="جارِ التحميل"></div>
      <div class="msg">جاري تحميل القائمة…</div>
    </div>
  </div>
  <div id="submitLoading" class="overlay" aria-live="polite" aria-busy="true">
    <div class="box">
      <div class="spinner-border text-gold" role="status" aria-label="جارِ المعالجة"></div>
      <div class="msg">جارِ تأكيد الطلب…</div>
    </div>
  </div>
  <div id="toasts" aria-live="polite" aria-atomic="true"></div>

  <!-- Header -->
  <header class="app-header" id="topbar">
    <div class="container py-2 d-flex align-items-center justify-content-between gap-2">
      <div class="d-flex align-items-center gap-3">
        <img src="https://images.unsplash.com/photo-1544025162-d76694265947?q=80&w=120&auto=format&fit=crop" alt="" width="44" height="44" style="border-radius:12px;object-fit:cover" loading="lazy" fetchpriority="high" decoding="async">
        <div>
          <div class="brand">Maison Hikari</div>
          <small class="text-secondary" style="color:#c9c6bf !important">الياباني المعاصر</small>
        </div>
      </div>
      <button id="openCart" class="cart-btn px-3" aria-label="السلة">
        <i class="fa-solid fa-bag-shopping"></i>
        <span id="badge" class="cart-badge" aria-live="polite">0</span>
      </button>
    </div>
  </header>

  <!-- Chips + Search (in flow) -->
  <div class="chips-wrap" id="chipsWrap" hidden aria-hidden="true">
    <div class="container">
      <div id="chips" aria-label="تصنيفات">
        <button class="chip active" data-target="#topOfMenu">الكل</button>
        <button class="chip" data-target="#sec-sushi">سوشي</button>
        <button class="chip" data-target="#sec-don">دون</button>
        <button class="chip" data-target="#sec-meat">لحوم</button>
        <button class="chip" data-target="#sec-drinks">مشروبات</button>
        <div class="search-wrap">
          <div class="searchbox d-flex" role="search" aria-label="بحث">
            <button class="btn js-search-toggle" aria-label="بحث"><i class="fa-solid fa-magnifying-glass"></i></button>
            <input id="q" data-role="menu-search" type="search" class="form-control" placeholder="ابحث عن طبق … (سالمون، واجيو…)" autocomplete="off" aria-label="بحث"/>
          </div>
        </div>
        <button id="openReels" class="chip js-open-reels" type="button" aria-haspopup="dialog">عرض رييل</button>
        <button class="chip pill-clear js-clear-filters d-none" type="button">مسح التصفية</button>
      </div>
    </div>
  </div>

  <!-- Affixed clone + sentinel -->
  <div id="chipsAffix" aria-hidden="true"></div>
  <div id="chipsSentinel"></div>

  <!-- Content -->
  <main id="topOfMenu">
    <div class="tab-content flex-1">
      <!-- MENU -->
      <section id="tab-menu" class="tab-pane fade show active">
        <div class="container py-3" id="menuContainer">
          <div id="menuSections"></div>
          <p id="emptyMsg" class="text-secondary text-center my-5 d-none" style="color:#c9c6bf !important">لا توجد أطباق مطابقة — جرّب كلمة بحث مختلفة</p>
          <div style="height:18vh"></div>
        </div>

        <!-- Mini checkout bar -->
        <div class="mini-bar">
          <div class="container d-flex align-items-center gap-2">
            <div class="flex-grow-1">
              <div class="d-flex align-items-baseline gap-2">
                <strong id="miniCount" aria-live="polite" aria-atomic="true">0 عنصر</strong>
                <span class="text-white-50">•</span>
                <strong id="miniTotal" aria-live="polite" aria-atomic="true">0.00 ر.س</strong>
              </div>
              <small class="text-white-50" id="miniHint">الضريبة ورسوم التوصيل تُضاف لاحقاً</small>
            </div>
            <a id="goCartBtn" href="#tab-cart" class="btn btn-light mini-btn text-dark disabled" aria-disabled="true">الانتقال للسلة</a>
          </div>
        </div>
      </section>

      <!-- CART -->
      <section id="tab-cart" class="tab-pane fade">
        <div class="container py-3">
          <div class="cart-card p-3 p-md-4">
            <h5 class="mb-3"><i class="fa-solid fa-bag-shopping"></i> السلة</h5>
            <div id="cartList" class="mb-3"></div>
            <div class="d-flex justify-content-between border-top pt-3" style="border-color:var(--border-on-light)!important">
              <span>الإجمالي</span> <strong id="cartTotal">0.00 ر.س</strong>
            </div>
            <div class="d-flex gap-2 mt-3">
              <a href="#tab-menu" class="btn btn-outline-dark flex-fill py-3 fw-bold" data-go="menu">رجوع للقائمة</a>
              <a id="toDataBtn" href="#tab-data" class="btn btn-dark flex-fill py-3 fw-bold disabled" aria-disabled="true" data-go="data">متابعة</a>
            </div>
          </div>
        </div>
      </section>

      <!-- CUSTOMER DATA -->
      <section id="tab-data" class="tab-pane fade">
        <div class="container py-4">
          <div class="d-flex align-items-center gap-2 mb-3">
            <div class="seg" aria-label="نوع الطلب">
              <button id="segPickup" class="btn" aria-pressed="true" type="button">استلام</button>
              <button id="segDelivery" class="btn" aria-pressed="false" type="button">توصيل</button>
            </div>
            <span id="etaBadge">ETA ~ 15</span>
          </div>

          <div class="card-paper p-3 p-md-4">
            <div class="row g-3">
              <div class="col-12 col-md-6">
                <label class="form-label fw-bold" for="custName">الاسم</label>
                <div class="inp-wrap">
                  <i class="fa-regular fa-user ico"></i>
                  <input id="custName" class="form-control pad-icon" placeholder="اسمك الكامل" autocomplete="name" required/>
                </div>
                <div id="err-name" class="text-danger small d-none mt-2">يرجى إدخال الاسم</div>
              </div>
              <div class="col-12 col-md-6">
                <label class="form-label fw-bold" for="custPhone">رقم الجوال</label>
                <input id="custPhone" class="form-control" type="tel" placeholder="5XXXXXXXX" inputmode="tel" autocomplete="tel" required/>
                <div id="ok-phone" class="text-success small d-none mt-2">رقم صحيح ✅</div>
                <div id="err-phone" class="text-danger small d-none mt-2">رقم غير صالح</div>
              </div>
              <div class="col-12" id="addressWrap" style="display:none">
                <label class="form-label fw-bold" for="address">العنوان</label>
                <div class="inp-wrap">
                  <i class="fa-solid fa-location-dot ico"></i>
                  <input id="address" class="form-control pad-icon" placeholder="الحي، الشارع، علامة مميزة" autocomplete="street-address"/>
                </div>
                <div id="err-address" class="text-danger small d-none mt-2">أدخل العنوان للتوصيل</div>
                <div class="mt-2 small" style="color:#4a4741"><i class="fa-regular fa-clock"></i> التوصيل عادة 30–45 دقيقة حسب الموقع.</div>
              </div>
              <div class="col-12">
                <label class="form-label fw-bold" for="notes">ملاحظات (اختياري)</label>
                <textarea id="notes" class="form-control" maxlength="140" placeholder="لا ثلج، حار، بدون بصل …"></textarea>
                <div class="d-flex small mt-2" style="color:#4a4741">
                  <span>نحاول تنفيذ تفضيلاتك بقدر الإمكان</span>
                  <span class="ms-auto">(<span id="notesCount">0</span>/140)</span>
                </div>
              </div>
            </div>
          </div>

          <div class="d-flex gap-2 mt-3">
            <a href="#tab-cart" class="btn btn-outline-dark flex-fill py-3 fw-bold" data-go="cart">رجوع للسلة</a>
            <button id="confirmBtn" class="btn btn-dark flex-fill py-3 fw-bold" aria-label="تأكيد الطلب">تأكيد الطلب</button>
          </div>

          <div class="mt-3 small d-flex gap-2 align-items-center" style="color:#4a4741">
            <i class="fa-brands fa-whatsapp"></i>
            <a class="link-light" target="_blank" rel="noopener" href="https://wa.me/966509027172" style="color:#EDEBE6">محتاج مساعدة؟ تواصل عبر واتساب</a>
          </div>
        </div>
        <div style="height:18vh"></div>
      </section>

      <!-- THANKS -->
      <section id="tab-thanks" class="tab-pane fade">
        <div class="container py-5">
          <div class="card-paper p-4 text-center">
            <div class="display-6 mb-2" style="color:#141414">🎉 شكراً لطلبك</div>
            <p class="mb-4" style="color:#4a4741">تم استلام طلبك بنجاح</p>
            <div class="d-flex flex-column align-items-center gap-3">
              <div class="ticket" id="thTicket">----</div>
              <div class="d-inline-flex flex-wrap gap-2 justify-content:center">
                <span class="badge bg-light text-dark border"><i class="fa-regular fa-calendar"></i> <span id="thDate">—</span></span>
                <span class="badge bg-light text-dark border"><strong>رقم الطلب:</strong>&nbsp;<span id="thOrderId">—</span></span>
                <span class="badge bg-light text-dark border"><strong>الإجمالي:</strong>&nbsp;<span id="thTotal">—</span></span>
                <span class="badge bg-light text-dark border" id="thType">—</span>
              </div>
              <div class="d-flex gap-2 mt-1">
                <button type="button" id="copyTicket" class="btn btn-outline-dark btn-sm"><i class="fa-regular fa-copy"></i> نسخ التذكرة</button>
                <button type="button" id="copySummary" class="btn btn-outline-dark btn-sm"><i class="fa-regular fa-clipboard"></i> نسخ الملخص</button>
              </div>
            </div>
            <div class="d-flex gap-2 justify-content-center mt-3">
              <a href="#tab-menu" id="thBackMenu" class="btn btn-dark" data-go="menu">طلب جديد</a>
              <a href="#tab-cart" id="thBackCart" class="btn btn-outline-dark" data-go="cart">عرض السلة</a>
            </div>
          </div>
        </div>
      </section>
    </div>
  </main>

  <!-- Options Modal -->
  <div class="modal fade" id="optModal" tabindex="-1" aria-labelledby="optTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h6 class="modal-title fw-bold" id="optTitle">خيارات إضافية</h6>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="إغلاق"></button>
        </div>
        <div class="modal-body">
          <div id="optSummary" class="mb-2 small" style="color:#4a4741"></div>
          <div id="optForm" class="vstack gap-3"></div>
          <div class="d-flex align-items-center justify-content-between mt-3">
            <div class="input-group" style="width:150px">
              <button class="btn btn-outline-dark" id="optMinus" type="button" aria-label="إنقاص">−</button>
              <input id="optQty" class="form-control text-center" type="number" min="1" step="1" value="1">
              <button class="btn btn-dark" id="optPlus" type="button" aria-label="زيادة">+</button>
            </div>
            <div class="fw-bold"><span>السعر:</span> <span id="optPrice" style="color:var(--gold)">0.00 ر.س</span></div>
          </div>
          <div class="mt-3">
            <label class="form-label fw-bold" for="optNotes">ملاحظات للطبق (اختياري)</label>
            <input id="optNotes" class="form-control" maxlength="100" placeholder="بدون بصل، صوص أقل …">
          </div>
        </div>
        <div class="modal-footer">
          <button id="optAddBtn" class="btn btn-dark w-100 fw-bold" type="button">إضافة للسلة</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Reels overlay -->
  <div id="reels" role="dialog" aria-modal="true" aria-label="استعراض الأطباق بشكل رييل" aria-hidden="true">
    <div id="reelsHeader" dir="rtl">
      <button id="closeReels" class="chip" type="button" aria-label="إغلاق">إغلاق</button>
      <span class="small text-white-50 me-auto ms-2">اسحب للأعلى/الأسفل</span>
      <button id="reelsToCart" class="chip" type="button" aria-label="فتح السلة">السلة</button>
    </div>
    <div id="reelsLoading">
      <div class="spinner-border text-gold" role="status" aria-label="جارِ التحميل"></div>
    </div>
    <div class="reels-list" id="reelsList" tabindex="0" aria-live="polite"></div>
  </div>

  <!-- Templates -->
  <template id="dishTpl">
    <div class="dish reveal" data-cat="">
      <img class="dish-img" alt="" width="1200" height="675" loading="lazy" decoding="async" fetchpriority="low"/>
      <div class="dish-body">
        <div class="d-flex align-items-center justify-content-between mb-1">
          <strong class="price"></strong>
          <div class="tags"></div>
        </div>
        <h6 class="title"></h6>
        <div class="small mb-1 desc"></div>
        <div class="add-wrap">
          <button class="add-btn" type="button" aria-label="أضف للسلة">أضف للسلة</button>
        </div>
      </div>
    </div>
  </template>

  <template id="cartLineTpl">
    <div class="line">
      <div class="d-flex align-items-center gap-2">
        <button class="btn btn-sm btn-outline-dark rounded-pill minus" aria-label="إنقاص">−</button>
        <strong class="qty" aria-live="polite">1</strong>
        <button class="btn btn-sm btn-dark rounded-pill plus" aria-label="زيادة">+</button>
      </div>
      <div class="flex-grow-1 text-truncate text-end">
        <div class="fw-bold name"></div>
        <div class="small">× <span class="unit">0.00</span> ر.س</div>
      </div>
      <div class="text-nowrap fw-bold total">0.00 ر.س</div>
    </div>
  </template>

  <!-- JS libs -->
  <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/intl-tel-input@24.4.0/build/js/intlTelInputWithUtils.js"></script>

  <!-- App -->
  <script>
  const GAS_WEBAPP_URL = 'https://script.google.com/macros/s/AKfycbxyGwCUJRwjVfJDtq5bxqN9Thm_KU4zOfNiNt0ENtW2jbDonr_yp3W2xDZCNXkmSHZNLw/exec';
  const FREE_SHIP = 79;

  window.addEventListener('DOMContentLoaded', () => {
    const state = { q:'', cart:{}, menu:[], unlockThanks:false, active:'menu' };
    const fmt = new Intl.NumberFormat('ar-SA', { style:'currency', currency:'SAR' });

    /* ===== Sticky & affix controls ===== */
    const topbarEl=document.getElementById('topbar'), chipsWrap=document.getElementById('chipsWrap'), chipsAffix=document.getElementById('chipsAffix');
    function measure(el){return Math.round(el?.getBoundingClientRect().height||0)}
    function setStickyVars(){
      const h = chipsAffix.classList.contains('visible') ? measure(chipsAffix) : (!chipsWrap.hidden?measure(chipsWrap):0);
      document.documentElement.style.setProperty('--topbar-h', measure(topbarEl)+'px');
      document.documentElement.style.setProperty('--chips-h', h+'px');
    }
    window.addEventListener('resize', setStickyVars, {passive:true});
    window.addEventListener('scroll', ()=>document.body.classList.toggle('scrolled', window.scrollY>6), {passive:true});

    function toast(msg){const box=document.getElementById('toasts');const el=document.createElement('div');el.className='toast-msg';el.textContent=msg;box.appendChild(el);setTimeout(()=>{el.style.opacity='0';el.style.transform='translateY(-6px)';setTimeout(()=>el.remove(),180);},2200)}
    function cartCount(){return Object.values(state.cart).reduce((a,b)=>a+b.qty,0)}
    function bumpBadge(){const b=document.getElementById('badge');b.classList.remove('bump');void b.offsetWidth;b.classList.add('bump')}

    /* ===== Chips visible on Menu + affix clone ===== */
    function setStep(active){
      state.active=active;
      const onMenu = active==='menu';
      chipsWrap.hidden=!onMenu; chipsWrap.setAttribute('aria-hidden', String(!onMenu));
      onMenu ? chipsWrap.removeAttribute('inert') : chipsWrap.setAttribute('inert','');
      setStickyVars();
    }
    function switchTab(to){
      const tabs=['menu','cart','data','thanks'];
      if(!tabs.includes(to)) return;
      if((to==='cart'||to==='data') && cartCount()===0){ toast('أضِف عناصر للسلة أولاً'); return; }
      if(to==='thanks' && !state.unlockThanks){ toast('أكمل تأكيد الطلب أولاً'); return; }
      document.querySelectorAll('.tab-pane').forEach(p=>p.classList.remove('show','active'));
      document.getElementById('tab-'+to)?.classList.add('show','active');
      setStep(to); history.replaceState(null,'','#tab-'+to); setStickyVars();
    }
    document.body.addEventListener('click',(e)=>{const a=e.target.closest('a[href^="#tab-"],[data-go]');if(!a) return;e.preventDefault();switchTab(a.dataset.go||(a.getAttribute('href')||'').replace('#tab-',''));});
    document.get
